<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¿è¯é‡‘ç®¡ç† - æ‹å–ç³»ç»Ÿ</title>
    
    <!-- Element UI CSS - ä½¿ç”¨CDN -->
    <link rel="stylesheet" href="/css/element-plus.css">
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .header {
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            padding: 0 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            height: 60px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: #409EFF;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 28px;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .main-content {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .page-header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: bold;
            color: #303133;
            margin: 0;
        }
        
        .page-description {
            color: #606266;
            margin: 10px 0 0 0;
        }
        
        .deposit-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .overview-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .overview-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .overview-value {
            font-size: 32px;
            font-weight: bold;
            color: #303133;
            margin-bottom: 5px;
        }
        
        .overview-label {
            font-size: 14px;
            color: #909399;
        }
        
        .balance-card {
            border-left: 4px solid #409EFF;
        }
        
        .balance-icon {
            color: #409EFF;
        }
        
        .frozen-card {
            border-left: 4px solid #f56c6c;
        }
        
        .frozen-icon {
            color: #f56c6c;
        }
        
        .available-card {
            border-left: 4px solid #67c23a;
        }
        
        .available-icon {
            color: #67c23a;
        }
        
        .deposit-actions {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .action-title {
            font-size: 18px;
            font-weight: bold;
            color: #303133;
            margin: 0 0 20px 0;
        }
        
        .action-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .action-btn {
            min-width: 120px;
        }
        
        .deposit-form {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .form-title {
            font-size: 18px;
            font-weight: bold;
            color: #303133;
            margin: 0 0 20px 0;
        }
        
        .quick-amounts {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .quick-amount-btn {
            padding: 10px;
            border: 1px solid #e4e7ed;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        
        .quick-amount-btn:hover {
            border-color: #409EFF;
            color: #409EFF;
        }
        
        .quick-amount-btn.selected {
            border-color: #409EFF;
            background: #f0f9ff;
            color: #409EFF;
        }
        
        .transaction-history {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .history-title {
            font-size: 18px;
            font-weight: bold;
            color: #303133;
            margin: 0 0 20px 0;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-type {
            font-weight: bold;
            color: #303133;
            margin-bottom: 5px;
        }
        
        .transaction-desc {
            font-size: 14px;
            color: #606266;
        }
        
        .transaction-amount {
            font-size: 16px;
            font-weight: bold;
        }
        
        .amount-positive {
            color: #67c23a; /* ç»¿è‰²ï¼šå……å€¼ã€é€€è¿˜ï¼ˆèµ„é‡‘è¿›å…¥ï¼‰ */
        }
        
        .amount-negative {
            color: #f56c6c; /* çº¢è‰²ï¼šæç°ã€æ‰£é™¤ï¼ˆèµ„é‡‘ç¦»å¼€ï¼‰ */
        }
        
        .amount-frozen {
            color: #e6a23c; /* æ©™è‰²ï¼šå†»ç»“ï¼ˆèµ„é‡‘é”å®šä½†è¿˜åœ¨è´¦æˆ·ï¼‰ */
        }
        
        .amount-unfrozen {
            color: #409eff; /* è“è‰²ï¼šè§£å†»ï¼ˆèµ„é‡‘è§£é”ä½†è¿˜åœ¨è´¦æˆ·ï¼‰ */
        }
        
        .amount-neutral {
            color: #909399; /* ç°è‰²ï¼šå…¶ä»– */
        }
        
        .transaction-time {
            font-size: 12px;
            color: #909399;
            margin-top: 5px;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .status-audit {
            background: #fff3e0;
            color: #e65100;
        }
        
        .status-success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-pending {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status-failed {
            background: #ffebee;
            color: #c62828;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #909399;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <el-header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="el-icon-gavel"></i>
                    <span>æ‹å–ç³»ç»Ÿ</span>
                </div>
                <div class="nav-links">
                    
                    <el-link href="/auction/user/sessions" :underline="false">æ‹å–ä¼š</el-link>
                    <el-link href="/auction/user/orders" :underline="false">æˆ‘çš„è®¢å•</el-link>
                    <el-link :underline="false" disabled style="font-weight: bold; color: #409EFF; cursor: not-allowed;">ä¿è¯é‡‘</el-link>
                    <el-link href="/auction/user/addresses" :underline="false">æ”¶è´§åœ°å€</el-link>
                    <el-link href="/auction/user/notifications" :underline="false">æˆ‘çš„é€šçŸ¥</el-link>
                </div>
                <div class="user-info" v-if="isLoggedIn">
                    <el-badge :value="unreadNotifications" :hidden="unreadNotifications === 0" style="margin-right: 15px;">
                        <el-button icon="el-icon-bell" circle @click="goToNotifications"></el-button>
                    </el-badge>
                    <span>æ¬¢è¿ï¼Œ{{ userInfo.nickname || userInfo.username }}</span>
                    <el-button @click="logout" type="danger" size="small">é€€å‡ºç™»å½•</el-button>
                </div>
                <div class="user-info" v-else>
                    <el-button @click="goToLogin" type="primary" size="small">ç™»å½•</el-button>
                </div>
            </div>
        </el-header>

        <!-- ä¸»è¦å†…å®¹ -->
        <el-main class="main-content">
            <!-- é¡µé¢æ ‡é¢˜ -->
            <div class="page-header">
                <h1 class="page-title">ä¿è¯é‡‘ç®¡ç†</h1>
                <p class="page-description">ç®¡ç†æ‚¨çš„ä¿è¯é‡‘è´¦æˆ·ï¼Œå……å€¼ã€æç°å’ŒæŸ¥çœ‹äº¤æ˜“è®°å½•</p>
            </div>

            <!-- ä¿è¯é‡‘æ¦‚è§ˆ -->
            <div class="deposit-overview">
                <div class="overview-card balance-card">
                    <i class="el-icon-wallet overview-icon balance-icon"></i>
                    <div class="overview-value">Â¥{{ accountBalance }}</div>
                    <div class="overview-label">è´¦æˆ·ä½™é¢</div>
                </div>
                <div class="overview-card frozen-card">
                    <i class="el-icon-lock overview-icon frozen-icon"></i>
                    <div class="overview-value">Â¥{{ frozenAmount }}</div>
                    <div class="overview-label">å†»ç»“é‡‘é¢</div>
                </div>
                <div class="overview-card available-card">
                    <i class="el-icon-check overview-icon available-icon"></i>
                    <div class="overview-value">Â¥{{ (availableAmount).toFixed(2) }}</div>
                    <div class="overview-label">å¯ç”¨é‡‘é¢</div>
                </div>
            </div>

            <!-- ä¿è¯é‡‘æ“ä½œ -->
            <div class="deposit-actions">
                <h3 class="action-title">å¿«é€Ÿæ“ä½œ</h3>
                <div class="action-buttons">
                    <el-button type="primary" @click="showDepositDialog" class="action-btn">
                        <i class="el-icon-plus"></i> å……å€¼ä¿è¯é‡‘
                    </el-button>
                    <el-button type="success" @click="showWithdrawDialog" class="action-btn">
                        <i class="el-icon-minus"></i> æç°
                    </el-button>
                    <el-button type="info" @click="loadTransactions" class="action-btn">
                        <i class="el-icon-refresh"></i> åˆ·æ–°è®°å½•
                    </el-button>
                </div>
            </div>

            <!-- å……å€¼è¡¨å• -->
            <div class="deposit-form" v-if="showDepositForm">
                <h3 class="form-title">å……å€¼ä¿è¯é‡‘</h3>
                
                <el-form :model="depositForm" :rules="depositRules" ref="depositFormRef" label-width="100px">
                    <el-form-item label="å……å€¼é‡‘é¢" prop="amount" required>
                        <el-input-number 
                            v-model="depositForm.amount" 
                            :min="1" 
                            :precision="2"
                            placeholder="è¯·è¾“å…¥å……å€¼é‡‘é¢"
                            style="width: 100%">
                        </el-input-number>
                    </el-form-item>
                    
                    <div class="quick-amounts">
                        <div 
                            v-for="amount in quickAmounts" 
                            :key="amount"
                            class="quick-amount-btn"
                            :class="{ selected: depositForm.amount === amount }"
                            @click="setDepositAmount(amount)">
                            Â¥{{ amount }}
                        </div>
                    </div>
                    
                    <el-form-item label="æ”¯ä»˜æ–¹å¼" prop="paymentMethod" required>
                        <el-select v-model="depositForm.paymentMethod" placeholder="è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼" style="width: 100%">
                            <el-option label="æ”¯ä»˜å®" value="alipay"></el-option>
                            <el-option label="å¾®ä¿¡æ”¯ä»˜" value="wechat"></el-option>
                            <el-option label="é“¶è¡Œå¡" value="bank"></el-option>
                        </el-select>
                    </el-form-item>
                    
                    <el-form-item>
                        <el-button type="primary" @click="submitDeposit" :loading="depositing">
                            ç¡®è®¤å……å€¼
                        </el-button>
                        <el-button @click="cancelDeposit">å–æ¶ˆ</el-button>
                    </el-form-item>
                </el-form>
            </div>

            <!-- æç°è¡¨å• -->
            <div class="deposit-form" v-if="showWithdrawForm">
                <h3 class="form-title">æç°ç”³è¯·</h3>
                
                <el-form :model="withdrawForm" :rules="withdrawRules" ref="withdrawFormRef" label-width="100px">
                    <el-form-item label="æç°é‡‘é¢" prop="amount" required>
                        <el-input-number 
                            v-model="withdrawForm.amount" 
                            :min="1" 
                            :max="availableAmount"
                            :precision="2"
                            placeholder="è¯·è¾“å…¥æç°é‡‘é¢"
                            style="width: 100%">
                        </el-input-number>
                    </el-form-item>
                    
                    <el-form-item label="æç°æ–¹å¼" prop="withdrawMethod" required>
                        <el-select v-model="withdrawForm.withdrawMethod" placeholder="è¯·é€‰æ‹©æç°æ–¹å¼" style="width: 100%">
                            <el-option label="æ”¯ä»˜å®" value="alipay"></el-option>
                            <el-option label="å¾®ä¿¡" value="wechat"></el-option>
                            <el-option label="é“¶è¡Œå¡" value="bank"></el-option>
                        </el-select>
                    </el-form-item>
                    
                    <el-form-item label="æ”¶æ¬¾è´¦å·" prop="account" required>
                        <el-input 
                            v-model="withdrawForm.account" 
                            placeholder="è¯·è¾“å…¥æ”¶æ¬¾è´¦å·">
                        </el-input>
                    </el-form-item>
                    
                    <el-form-item label="å¤‡æ³¨" prop="remark">
                        <el-input 
                            v-model="withdrawForm.remark" 
                            type="textarea" 
                            :rows="3"
                            placeholder="è¯·è¾“å…¥å¤‡æ³¨ä¿¡æ¯">
                        </el-input>
                    </el-form-item>
                    
                    <el-form-item>
                        <el-button type="primary" @click="submitWithdraw" :loading="withdrawing">
                            æäº¤ç”³è¯·
                        </el-button>
                        <el-button @click="cancelWithdraw">å–æ¶ˆ</el-button>
                    </el-form-item>
                </el-form>
            </div>

            <!-- äº¤æ˜“è®°å½• -->
            <div class="transaction-history">
                <h3 class="history-title">äº¤æ˜“è®°å½•</h3>
                
                <div v-if="loading" style="text-align: center; padding: 40px;">
                    <el-icon class="is-loading"><Loading /></el-icon>
                    <p>åŠ è½½ä¸­...</p>
                </div>
                
                <div v-else-if="transactions.length === 0" class="empty-state">
                    <i class="el-icon-document empty-icon"></i>
                    <h3>æš‚æ— äº¤æ˜“è®°å½•</h3>
                    <p>æ‚¨è¿˜æ²¡æœ‰ä»»ä½•ä¿è¯é‡‘äº¤æ˜“è®°å½•</p>
                </div>
                
                <div v-else>
                    <div 
                        v-for="transaction in transactions" 
                        :key="transaction.id" 
                        class="transaction-item">
                        <div class="transaction-info">
                            <div class="transaction-type" v-if="getTransactionTypeText(transaction.transactionType)">{{ getTransactionTypeText(transaction.transactionType) }}</div>
                            <div class="transaction-desc">{{ transaction.description }}</div>
                            <div class="transaction-time">{{ formatTime(transaction.createTime) }}</div>
                        </div>
                        <div class="transaction-amount" :class="getAmountClassByType(transaction.transactionType)">
                            {{ getAmountPrefix(transaction.transactionType) }}Â¥{{ Number(transaction.amount || 0).toFixed(2) }}
                        </div>
                        <div class="status-badge" :class="getStatusClass(transaction.status)">
                            {{ getStatusText(transaction.status) }}
                        </div>
                    </div>
                </div>
            </div>
        </el-main>
    </div>

    <!-- Element UI JS - ä½¿ç”¨CDN -->
    <script src="/js/vue.js"></script>
    <script src="/js/element-plus.js"></script>
    <script src="/js/axios.js"></script>
    <script src="/js/api-init.js"></script>
    
    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    loading: false,
                    isLoggedIn: false,
                    userInfo: {},
                    unreadNotifications: 0,
                    accountBalance: 0,
                    frozenAmount: 0,
                    
                    transactions: [],
                    showDepositForm: false,
                    showWithdrawForm: false,
                    depositing: false,
                    withdrawing: false,
                    quickAmounts: [100, 500, 1000, 2000, 5000, 10000],
                    depositForm: {
                        amount: null,
                        paymentMethod: ''
                    },
                    withdrawForm: {
                        amount: null,
                        withdrawMethod: '',
                        account: '',
                        remark: ''
                    },
                    depositRules: {
                        amount: [
                            { required: true, message: 'è¯·è¾“å…¥å……å€¼é‡‘é¢', trigger: 'blur' },
                            { type: 'number', min: 1, message: 'å……å€¼é‡‘é¢å¿…é¡»å¤§äº0', trigger: 'blur' }
                        ],
                        paymentMethod: [
                            { required: true, message: 'è¯·é€‰æ‹©æ”¯ä»˜æ–¹å¼', trigger: 'change' }
                        ]
                    },
                    withdrawRules: {
                        amount: [
                            { required: true, message: 'è¯·è¾“å…¥æç°é‡‘é¢', trigger: 'blur' },
                            { type: 'number', min: 1, message: 'æç°é‡‘é¢å¿…é¡»å¤§äº0', trigger: 'blur' }
                        ],
                        withdrawMethod: [
                            { required: true, message: 'è¯·é€‰æ‹©æç°æ–¹å¼', trigger: 'change' }
                        ],
                        account: [
                            { required: true, message: 'è¯·è¾“å…¥æ”¶æ¬¾è´¦å·', trigger: 'blur' }
                        ]
                    }
                }
            },
            computed: {
                availableAmount() {
                    return this.accountBalance - this.frozenAmount;
                }
            },
            mounted() {
                this.setupAxiosInterceptors();
                this.checkLoginStatus();
                if (this.isLoggedIn) {
                    this.loadAccountInfo();
                    this.loadTransactions();
                    this.loadUnreadNotifications();
                    // æ¯30ç§’åˆ·æ–°æœªè¯»é€šçŸ¥æ•°
                    setInterval(() => {
                        if (this.isLoggedIn) {
                            this.loadUnreadNotifications();
                        }
                    }, 30000);
                }
            },
            methods: {
                setupAxiosInterceptors() {
                    axios.interceptors.request.use(
                        config => {
                            const token = localStorage.getItem('accessToken');
                            if (token) {
                                config.headers.Authorization = `Bearer ${token}`;
                            }
                            return config;
                        },
                        error => Promise.reject(error)
                    );
                    
                    axios.interceptors.response.use(
                        response => response,
                        async error => {
                            if (error.response && error.response.status === 401) {
                                const refreshToken = localStorage.getItem('refreshToken');
                                if (refreshToken) {
                                    try {
                                        const response = await axios.post('/api/auth/refresh', { refreshToken });
                                        if (response.data.code === 200) {
                                            const newAccessToken = response.data.data.accessToken;
                                            localStorage.setItem('accessToken', newAccessToken);
                                            error.config.headers.Authorization = `Bearer ${newAccessToken}`;
                                            return axios.request(error.config);
                                        }
                                    } catch (e) {
                                        console.error('Tokenåˆ·æ–°å¤±è´¥:', e);
                                    }
                                }
                                
                                localStorage.removeItem('accessToken');
                                localStorage.removeItem('refreshToken');
                                localStorage.removeItem('userInfo');
                                this.isLoggedIn = false;
                                this.userInfo = {};
                                ElMessage.error('ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•');
                                window.location.href = '/auction/login';
                            }
                            return Promise.reject(error);
                        }
                    );
                },
                
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                checkLoginStatus() {
                    const accessToken = localStorage.getItem('accessToken');
                    const refreshToken = localStorage.getItem('refreshToken');
                    const userInfoStr = localStorage.getItem('userInfo');
                    
                    if (accessToken && refreshToken) {
                        this.isLoggedIn = true;
                        if (userInfoStr) {
                            this.userInfo = JSON.parse(userInfoStr);
                        } else {
                            this.userInfo = { username: 'buyer1', nickname: 'ä¹°å®¶1' };
                        }
                    } else {
                        this.isLoggedIn = false;
                        ElMessage.warning('è¯·å…ˆç™»å½•');
                        window.location.href = '/auction/login';
                    }
                },
                
                async loadUnreadNotifications() {
                    try {
                        const response = await axios.get('/api/notifications/unread-count');
                        if (response.data.code === 200) {
                            this.unreadNotifications = response.data.data;
                        }
                    } catch (error) {
                        console.error('è·å–æœªè¯»é€šçŸ¥æ•°å¤±è´¥:', error);
                    }
                },
                
                goToNotifications() {
                    window.location.href = '/auction/user/notifications';
                },
                
                // åŠ è½½è´¦æˆ·ä¿¡æ¯
                loadAccountInfo() {
                    axios.get('/api/deposit/account')
                        .then(response => {
                            if (response.data.code === 200) {
                                const data = response.data.data;
                                // æ¥å£è¿”å›çš„é‡‘é¢å•ä½æ˜¯å…ƒï¼Œç›´æ¥ä½¿ç”¨
                                this.accountBalance = Number(data.availableAmount || 0);
                                this.frozenAmount = Number(data.frozenAmount || 0);
                            }
                        })
                        .catch(error => {
                            console.error('åŠ è½½è´¦æˆ·ä¿¡æ¯é”™è¯¯:', error);
                        });
                },
                
                // åŠ è½½äº¤æ˜“è®°å½•
                loadTransactions() {
                    this.loading = true;
                    axios.get('/api/deposit/transactions')
                        .then(response => {
                            if (response.data.code === 200) {
                                const payload = response.data.data || {};
                                this.transactions = Array.isArray(payload.list) ? payload.list : [];
                            } else {
                                ElMessage.error('åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥');
                            }
                        })
                        .catch(error => {
                            console.error('åŠ è½½äº¤æ˜“è®°å½•é”™è¯¯:', error);
                            ElMessage.error('åŠ è½½äº¤æ˜“è®°å½•å¤±è´¥');
                        })
                        .finally(() => {
                            this.loading = false;
                        });
                },
                
                // æ˜¾ç¤ºå……å€¼è¡¨å•
                showDepositDialog() {
                    this.showDepositForm = true;
                    this.showWithdrawForm = false;
                },
                
                // æ˜¾ç¤ºæç°è¡¨å•
                showWithdrawDialog() {
                    this.showWithdrawForm = true;
                    this.showDepositForm = false;
                },
                
                // è®¾ç½®å……å€¼é‡‘é¢
                setDepositAmount(amount) {
                    this.depositForm.amount = amount;
                },
                
                // æäº¤å……å€¼
                submitDeposit() {
                    this.$refs.depositFormRef.validate((valid) => {
                        if (valid) {
                            this.depositing = true;
                            
                            axios.post('/api/deposit/deposit', this.depositForm)
                                .then(response => {
                                    if (response.data.code === 200) {
                                        ElMessage.success('å……å€¼ç”³è¯·å·²æäº¤');
                                        this.cancelDeposit();
                                        this.loadAccountInfo();
                                        this.loadTransactions();
                                    } else {
                                        ElMessage.error(response.data.message || 'å……å€¼å¤±è´¥');
                                    }
                                })
                                .catch(error => {
                                    console.error('å……å€¼é”™è¯¯:', error);
                                    ElMessage.error('å……å€¼å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                                })
                                .finally(() => {
                                    this.depositing = false;
                                });
                        }
                    });
                },
                
                // æäº¤æç°
                submitWithdraw() {
                    this.$refs.withdrawFormRef.validate((valid) => {
                        if (valid) {
                            this.withdrawing = true;
                            
                            axios.post('/api/deposit/withdraw', this.withdrawForm)
                                .then(response => {
                                    if (response.data.code === 200) {
                                        ElMessage.success('æç°ç”³è¯·å·²æäº¤');
                                        this.cancelWithdraw();
                                        this.loadAccountInfo();
                                        this.loadTransactions();
                                    } else {
                                        ElMessage.error(response.data.message || 'æç°å¤±è´¥');
                                    }
                                })
                                .catch(error => {
                                    console.error('æç°é”™è¯¯:', error);
                                    ElMessage.error('æç°å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                                })
                                .finally(() => {
                                    this.withdrawing = false;
                                });
                        }
                    });
                },
                
                // å–æ¶ˆå……å€¼
                cancelDeposit() {
                    this.showDepositForm = false;
                    this.depositForm = {
                        amount: null,
                        paymentMethod: ''
                    };
                },
                
                // å–æ¶ˆæç°
                cancelWithdraw() {
                    this.showWithdrawForm = false;
                    this.withdrawForm = {
                        amount: null,
                        withdrawMethod: '',
                        account: '',
                        remark: ''
                    };
                },
                
                // è·å–äº¤æ˜“ç±»å‹æ–‡æœ¬ï¼ˆæ•°å€¼å‹ï¼‰
                getTransactionTypeText(type) {
                    const t = Number(type);
                    const typeMap = {
                        1: 'å……å€¼',
                        2: 'æç°',
                        3: 'å†»ç»“',
                        4: 'è§£å†»',
                        5: 'æ‰£é™¤',
                        6: 'é€€è¿˜',
                        7: 'æ”¯ä»˜'
                    };
                    return typeMap[t] || '-';
                },
                
                // è·å–é‡‘é¢æ ·å¼ç±»ï¼ˆé‡æ–°è®¾è®¡ï¼šå……å€¼/é€€è¿˜+ç»¿è‰²ï¼Œæç°/æ‰£é™¤-çº¢è‰²ï¼Œå†»ç»“æ©™è‰²ï¼Œè§£å†»è“è‰²ï¼‰
                getAmountClassByType(type) {
                    const t = Number(type);
                    if (t === 1 || t === 6) return 'amount-positive';      // å……å€¼ã€é€€è¿˜ï¼šç»¿è‰²
                    if (t === 2 || t === 5) return 'amount-negative';      // æç°ã€æ‰£é™¤ï¼šçº¢è‰²
                    if (t === 3) return 'amount-frozen';                   // å†»ç»“ï¼šæ©™è‰²
                    if (t === 4) return 'amount-unfrozen';                 // è§£å†»ï¼šè“è‰²
                    return 'amount-neutral';
                },

                // å‰ç¼€ç¬¦å·ï¼ˆé‡æ–°è®¾è®¡ï¼šå……å€¼/é€€è¿˜+ï¼Œæç°/æ‰£é™¤-ï¼Œå†»ç»“ğŸ”’ï¼Œè§£å†»ğŸ”“ï¼‰
                getAmountPrefix(type) {
                    const t = Number(type);
                    if (t === 1 || t === 6) return '+';      // å……å€¼ã€é€€è¿˜ï¼ˆèµ„é‡‘è¿›å…¥ï¼‰
                    if (t === 2 || t === 5) return '-';      // æç°ã€æ‰£é™¤ï¼ˆèµ„é‡‘ç¦»å¼€ï¼‰
                    if (t === 3) return 'ğŸ”’';                // å†»ç»“ï¼ˆèµ„é‡‘é”å®šä½†è¿˜åœ¨è´¦æˆ·ï¼‰
                    if (t === 4) return 'ğŸ”“';                // è§£å†»ï¼ˆèµ„é‡‘è§£é”ä½†è¿˜åœ¨è´¦æˆ·ï¼‰
                    return '';
                },
                
                // è·å–çŠ¶æ€æ ·å¼ç±»ï¼ˆ1æˆåŠŸ 2å¤±è´¥ 3å¤„ç†ä¸­ï¼‰
                getStatusClass(status) {
                    const s = Number(status);
                    const statusMap = {
                        0: 'status-audit',      // å¾…å®¡æ ¸ - æ©™è‰²
                        1: 'status-success',    // æˆåŠŸ - ç»¿è‰²
                        2: 'status-failed',     // å¤±è´¥ - çº¢è‰²
                        3: 'status-pending'     // å¤„ç†ä¸­ - è“è‰²
                    };
                    return statusMap[s] || 'status-pending';
                },
                
                // è·å–çŠ¶æ€æ–‡æœ¬ï¼ˆæ•°å€¼å‹ï¼‰
                getStatusText(status) {
                    const s = Number(status);
                    const statusMap = {
                        0: 'å¾…å®¡æ ¸',
                        1: 'æˆåŠŸ',
                        2: 'å·²æ‹’ç»',
                        3: 'å¤„ç†ä¸­'
                    };
                    return statusMap[s] || 'â€”';
                },
                
                // æ ¼å¼åŒ–æ—¶é—´
                formatTime(time) {
                    if (!time) return 'â€”';
                    const d = new Date(time);
                    if (isNaN(d.getTime())) return 'â€”';
                    return d.toLocaleString('zh-CN');
                },
                
                // è·³è½¬åˆ°ç™»å½•é¡µé¢
                goToLogin() {
                    window.location.href = '/auction/login';
                },
                
                // é€€å‡ºç™»å½•
                logout() {
                    ElMessageBox.confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ', 'æç¤º', {
                        confirmButtonText: 'ç¡®å®š',
                        cancelButtonText: 'å–æ¶ˆ',
                        type: 'warning'
                    }).then(() => {
                        // æ¸…ç†æœ¬åœ°Tokenå¹¶è·³è½¬ç™»å½•
                        localStorage.removeItem('accessToken');
                        localStorage.removeItem('refreshToken');
                        delete axios.defaults.headers.common['Authorization'];
                        axios.post('/api/auth/logout').finally(() => {
                            this.isLoggedIn = false;
                            this.userInfo = {};
                            ElMessage.success('å·²é€€å‡ºç™»å½•');
                            window.location.href = '/auction/login';
                        });
                    });
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
    
</body>
</html>
