<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>超级管理后台 - 拍卖系统</title>
    
    <!-- Element UI CSS -->
    <link rel="stylesheet" href="/css/element-plus.css">
    <!-- 自定义样式 -->
    <link href="/css/admin.css" rel="stylesheet">
    <style>
        .item-upload-page .form-section {
            margin-bottom: 30px;
        }
        
        .item-upload-page .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #EBEEF5;
        }
        
        
        .image-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }
        
        .image-item {
            position: relative;
            width: 120px;
            height: 120px;
            border: 1px solid #DCDFE6;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .image-actions {
            position: absolute;
            top: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.5);
            padding: 5px;
        }
        
        /* 编辑对话框图片预览样式 */
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }
        
        .image-preview-item {
            position: relative;
            width: 120px;
            height: 120px;
            border: 1px solid #DCDFE6;
            border-radius: 6px;
            overflow: hidden;
            cursor: pointer;
        }
        
        .image-preview-item:hover {
            border-color: #409EFF;
        }
        
        /* 修复图片预览层级问题 */
        .el-image-viewer__wrapper {
            z-index: 999999 !important;
            position: fixed !important;
        }
        
        .el-image__preview {
            z-index: 999999 !important;
        }
        
        .el-image-viewer__mask {
            z-index: 999998 !important;
            position: fixed !important;
        }
        
        .el-image-viewer__btn {
            z-index: 999999 !important;
        }
        
        .el-image-viewer__canvas {
            z-index: 999999 !important;
        }
        
        .el-image-viewer__actions {
            z-index: 999999 !important;
        }
        
        .el-image-viewer__close {
            z-index: 999999 !important;
        }
        
        
        /* 限制图片预览大小 */
        .el-image-viewer__canvas {
            max-width: 80vw !important;
            max-height: 80vh !important;
            width: auto !important;
            height: auto !important;
        }
        
        .el-image-viewer__wrapper {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
        }
        
        .el-image-viewer__img {
            max-width: 80vw !important;
            max-height: 80vh !important;
            width: auto !important;
            height: auto !important;
            object-fit: contain !important;
        }
        
        
        /* 编辑拍品图片管理样式 */
        .image-upload-section {
            width: 100%;
        }
        
        .table-image {
            width: 80px;
            height: 80px;
            border-radius: 4px;
        }
        
        .existing-images-section {
            margin-bottom: 20px;
        }
        
        .existing-images-section .section-title {
            font-size: 14px;
            font-weight: 600;
            color: #303133;
            margin-bottom: 10px;
        }
        
        
        .sessions-page .page-header,
        .session-create-page .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .sessions-page .page-header h1,
        .session-create-page .page-header h1 {
            margin: 0;
            font-size: 24px;
            color: #303133;
        }
        
        .selected-count {
            margin-left: 10px;
            color: #409EFF;
            font-size: 14px;
        }
        
        .selected-items {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .item-tag {
            margin: 0;
        }
        
        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 6px;
            background: #fafafa;
        }
        
        .section-title {
            margin: 0 0 20px 0;
            font-size: 16px;
            font-weight: 600;
            color: #303133;
            border-bottom: 2px solid #409EFF;
            padding-bottom: 8px;
        }
        
        .form-tip {
            font-size: 12px;
        }
        
        .upload-tips {
            margin-top: 10px;
            padding: 10px;
            background: #f5f7fa;
            border-radius: 4px;
            border-left: 3px solid #409EFF;
        }
        
        .upload-tips p {
            margin: 5px 0;
            font-size: 13px;
            color: #606266;
            line-height: 1.4;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- 顶部导航 -->
        <el-header class="header">
            <div class="header-content">
                <div class="left-section">
                    <div class="logo">
                        <i class="el-icon-gavel"></i>
                        <span>拍卖系统 - 超级管理</span>
                    </div>
                </div>
                
                <div class="right-section">
                    <el-dropdown @command="handleUserCommand">
                        <span class="user-name">
                            <i class="el-icon-user"></i>
                            {{ userInfo.nickname || userInfo.username }}
                            <i class="el-icon-arrow-down"></i>
                        </span>
                        <template #dropdown>
                            <el-dropdown-menu>
                                <el-dropdown-item command="profile">个人资料</el-dropdown-item>
                                <el-dropdown-item command="logout" divided>退出登录</el-dropdown-item>
                            </el-dropdown-menu>
                        </template>
                    </el-dropdown>
                </div>
            </div>
        </el-header>

        <!-- 主要内容区域 -->
        <el-container class="main-container">
            <!-- 侧边栏 -->
            <el-aside :width="sidebarWidth" class="admin-sidebar">
                <el-menu
                    :default-active="activeMenu"
                    :collapse="isCollapse"
                    :unique-opened="true"
                    @select="handleMenuSelect">
                    
                    <el-menu-item index="dashboard" @click="goToPage('dashboard')">
                        <i class="el-icon-data-line"></i>
                        <span>仪表板</span>
                    </el-menu-item>
                    
                    <el-sub-menu index="item-management">
                        <template #title>
                            <i class="el-icon-box"></i>
                            <span>拍品管理</span>
                        </template>
                        <el-menu-item index="items" @click="goToPage('items')">拍品列表</el-menu-item>
                        <el-menu-item index="items/add" @click="goToPage('items/add')">上传拍品</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="session-management">
                        <template #title>
                            <i class="el-icon-trophy"></i>
                            <span>拍卖会管理</span>
                        </template>
                        <el-menu-item index="sessions" @click="goToPage('sessions')">拍卖会列表</el-menu-item>
                        <el-menu-item index="sessions/add" @click="goToPage('sessions/add')">创建拍卖会</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="data-management">
                        <template #title>
                            <i class="el-icon-data-analysis"></i>
                            <span>数据管理</span>
                        </template>
                        <el-menu-item index="deposits" @click="goToPage('deposits')">保证金审核</el-menu-item>
                        <el-menu-item index="orders-ship" @click="goToPage('orders-ship')">订单发货</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="risk-management">
                        <template #title>
                            <i class="el-icon-warning"></i>
                            <span>风控管理</span>
                        </template>
                        <el-menu-item index="deposit-accounts" @click="goToPage('deposit-accounts')">保证金账户</el-menu-item>
                    </el-sub-menu>
                    
                    <el-sub-menu index="system-management">
                        <template #title>
                            <i class="el-icon-setting"></i>
                            <span>系统管理</span>
                        </template>
                        <el-menu-item index="config" @click="goToPage('config')">系统配置</el-menu-item>
                        <el-menu-item index="user-management" @click="goToPage('user-management')">用户管理</el-menu-item>
                        <el-menu-item index="logistics-companies" @click="goToPage('logistics-companies')">物流公司管理</el-menu-item>
                        <el-menu-item index="audit-logs" @click="goToPage('audit-logs')">审计日志</el-menu-item>
                        <el-menu-item index="notices" @click="goToPage('notices')">参拍须知</el-menu-item>
                        <el-menu-item index="bid-increments" @click="goToPage('bid-increments')">加价阶梯</el-menu-item>
                    </el-sub-menu>
                </el-menu>
            </el-aside>

            <!-- 主内容区域 -->
            <el-main class="admin-main">
                <!-- 面包屑导航 -->
                <el-breadcrumb separator="/" class="breadcrumb">
                    <el-breadcrumb-item v-for="item in breadcrumbList" :key="item.path">
                        <a v-if="item.path" @click="goToPage(item.path)">{{ item.name }}</a>
                        <span v-else>{{ item.name }}</span>
                    </el-breadcrumb-item>
                </el-breadcrumb>

                <!-- 页面内容 -->
                <div class="page-content">
                    <!-- 仪表板 -->
                    <div v-if="activeMenu === 'dashboard'" class="dashboard">
                        <h1>仪表板</h1>
                        
                        <!-- 统计卡片 -->
                        <el-row :gutter="20" class="stats-row">
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-value">{{ stats.totalItems }}</div>
                                        <div class="stat-label">拍品总数</div>
                                    </div>
                                    <i class="el-icon-box stat-icon"></i>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-value">{{ stats.totalSessions }}</div>
                                        <div class="stat-label">拍卖会总数</div>
                                    </div>
                                    <i class="el-icon-trophy stat-icon"></i>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-value">{{ stats.totalUsers }}</div>
                                        <div class="stat-label">用户总数</div>
                                    </div>
                                    <i class="el-icon-user stat-icon"></i>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-value">{{ stats.totalBids }}</div>
                                        <div class="stat-label">出价总数</div>
                                    </div>
                                    <i class="el-icon-money stat-icon"></i>
                                </el-card>
                            </el-col>
                        </el-row>
                        
                        
                    </div>

                    <!-- 加价阶梯配置（含规则） -->
                    <!-- 物流公司管理 -->
                    <div v-else-if="activeMenu === 'logistics-companies'" class="logistics-companies-page">
                        <div class="page-header">
                            <h1>物流公司管理</h1>
                            <el-button type="primary" @click="openCreateLogisticsCompany">
                                <i class="el-icon-plus"></i>
                                新建物流公司
                            </el-button>
                        </div>

                        <!-- 搜索筛选 -->
                        <el-card class="search-card">
                            <el-form inline>
                                <el-form-item label="公司名称">
                                    <el-input v-model="logisticsSearchName" placeholder="请输入公司名称" clearable></el-input>
                                </el-form-item>
                                <el-form-item label="状态">
                                    <el-select v-model="logisticsStatus" placeholder="请选择状态" clearable>
                                        <el-option label="全部" value=""></el-option>
                                        <el-option label="启用" :value="1"></el-option>
                                        <el-option label="禁用" :value="0"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="searchLogisticsCompanies">搜索</el-button>
                                    <el-button @click="resetLogisticsFilters">重置</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>

                        <!-- 物流公司表格 -->
                        <el-card class="table-card">
                            <el-table :data="logisticsCompanies" v-loading="logisticsLoading" stripe>
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column prop="companyName" label="公司名称" min-width="150"></el-table-column>
                                <el-table-column prop="companyCode" label="公司代码" width="120"></el-table-column>
                                <el-table-column prop="baseFee" label="基础运费(元)" width="120">
                                    <template #default="scope">¥{{ scope.row.baseFee }}</template>
                                </el-table-column>
                                <el-table-column prop="insuranceRate" label="保价费率(%)" width="120">
                                    <template #default="scope">{{ scope.row.insuranceRate }}%</template>
                                </el-table-column>
                                <el-table-column prop="sortOrder" label="排序" width="80"></el-table-column>
                                <el-table-column prop="enabled" label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.enabled === 1 ? 'success' : 'info'">
                                            {{ scope.row.enabled === 1 ? '启用' : '禁用' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="remark" label="备注" min-width="200" show-overflow-tooltip></el-table-column>
                                <el-table-column label="操作" width="200" fixed="right">
                                    <template #default="scope">
                                        <el-button-group>
                                            <el-button type="primary" size="small" @click="openEditLogisticsCompany(scope.row)">编辑</el-button>
                                            <el-button type="danger" size="small" @click="deleteLogisticsCompany(scope.row)">删除</el-button>
                                        </el-button-group>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="pagination-container" v-if="logisticsTotal > 0">
                                <el-pagination
                                    v-model:current-page="logisticsPage"
                                    v-model:page-size="logisticsPageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="logisticsTotal"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    @size-change="handleLogisticsSizeChange"
                                    @current-change="handleLogisticsCurrentChange">
                                </el-pagination>
                            </div>
                        </el-card>

                        <!-- 新建/编辑物流公司对话框 -->
                        <el-dialog v-model="logisticsDialogVisible" :title="logisticsForm.id ? '编辑物流公司' : '新建物流公司'" width="600px">
                            <el-form :model="logisticsForm" label-width="120px">
                                <el-form-item label="公司名称" required>
                                    <el-input v-model="logisticsForm.companyName" placeholder="请输入公司名称" />
                                </el-form-item>
                                <el-form-item label="公司代码" required>
                                    <el-input v-model="logisticsForm.companyCode" placeholder="如: SF, YTO" />
                                </el-form-item>
                                <el-form-item label="基础运费(元)" required>
                                    <el-input-number v-model="logisticsForm.baseFee" :precision="2" :step="1" :min="0" />
                                </el-form-item>
                                <el-form-item label="保价费率(%)" required>
                                    <el-input-number v-model="logisticsForm.insuranceRate" :precision="2" :step="0.1" :min="0" :max="100" />
                                    <span style="margin-left: 10px; color: #999; font-size: 12px;">保价费 = 订单金额 × 保价费率 / 100</span>
                                </el-form-item>
                                <el-form-item label="排序权重">
                                    <el-input-number v-model="logisticsForm.sortOrder" :min="0" />
                                    <span style="margin-left: 10px; color: #999; font-size: 12px;">数值越小越靠前</span>
                                </el-form-item>
                                <el-form-item label="状态">
                                    <el-radio-group v-model="logisticsForm.enabled">
                                        <el-radio :value="1">启用</el-radio>
                                        <el-radio :value="0">禁用</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                <el-form-item label="备注">
                                    <el-input type="textarea" :rows="3" v-model="logisticsForm.remark" placeholder="可选" />
                                </el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="logisticsDialogVisible = false">取消</el-button>
                                <el-button type="primary" @click="saveLogisticsCompany" :loading="logisticsSaving">保存</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <div v-else-if="activeMenu === 'bid-increments'" class="bid-increments-page">
                        <div class="page-header">
                            <h1>加价阶梯配置</h1>
                            <el-button type="primary" @click="openCreateBidConfig">
                                <i class="el-icon-plus"></i>
                                新建配置
                            </el-button>
                        </div>

                        <!-- 搜索筛选 -->
                        <el-card class="search-card">
                            <el-form :model="{ bidConfigSearchName, bidConfigStatus }" inline>
                                <el-form-item label="配置名称">
                                    <el-input v-model="bidConfigSearchName" placeholder="请输入配置名称" clearable></el-input>
                                </el-form-item>
                                <el-form-item label="状态">
                                    <el-select v-model="bidConfigStatus" placeholder="请选择状态" clearable>
                                        <el-option label="全部" value=""></el-option>
                                        <el-option label="启用" :value="1"></el-option>
                                        <el-option label="禁用" :value="0"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="searchBidConfigs">搜索</el-button>
                                    <el-button @click="resetBidIncrementFilters">重置</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>

                        <!-- 配置表格 -->
                        <el-card class="table-card">
                            <el-table :data="bidIncrementConfigs" v-loading="bidIncrementLoading" stripe>
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column prop="configName" label="配置名称" min-width="200"></el-table-column>
                                <el-table-column prop="description" label="描述" min-width="260" show-overflow-tooltip></el-table-column>
                                <el-table-column prop="status" label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 1 ? 'success' : 'info'">{{ scope.row.status === 1 ? '启用' : '禁用' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="180">
                                    <template #default="scope">{{ formatTime(scope.row.createTime) }}</template>
                                </el-table-column>
                                <el-table-column label="操作" width="200" fixed="right">
                                    <template #default="scope">
                                        <el-button-group>
                                            <el-button type="primary" size="small" @click="openEditBidConfig(scope.row)">编辑</el-button>
                                            <el-button type="danger" size="small" @click="deleteBidConfig(scope.row)">删除</el-button>
                                        </el-button-group>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="pagination-container" v-if="bidConfigTotal > 0">
                                <el-pagination
                                    v-model:current-page="bidConfigPage"
                                    v-model:page-size="bidConfigPageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="bidConfigTotal"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    @size-change="handleBidConfigSizeChange"
                                    @current-change="handleBidConfigCurrentChange">
                                </el-pagination>
                            </div>
                        </el-card>

                        <!-- 新建/编辑配置对话框（含规则） -->
                        <el-dialog v-model="bidConfigDialogVisible" :title="bidConfigForm.id ? '编辑加价阶梯配置' : '新建加价阶梯配置'" width="820px">
                            <el-form :model="bidConfigForm" label-width="110px">
                                <el-form-item label="配置名称">
                                    <el-input v-model="bidConfigForm.configName" placeholder="请输入配置名称" />
                                </el-form-item>
                                <el-form-item label="状态">
                                    <el-radio-group v-model="bidConfigForm.status">
                                        <el-radio :value="1">启用</el-radio>
                                        <el-radio :value="0">禁用</el-radio>
                                    </el-radio-group>
                                </el-form-item>
                                <el-form-item label="描述">
                                    <el-input type="textarea" :rows="3" v-model="bidConfigForm.description" placeholder="可选" />
                                </el-form-item>

                                <el-divider content-position="left">规则明细</el-divider>
                                <div style="margin-bottom: 8px;">
                                    <el-button size="small" @click="addRuleRow">添加规则行</el-button>
                                </div>
                                <el-table :data="bidConfigForm.rules" border size="small">
                                    <el-table-column label="#" width="60">
                                        <template #default="scope">{{ scope.$index + 1 }}</template>
                                    </el-table-column>
                                    <el-table-column label="最小金额(元)" width="160">
                                        <template #default="scope">
                                            <el-input-number v-model="scope.row.minAmount" :precision="2" :step="1" :min="0" style="width: 140px;" />
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="最大金额(元)" width="160">
                                        <template #default="scope">
                                            <el-input v-model="scope.row.maxAmountStr" placeholder="留空表示无上限" style="width: 140px;" />
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="加价幅度(元)" width="160">
                                        <template #default="scope">
                                            <el-input-number v-model="scope.row.incrementAmount" :precision="2" :step="1" :min="0.01" style="width: 140px;" />
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="排序" width="120">
                                        <template #default="scope">
                                            <el-input-number v-model="scope.row.sortOrder" :step="1" :min="0" style="width: 100px;" />
                                        </template>
                                    </el-table-column>
                                    <el-table-column label="操作" width="120">
                                        <template #default="scope">
                                            <el-button text type="danger" size="small" @click="removeRuleRow(scope.$index)">删除</el-button>
                                        </template>
                                    </el-table-column>
                                </el-table>
                                <div style="margin-top: 8px; color: #888;">
                                    说明：最大金额留空表示无上限；规则应按金额区间连续且不重叠，保存时将校验。
                                </div>
                            </el-form>
                            <template #footer>
                                <el-button @click="bidConfigDialogVisible = false">取消</el-button>
                                <el-button type="primary" :loading="bidConfigSaving" @click="saveBidConfig">保存</el-button>
                            </template>
                        </el-dialog>
                    </div>
                    
                    <!-- 拍品列表 -->
                    <div v-else-if="activeMenu === 'items'" class="items-page">
                        <div class="page-header">
                            <h1>拍品列表</h1>
                            <el-button type="primary" @click="goToPage('items/add')">
                                <i class="el-icon-plus"></i>
                                上传拍品
                            </el-button>
                        </div>
                        
                        <!-- 搜索筛选 -->
                        <el-card class="search-card">
                            <el-form :model="itemSearchForm" inline>
                                <el-form-item label="拍品名称">
                                    <el-input v-model="itemSearchForm.itemName" placeholder="请输入拍品名称" clearable></el-input>
                                </el-form-item>
                                <el-form-item label="状态">
                                    <el-select v-model="itemSearchForm.status" placeholder="请选择状态" clearable>
                                        <el-option label="全部" value=""></el-option>
                                        <el-option label="草稿" :value="0"></el-option>
                                        <el-option label="待审核" :value="1"></el-option>
                                        <el-option label="审核通过" :value="2"></el-option>
                                        <el-option label="审核拒绝" :value="3"></el-option>
                                        <el-option label="拍卖中" :value="4"></el-option>
                                        <el-option label="已成交" :value="5"></el-option>
                                        <el-option label="流拍" :value="6"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="searchItems">搜索</el-button>
                                    <el-button @click="resetItemSearch">重置</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>
                        
                        <!-- 拍品表格 -->
                        <el-card class="table-card">
                            <el-table :data="items" v-loading="itemsLoading" stripe>
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column label="图片" width="120">
                                    <template #default="scope">
                                        <el-image
                                            :src="extractFirstImage(scope.row.images) || '/images/default-item.jpg'"
                                            :preview-src-list="(scope.row.imageList || []).map(url => url)"
                                            :initial-index="0"
                                            :preview-teleported="true"
                                            class="table-image"
                                            fit="cover">
                                        </el-image>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="itemName" label="拍品名称" min-width="200"></el-table-column>
                                <el-table-column prop="startingPrice" label="起拍价" width="120">
                                    <template #default="scope">
                                        ¥{{ scope.row.startingPrice }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="currentPrice" label="当前价格" width="120">
                                    <template #default="scope">
                                        ¥{{ scope.row.currentPrice || scope.row.startingPrice }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="status" label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getItemStatusType(scope.row.status)">
                                            {{ getItemStatusText(scope.row.status) }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="createTime" label="创建时间" width="160">
                                    <template #default="scope">
                                        {{ formatTime(scope.row.createTime) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="280" fixed="right">
                                    <template #default="scope">
                                        <el-button-group>
                                            <el-button type="primary" size="small" @click="editItem(scope.row)">编辑</el-button>
                                            <el-button 
                                                :type="scope.row.status === 1 ? 'warning' : 'success'" 
                                                size="small" 
                                                @click="toggleItemStatus(scope.row)">
                                                {{ scope.row.status === 1 ? '下架' : '上架' }}
                                            </el-button>
                                            <el-button type="danger" size="small" @click="deleteItem(scope.row)">删除</el-button>
                                        </el-button-group>
                                    </template>
                                </el-table-column>
                            </el-table>
                            
                            <!-- 分页 -->
                            <div class="pagination-container" v-if="itemsTotal > 0">
                                <el-pagination
                                    v-model:current-page="itemsPage"
                                    v-model:page-size="itemsPageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="itemsTotal"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    @size-change="handleItemsSizeChange"
                                    @current-change="handleItemsCurrentChange">
                                </el-pagination>
                            </div>
                        </el-card>
                    </div>
                    
                    <!-- 保证金审核管理 -->
                    <div v-else-if="activeMenu === 'deposits'" class="deposits-page">
                        <div class="page-header">
                            <h1>保证金审核管理</h1>
                            <el-button @click="refreshDepositAudit" icon="el-icon-refresh">刷新</el-button>
                        </div>

                        <el-card>
                            <!-- 标签页切换 -->
                            <el-tabs v-model="depositAuditTab" @tab-change="onDepositAuditTabChange">
                                <!-- 待审核标签页 -->
                                <el-tab-pane label="待审核" name="pending">
                                    <!-- 筛选 -->
                                    <div style="margin-bottom: 20px;">
                                        <el-radio-group v-model="depositTypeFilter" @change="loadPendingDeposits">
                                            <el-radio-button :label="null">全部</el-radio-button>
                                            <el-radio-button :label="1">充值申请</el-radio-button>
                                            <el-radio-button :label="6">提现申请</el-radio-button>
                                        </el-radio-group>
                                        
                                        <el-tag v-if="pendingDeposits.length > 0" type="warning" style="margin-left: 15px;">
                                            待审核: {{ pendingDeposits.length }} 条
                                        </el-tag>
                                    </div>

                                    <!-- 待审核列表 -->
                            <el-table 
                                :data="pendingDeposits" 
                                v-loading="depositsLoading"
                                stripe
                                border>
                                <el-table-column prop="transactionNo" label="流水号" width="220"></el-table-column>
                                <el-table-column label="类型" width="100">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.transactionType === 1 ? 'success' : 'warning'">
                                            {{ scope.row.transactionType === 1 ? '充值' : '提现' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="用户ID" prop="userId" width="100"></el-table-column>
                                <el-table-column label="金额" width="120">
                                    <template #default="scope">
                                        <span style="color: #F56C6C; font-weight: bold;">
                                            ¥{{ scope.row.amount }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="description" label="说明" min-width="200"></el-table-column>
                                <el-table-column label="申请时间" width="180">
                                    <template #default="scope">
                                        {{ formatDateTime(scope.row.createTime) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag type="warning">待审核</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="200" fixed="right">
                                    <template #default="scope">
                                        <el-button 
                                            type="success" 
                                            size="small" 
                                            @click="approveDeposit(scope.row)">
                                            通过
                                        </el-button>
                                        <el-button 
                                            type="danger" 
                                            size="small" 
                                            @click="openRejectDialog(scope.row)">
                                            拒绝
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                                    <!-- 空状态 -->
                                    <div v-if="!depositsLoading && pendingDeposits.length === 0" style="text-align: center; padding: 40px; color: #909399;">
                                        <i class="el-icon-finished" style="font-size: 48px; display: block; margin-bottom: 10px;"></i>
                                        <p>暂无待审核的申请</p>
                                    </div>
                                </el-tab-pane>

                                <!-- 已审核标签页 -->
                                <el-tab-pane label="已审核" name="audited">
                                    <!-- 筛选 -->
                                    <div style="margin-bottom: 20px;">
                                        <el-radio-group v-model="auditedTypeFilter" @change="loadAuditedDeposits">
                                            <el-radio-button :label="null">全部</el-radio-button>
                                            <el-radio-button :label="1">充值</el-radio-button>
                                            <el-radio-button :label="6">提现</el-radio-button>
                                        </el-radio-group>
                                        
                                        <el-radio-group v-model="auditedStatusFilter" @change="loadAuditedDeposits" style="margin-left: 15px;">
                                            <el-radio-button :label="null">全部状态</el-radio-button>
                                            <el-radio-button :label="1">审核通过</el-radio-button>
                                            <el-radio-button :label="2">已拒绝</el-radio-button>
                                        </el-radio-group>
                                        
                                        <el-tag v-if="auditedDeposits.length > 0" type="info" style="margin-left: 15px;">
                                            记录: {{ auditedDeposits.length }} 条
                                        </el-tag>
                                    </div>

                                    <!-- 已审核列表 -->
                                    <el-table 
                                        :data="auditedDeposits" 
                                        v-loading="auditedDepositsLoading"
                                        stripe
                                        border>
                                        <el-table-column prop="transactionNo" label="流水号" width="200"></el-table-column>
                                        <el-table-column label="类型" width="100">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.transactionType === 1 ? 'success' : 'warning'">
                                                    {{ scope.row.transactionType === 1 ? '充值' : '提现' }}
                                                </el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="用户ID" prop="userId" width="100"></el-table-column>
                                        <el-table-column label="金额" width="120">
                                            <template #default="scope">
                                                <span style="color: #F56C6C; font-weight: bold;">
                                                    ¥{{ Number(scope.row.amount || 0).toFixed(2) }}
                                                </span>
                                            </template>
                                        </el-table-column>
                                        <el-table-column prop="description" label="说明" min-width="150" show-overflow-tooltip></el-table-column>
                                        <el-table-column label="申请时间" width="160">
                                            <template #default="scope">
                                                {{ formatDateTime(scope.row.createTime) }}
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="审核状态" width="100">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.status === 1 ? 'success' : 'danger'">
                                                    {{ scope.row.status === 1 ? '已通过' : '已拒绝' }}
                                                </el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="审核人ID" prop="reviewerId" width="100"></el-table-column>
                                        <el-table-column label="审核时间" width="160">
                                            <template #default="scope">
                                                {{ formatDateTime(scope.row.reviewTime) }}
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="审核备注" min-width="150" show-overflow-tooltip>
                                            <template #default="scope">
                                                {{ scope.row.reviewRemark || '-' }}
                                            </template>
                                        </el-table-column>
                                    </el-table>

                                    <!-- 空状态 -->
                                    <div v-if="!auditedDepositsLoading && auditedDeposits.length === 0" style="text-align: center; padding: 40px; color: #909399;">
                                        <i class="el-icon-document" style="font-size: 48px; display: block; margin-bottom: 10px;"></i>
                                        <p>暂无审核记录</p>
                                    </div>
                                </el-tab-pane>
                            </el-tabs>
                        </el-card>

                        <!-- 拒绝原因对话框 -->
                        <el-dialog v-model="showRejectDialog" title="拒绝申请" width="500px">
                            <el-form label-width="80px">
                                <el-form-item label="拒绝原因" required>
                                    <el-input 
                                        v-model="rejectRemark" 
                                        type="textarea" 
                                        :rows="4"
                                        placeholder="请输入拒绝原因">
                                    </el-input>
                                </el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="showRejectDialog = false">取消</el-button>
                                <el-button type="danger" @click="confirmReject" :loading="rejecting">确定拒绝</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- 保证金账户列表 -->
                    <div v-else-if="activeMenu === 'deposit-accounts'" class="deposit-accounts-page">
                        <div class="page-header">
                            <h1>保证金账户管理（风控）</h1>
                            <div>
                                <el-button @click="loadDepositAccounts" icon="el-icon-refresh">刷新</el-button>
                            </div>
                        </div>

                        <el-card>
                            <!-- 筛选器 -->
                            <div style="margin-bottom: 20px;">
                                <el-radio-group v-model="accountStatusFilter" @change="loadDepositAccounts">
                                    <el-radio-button :label="null">全部账户</el-radio-button>
                                    <el-radio-button :label="1">正常账户</el-radio-button>
                                    <el-radio-button :label="2" style="--el-button-text-color: #F56C6C; --el-button-active-text-color: #FFF;">
                                        🚫 黑名单
                                    </el-radio-button>
                                </el-radio-group>
                            </div>
                            
                            <!-- 统计信息 -->
                            <el-row :gutter="20" style="margin-bottom: 20px;">
                                <el-col :span="6">
                                    <el-statistic title="账户总数" :value="depositStats.totalAccounts"></el-statistic>
                                </el-col>
                                <el-col :span="6">
                                    <el-statistic title="总保证金（元）" :value="depositStats.totalAmount" :precision="2"></el-statistic>
                                </el-col>
                                <el-col :span="6">
                                    <el-statistic title="可用保证金（元）" :value="depositStats.availableAmount" :precision="2"></el-statistic>
                                </el-col>
                                <el-col :span="6">
                                    <el-statistic title="冻结保证金（元）" :value="depositStats.frozenAmount" :precision="2"></el-statistic>
                                </el-col>
                            </el-row>

                            <!-- 保证金账户列表 -->
                            <el-table 
                                :data="depositAccounts" 
                                v-loading="depositAccountsLoading"
                                stripe
                                border>
                                <el-table-column prop="id" label="账户ID" width="100"></el-table-column>
                                <el-table-column prop="userId" label="用户ID" width="100"></el-table-column>
                                <el-table-column label="总保证金" width="150">
                                    <template #default="scope">
                                        <span style="font-weight: bold;">
                                            ¥{{ Number(scope.row.totalAmount || 0).toFixed(2) }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="可用保证金" width="150">
                                    <template #default="scope">
                                        <span style="color: #67C23A; font-weight: bold;">
                                            ¥{{ Number(scope.row.availableAmount || 0).toFixed(2) }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="冻结保证金" width="150">
                                    <template #default="scope">
                                        <span style="color: #E6A23C; font-weight: bold;">
                                            ¥{{ Number(scope.row.frozenAmount || 0).toFixed(2) }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="已退保证金" width="150">
                                    <template #default="scope">
                                        <span style="color: #909399;">
                                            ¥{{ Number(scope.row.refundedAmount || 0).toFixed(2) }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 1 ? 'success' : 'danger'">
                                            {{ scope.row.status === 1 ? '正常' : '冻结' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="创建时间" width="180">
                                    <template #default="scope">
                                        {{ formatDateTime(scope.row.createTime) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="280" fixed="right">
                                    <template #default="scope">
                                        <el-button size="small" type="primary" @click="viewUserTransactions(scope.row)">
                                            查看记录
                                        </el-button>
                                        <el-button 
                                            v-if="scope.row.status === 1"
                                            size="small" 
                                            type="warning" 
                                            @click="freezeAccount(scope.row)">
                                            冻结账户
                                        </el-button>
                                        <el-button 
                                            v-if="scope.row.status === 2"
                                            size="small" 
                                            type="success" 
                                            @click="unfreezeAccount(scope.row)">
                                            解冻账户
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-card>

                        <!-- 用户交易记录对话框 -->
                        <el-dialog 
                            v-model="showUserTransactionsDialog" 
                            :title="`用户${currentAccountUserId}的交易记录`"
                            width="80%">
                            <el-table 
                                :data="userTransactions" 
                                v-loading="userTransactionsLoading"
                                max-height="500">
                                <el-table-column prop="transactionNo" label="流水号" width="220"></el-table-column>
                                <el-table-column label="交易类型" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getTransactionTypeTag(scope.row.transactionType)">
                                            {{ getTransactionTypeName(scope.row.transactionType) }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="交易金额" width="150">
                                    <template #default="scope">
                                        <span :style="{
                                            color: (scope.row.transactionType === 1 || scope.row.transactionType === 6) ? '#67C23A' : 
                                                   (scope.row.transactionType === 2 || scope.row.transactionType === 5) ? '#F56C6C' : 
                                                   scope.row.transactionType === 3 ? '#E6A23C' : 
                                                   scope.row.transactionType === 4 ? '#409EFF' : '#909399',
                                            fontWeight: 'bold'
                                        }">
                                            {{ (scope.row.transactionType === 1 || scope.row.transactionType === 6) ? '+' : 
                                               (scope.row.transactionType === 2 || scope.row.transactionType === 5) ? '-' : 
                                               scope.row.transactionType === 3 ? '🔒' : 
                                               scope.row.transactionType === 4 ? '🔓' : '' }}¥{{ Number(scope.row.amount || 0).toFixed(2) }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="交易前余额" width="130">
                                    <template #default="scope">
                                        ¥{{ Number(scope.row.balanceBefore || 0).toFixed(2) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="交易后余额" width="130">
                                    <template #default="scope">
                                        ¥{{ Number(scope.row.balanceAfter || 0).toFixed(2) }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="description" label="说明" min-width="200" show-overflow-tooltip></el-table-column>
                                <el-table-column label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 1 ? 'success' : scope.row.status === 0 ? 'warning' : 'danger'">
                                            {{ scope.row.status === 1 ? '成功' : scope.row.status === 0 ? '待审核' : '失败' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="交易时间" width="180">
                                    <template #default="scope">
                                        {{ formatDateTime(scope.row.createTime) }}
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-dialog>
                    </div>

                    <!-- 订单发货管理 -->
                    <div v-else-if="activeMenu === 'orders-ship'" class="orders-ship-page">
                        <div class="page-header">
                            <h1>订单发货管理</h1>
                            <el-button @click="loadPendingShipOrders" icon="el-icon-refresh">刷新</el-button>
                        </div>

                        <el-card>
                            <el-tag v-if="pendingShipOrders.length > 0" type="warning" style="margin-bottom: 20px;">
                                待发货订单: {{ pendingShipOrders.length }} 个
                            </el-tag>

                            <!-- 待发货订单列表 -->
                            <el-table 
                                :data="pendingShipOrders" 
                                v-loading="ordersShipLoading"
                                stripe
                                border>
                                <el-table-column prop="orderNo" label="订单号" width="220"></el-table-column>
                                <el-table-column label="拍品ID" prop="itemId" width="100"></el-table-column>
                                <el-table-column label="买家ID" prop="buyerId" width="100"></el-table-column>
                                <el-table-column label="订单金额" width="120">
                                    <template #default="scope">
                                        <span style="color: #F56C6C; font-weight: bold;">
                                            ¥{{ scope.row.totalAmount }}
                                        </span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="保证金" width="100">
                                    <template #default="scope">
                                        ¥{{ scope.row.depositAmount }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="尾款" width="100">
                                    <template #default="scope">
                                        ¥{{ scope.row.balanceAmount }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="支付时间" width="180">
                                    <template #default="scope">
                                        {{ formatDateTime(scope.row.paymentTime) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag type="warning">待发货</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="220" fixed="right">
                                    <template #default="scope">
                                        <el-button 
                                            type="success" 
                                            size="small" 
                                            @click="openShipDialog(scope.row)">
                                            发货
                                        </el-button>
                                        <el-button 
                                            type="danger" 
                                            size="small" 
                                            @click="openRejectShipDialog(scope.row)">
                                            拒绝发货
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 空状态 -->
                            <div v-if="!ordersShipLoading && pendingShipOrders.length === 0" style="text-align: center; padding: 40px; color: #909399;">
                                <i class="el-icon-finished" style="font-size: 48px; display: block; margin-bottom: 10px;"></i>
                                <p>暂无待发货订单</p>
                            </div>
                        </el-card>

                        <!-- 发货对话框 -->
                        <el-dialog v-model="showShipDialog" title="订单发货" width="600px">
                            <el-form :model="shipForm" label-width="100px">
                                <el-form-item label="订单号">
                                    <el-input v-model="currentShipOrder.orderNo" disabled></el-input>
                                </el-form-item>
                                <el-form-item label="物流公司" required>
                                    <el-select v-model="shipForm.logisticsCompany" placeholder="请选择物流公司" style="width: 100%;">
                                        <el-option label="顺丰速运" value="SF"></el-option>
                                        <el-option label="中通快递" value="ZTO"></el-option>
                                        <el-option label="圆通速递" value="YTO"></el-option>
                                        <el-option label="申通快递" value="STO"></el-option>
                                        <el-option label="韵达快递" value="YD"></el-option>
                                        <el-option label="EMS" value="EMS"></el-option>
                                        <el-option label="德邦物流" value="DBL"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="运单号" required>
                                    <el-input v-model="shipForm.trackingNumber" placeholder="请输入运单号"></el-input>
                                </el-form-item>
                                <el-form-item label="备注">
                                    <el-input v-model="shipForm.remark" type="textarea" :rows="3" placeholder="物流备注信息"></el-input>
                                </el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="showShipDialog = false">取消</el-button>
                                <el-button type="primary" @click="confirmShip" :loading="shipping">确认发货</el-button>
                            </template>
                        </el-dialog>

                        <!-- 拒绝发货对话框 -->
                        <el-dialog v-model="showRejectShipDialog" title="拒绝发货" width="500px">
                            <el-alert 
                                title="拒绝发货将全额退款给买家" 
                                type="warning" 
                                :closable="false"
                                style="margin-bottom: 20px;">
                            </el-alert>
                            <el-form label-width="100px">
                                <el-form-item label="订单号">
                                    <el-input v-model="currentRejectShipOrder.orderNo" disabled></el-input>
                                </el-form-item>
                                <el-form-item label="退款金额">
                                    <el-input v-model="currentRejectShipOrder.totalAmount" disabled>
                                        <template #prepend>¥</template>
                                    </el-input>
                                </el-form-item>
                                <el-form-item label="拒绝原因" required>
                                    <el-select v-model="rejectShipReason" placeholder="请选择拒绝原因" style="width: 100%;">
                                        <el-option label="拍品丢失" value="拍品丢失"></el-option>
                                        <el-option label="拍品损坏" value="拍品损坏"></el-option>
                                        <el-option label="卖家不愿意出售" value="卖家不愿意出售"></el-option>
                                        <el-option label="联系不上卖家" value="联系不上卖家"></el-option>
                                        <el-option label="其他原因" value="其他原因"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="详细说明">
                                    <el-input 
                                        v-model="rejectShipDetail" 
                                        type="textarea" 
                                        :rows="4"
                                        placeholder="请输入详细说明">
                                    </el-input>
                                </el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="showRejectShipDialog = false">取消</el-button>
                                <el-button type="danger" @click="confirmRejectShip" :loading="rejectingShip">确认拒绝并退款</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- 审计日志管理 -->
                    <div v-else-if="activeMenu === 'audit-logs'" class="audit-logs-page">
                        <div class="page-header">
                            <h1>审计日志</h1>
                            <el-button @click="loadAuditLogs" icon="el-icon-refresh">刷新</el-button>
                        </div>

                        <el-card>
                            <!-- 筛选条件 -->
                            <el-form :inline="true" style="margin-bottom: 20px;">
                                <el-form-item label="用户ID">
                                    <el-input v-model="auditLogFilter.userId" placeholder="用户ID" clearable style="width: 150px;"></el-input>
                                </el-form-item>
                                <el-form-item label="操作类型">
                                    <el-select v-model="auditLogFilter.operationType" placeholder="全部" clearable style="width: 150px;">
                                        <el-option label="审核通过" value="APPROVE"></el-option>
                                        <el-option label="审核拒绝" value="REJECT"></el-option>
                                        <el-option label="删除" value="DELETE"></el-option>
                                        <el-option label="登录" value="LOGIN"></el-option>
                                        <el-option label="登出" value="LOGOUT"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="模块">
                                    <el-select v-model="auditLogFilter.module" placeholder="全部" clearable style="width: 150px;">
                                        <el-option label="保证金" value="DEPOSIT"></el-option>
                                        <el-option label="订单" value="ORDER"></el-option>
                                        <el-option label="拍品" value="ITEM"></el-option>
                                        <el-option label="拍卖会" value="SESSION"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item label="状态">
                                    <el-select v-model="auditLogFilter.success" placeholder="全部" clearable style="width: 120px;">
                                        <el-option label="成功" :value="1"></el-option>
                                        <el-option label="失败" :value="0"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="loadAuditLogs" icon="el-icon-search">查询</el-button>
                                    <el-button @click="resetAuditLogFilter">重置</el-button>
                                </el-form-item>
                            </el-form>

                            <!-- 日志列表 -->
                            <el-table 
                                :data="auditLogs" 
                                v-loading="auditLogsLoading"
                                stripe
                                border
                                style="width: 100%;">
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column label="操作用户" width="120">
                                    <template #default="scope">
                                        {{ scope.row.username }}
                                        <br>
                                        <span style="font-size: 12px; color: #909399;">ID:{{ scope.row.userId }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作类型" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getOperationTypeTag(scope.row.operationType)" size="small">
                                            {{ getOperationTypeText(scope.row.operationType) }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="模块" width="100">
                                    <template #default="scope">
                                        <el-tag size="small">{{ getModuleText(scope.row.module) }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="operationDesc" label="操作描述" min-width="200"></el-table-column>
                                <el-table-column label="IP地址" width="140">
                                    <template #default="scope">
                                        {{ scope.row.ipAddress || '-' }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="状态" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.success === 1 ? 'success' : 'danger'" size="small">
                                            {{ scope.row.success === 1 ? '成功' : '失败' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="耗时" width="80">
                                    <template #default="scope">
                                        {{ scope.row.duration }}ms
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作时间" width="180">
                                    <template #default="scope">
                                        {{ formatDateTime(scope.row.createTime) }}
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="100" fixed="right">
                                    <template #default="scope">
                                        <el-button type="text" size="small" @click="showLogDetail(scope.row)">详情</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div class="pagination-container" v-if="auditLogTotal > 0" style="margin-top: 20px; text-align: right;">
                                <el-pagination
                                    v-model:current-page="auditLogPageNum"
                                    v-model:page-size="auditLogPageSize"
                                    :page-sizes="[20, 50, 100, 200]"
                                    :total="auditLogTotal"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    @size-change="loadAuditLogs"
                                    @current-change="loadAuditLogs">
                                </el-pagination>
                            </div>

                            <!-- 空状态 -->
                            <div v-if="!auditLogsLoading && auditLogs.length === 0" style="text-align: center; padding: 40px; color: #909399;">
                                <i class="el-icon-document" style="font-size: 48px; display: block; margin-bottom: 10px;"></i>
                                <p>暂无审计日志</p>
                            </div>
                        </el-card>

                        <!-- 日志详情对话框 -->
                        <el-dialog v-model="showLogDetailDialog" title="日志详情" width="700px">
                            <el-descriptions :column="2" border v-if="currentLog">
                                <el-descriptions-item label="日志ID">{{ currentLog.id }}</el-descriptions-item>
                                <el-descriptions-item label="操作用户">{{ currentLog.username }} (ID: {{ currentLog.userId }})</el-descriptions-item>
                                <el-descriptions-item label="操作类型">{{ getOperationTypeText(currentLog.operationType) }}</el-descriptions-item>
                                <el-descriptions-item label="模块">{{ getModuleText(currentLog.module) }}</el-descriptions-item>
                                <el-descriptions-item label="操作描述" :span="2">{{ currentLog.operationDesc }}</el-descriptions-item>
                                <el-descriptions-item label="目标ID">{{ currentLog.targetId || '-' }}</el-descriptions-item>
                                <el-descriptions-item label="目标类型">{{ currentLog.targetType || '-' }}</el-descriptions-item>
                                <el-descriptions-item label="请求方法">{{ currentLog.requestMethod || '-' }}</el-descriptions-item>
                                <el-descriptions-item label="请求URL">{{ currentLog.requestUrl || '-' }}</el-descriptions-item>
                                <el-descriptions-item label="IP地址">{{ currentLog.ipAddress || '-' }}</el-descriptions-item>
                                <el-descriptions-item label="状态">
                                    <el-tag :type="currentLog.success === 1 ? 'success' : 'danger'">
                                        {{ currentLog.success === 1 ? '成功' : '失败' }}
                                    </el-tag>
                                </el-descriptions-item>
                                <el-descriptions-item label="执行时长">{{ currentLog.duration }}ms</el-descriptions-item>
                                <el-descriptions-item label="操作时间">{{ formatDateTime(currentLog.createTime) }}</el-descriptions-item>
                                <el-descriptions-item label="请求参数" :span="2">
                                    <pre style="max-height: 200px; overflow: auto; background: #f5f5f5; padding: 10px; border-radius: 4px;">{{ currentLog.requestParams || '-' }}</pre>
                                </el-descriptions-item>
                                <el-descriptions-item label="错误信息" :span="2" v-if="currentLog.errorMsg">
                                    <div style="color: #f56c6c;">{{ currentLog.errorMsg }}</div>
                                </el-descriptions-item>
                                <el-descriptions-item label="User-Agent" :span="2">
                                    <div style="font-size: 12px; color: #909399;">{{ currentLog.userAgent || '-' }}</div>
                                </el-descriptions-item>
                            </el-descriptions>
                        </el-dialog>
                    </div>

                    <!-- 参拍须知管理 -->
                    <div v-else-if="activeMenu === 'notices'" class="notices-page">
                        <div class="page-header">
                            <h1>参拍须知</h1>
                            <el-button type="primary" @click="openCreateCategory">新增分类</el-button>
                            <el-button @click="loadNoticeCategories" style="margin-left:8px;">刷新</el-button>
                        </div>
                        <el-row :gutter="20">
                            <el-col :span="8">
                                <el-card>
                                    <h3 style="margin:0 0 10px 0;">分类</h3>
                                    <el-table :data="noticeCategories" height="400" @row-click="onCategorySelect">
                                        <el-table-column prop="name" label="名称"></el-table-column>
                                        <el-table-column prop="enabled" label="启用" width="80">
                                            <template #default="scope">
                                                <el-tag :type="scope.row.enabled ? 'success' : 'info'">{{ scope.row.enabled? '是' : '否' }}</el-tag>
                                            </template>
                                        </el-table-column>
                                        <el-table-column label="操作" width="160">
                                            <template #default="scope">
                                                <el-button type="text" @click.stop="openEditCategory(scope.row)">编辑</el-button>
                                                <el-button type="text" @click.stop="deleteCategory(scope.row)" style="color:#F56C6C;">删除</el-button>
                                            </template>
                                        </el-table-column>
                                    </el-table>
                                </el-card>
                            </el-col>
                            <el-col :span="16">
                                <el-card>
                                    <div style="display:flex; justify-content:space-between; align-items:center; gap:10px;">
                                        <h3 style="margin:0;">{{ currentCategory?.name || '请选择左侧分类' }}</h3>
                                        <div>
                                            <el-button :disabled="!currentCategory" @click="triggerInsertImage('current')">插入图片(Base64)</el-button>
                                            <el-button type="primary" :disabled="!currentCategory" @click="saveCategoryContent">保存内容</el-button>
                                        </div>
                                    </div>
                                    <el-empty v-if="!currentCategory" description="请选择一个分类进行编辑"></el-empty>
                                    <div v-else>
                                        <el-row :gutter="12">
                                            <el-col :span="12">
                                                <el-input v-model="currentCategory.contentHtml" type="textarea" :rows="16" placeholder="在此粘贴文字/图片HTML，或输入说明..."></el-input>
                                            </el-col>
                                            <el-col :span="12">
                                                <div style="border:1px solid #ebeef5; border-radius:6px; padding:10px; height:100%; overflow:auto; background:#fafafa;">
                                                    <div style="font-weight:600; color:#606266; margin-bottom:6px;">预览</div>
                                                    <div v-html="currentCategory.contentHtml"></div>
                                                </div>
                                            </el-col>
                                        </el-row>
                                    </div>
                                </el-card>
                            </el-col>
                        </el-row>

                        <!-- 分类对话框（放在app内部，确保生效） -->
                        <el-dialog v-model="categoryDialogVisible" title="分类" width="520px">
                            <el-form :model="categoryForm" label-width="90px">
                                <el-form-item label="名称"><el-input v-model="categoryForm.name"></el-input></el-form-item>
                                <el-form-item label="排序"><el-input-number v-model="categoryForm.sortOrder" :min="0"></el-input-number></el-form-item>
                                <el-form-item label="启用"><el-switch v-model="categoryForm.enabled"></el-switch></el-form-item>
                                <el-form-item label="内容">
                                    <div style="display:flex; gap:10px; margin-bottom:8px;">
                                        <el-button @click="triggerInsertImage('dialog')">插入图片(Base64)</el-button>
                                    </div>
                                    <el-input v-model="categoryForm.contentHtml" type="textarea" :rows="8" placeholder="分类富文本（可包含<img>）"></el-input>
                                </el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="categoryDialogVisible=false">取消</el-button>
                                <el-button type="primary" @click="saveCategory">保存</el-button>
                            </template>
                        </el-dialog>
                        <input type="file" accept="image/*" ref="noticeImageInput" style="display:none" @change="handleInsertImageChange" />

                        <!-- 条目对话框 -->
                        <el-dialog v-model="itemDialogVisible" title="条目" width="720px">
                            <el-form :model="itemForm" label-width="90px">
                                <el-form-item label="标题"><el-input v-model="itemForm.title"></el-input></el-form-item>
                                <el-form-item label="排序"><el-input-number v-model="itemForm.sortOrder" :min="0"></el-input-number></el-form-item>
                                <el-form-item label="启用"><el-switch v-model="itemForm.enabled"></el-switch></el-form-item>
                                <el-form-item label="内容"><el-input v-model="itemForm.contentHtml" type="textarea" :rows="10"></el-input></el-form-item>
                            </el-form>
                            <template #footer>
                                <el-button @click="itemDialogVisible=false">取消</el-button>
                                <el-button type="primary" @click="saveItem">保存</el-button>
                            </template>
                        </el-dialog>
                    </div>

                    <!-- 拍卖会列表页面 -->
                    <div v-if="activeMenu === 'sessions'" class="sessions-page">
                        <div class="page-header">
                            <h1>拍卖会列表</h1>
                            <el-button type="primary" @click="goToPage('sessions/add')">
                                <i class="el-icon-plus"></i>
                                创建拍卖会
                            </el-button>
                        </div>
                        
                        <!-- 搜索筛选 -->
                        <el-card class="search-card">
                            <el-form :model="sessionSearchForm" inline>
                                <el-form-item label="拍卖会名称">
                                    <el-input v-model="sessionSearchForm.sessionName" placeholder="请输入拍卖会名称" clearable></el-input>
                                </el-form-item>
                                <el-form-item label="状态">
                                    <el-select v-model="sessionSearchForm.status" placeholder="请选择状态" clearable>
                                        <el-option label="全部" value=""></el-option>
                                        <el-option label="待开始" :value="1"></el-option>
                                        <el-option label="进行中" :value="2"></el-option>
                                        <el-option label="已结束" :value="3"></el-option>
                                        <el-option label="已取消" :value="4"></el-option>
                                    </el-select>
                                </el-form-item>
                                <el-form-item>
                                    <el-button type="primary" @click="searchSessions">搜索</el-button>
                                    <el-button @click="resetSessionSearch">重置</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>
                        
                        <!-- 拍卖会表格 -->
                        <el-card class="table-card">
                            <el-table :data="sessions" v-loading="sessionsLoading" stripe>
                                <el-table-column prop="id" label="ID" width="80"></el-table-column>
                                <el-table-column label="封面" width="120">
                                    <template #default="scope">
                                        <el-image 
                                            :src="scope.row.coverImage || '/images/default-session.jpg'" 
                                            :preview-src-list="[scope.row.coverImage || '/images/default-session.jpg']"
                                            preview-teleported="true"
                                            style="width: 80px; height: 60px; object-fit: cover;">
                                        </el-image>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="sessionName" label="拍卖会名称" min-width="200"></el-table-column>
                                <el-table-column prop="description" label="描述" min-width="150" show-overflow-tooltip></el-table-column>
                                <el-table-column prop="startTime" label="开始时间" width="160">
                                    <template #default="scope">
                                        {{ formatTime(scope.row.startTime) }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="endTime" label="结束时间" width="160">
                                    <template #default="scope">
                                        {{ formatTime(scope.row.endTime) }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="status" label="状态" width="100">
                                    <template #default="scope">
                                        <el-tag :type="getSessionStatusType(scope.row.status)">
                                            {{ getSessionStatusText(scope.row.status) }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="totalItems" label="拍品数量" width="100"></el-table-column>
                                <el-table-column prop="viewCount" label="观看人数" width="100"></el-table-column>
                                <el-table-column label="可见性" width="120">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.isVisible ? 'success' : 'info'">{{ scope.row.isVisible ? '展示' : '隐藏' }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="280" fixed="right">
                                    <template #default="scope">
                                        <el-button-group>
                                            <el-button type="primary" size="small" @click="editSession(scope.row)">编辑</el-button>
                                            <el-button type="danger" size="small" @click="deleteSession(scope.row)">删除</el-button>
                                            <el-button size="small" @click="toggleSessionVisible(scope.row)">{{ scope.row.isVisible ? '隐藏' : '展示' }}</el-button>
                                        </el-button-group>
                                    </template>
                                </el-table-column>
                            </el-table>
                            
                            <!-- 分页 -->
                            <div class="pagination-container" v-if="sessionsTotal > 0">
                                <el-pagination
                                    v-model:current-page="sessionsPage"
                                    v-model:page-size="sessionsPageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="sessionsTotal"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    @size-change="handleSessionsSizeChange"
                                    @current-change="handleSessionsCurrentChange">
                                </el-pagination>
                            </div>
                        </el-card>
                    </div>
                    
                    <!-- 创建拍卖会页面 -->
                    <div v-if="activeMenu === 'sessions/add'" class="session-create-page">
                        <div class="page-header">
                            <h1>创建拍卖会</h1>
                            <el-button @click="goToPage('sessions')">
                                <i class="el-icon-arrow-left"></i>
                                返回拍卖会列表
                            </el-button>
                        </div>
                        
                        <el-card>
                            <el-form 
                                ref="sessionForm" 
                                :model="sessionForm" 
                                :rules="sessionRules" 
                                label-width="120px"
                                size="large">
                                
                                <!-- 基本信息 -->
                                <div class="form-section">
                                    <h3 class="section-title">基本信息</h3>
                                    
                                    <el-row :gutter="20">
                                        <el-col :span="12">
                                            <el-form-item label="拍卖会名称" prop="sessionName" required>
                                                <el-input 
                                                    v-model="sessionForm.sessionName" 
                                                    placeholder="请输入拍卖会名称"
                                                    clearable>
                                                </el-input>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="12">
                                        <el-form-item label="拍卖会类型" prop="sessionType" required>
                                                <el-select 
                                                    v-model="sessionForm.sessionType" 
                                                    placeholder="请选择拍卖会类型"
                                                    style="width: 100%">
                                                    <el-option label="艺术品专场" :value="1"></el-option>
                                                    <el-option label="珠宝专场" :value="2"></el-option>
                                                    <el-option label="古董专场" :value="3"></el-option>
                                                    <el-option label="综合专场" :value="4"></el-option>
                                                </el-select>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>

                                    <el-row :gutter="20">
                                        <el-col :span="12">
                                            <el-form-item label="加价阶梯配置" prop="bidIncrementConfigId" required>
                                                <el-select v-model="sessionForm.bidIncrementConfigId" placeholder="请选择加价阶梯配置" style="width: 100%">
                                                    <el-option v-for="cfg in enabledBidConfigs" :key="cfg.id" :label="cfg.configName" :value="cfg.id" />
                                                </el-select>
                                                <div class="form-tip">仅显示启用中的配置</div>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>
                                    
                                    <el-form-item label="拍卖会描述" prop="description" required>
                                        <el-input 
                                            v-model="sessionForm.description" 
                                            type="textarea" 
                                            :rows="4"
                                            placeholder="请输入拍卖会详细描述">
                                        </el-input>
                                    </el-form-item>

                                    <el-form-item label="会场图片" required>
                                        <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                                            <div v-for="(img, idx) in sessionCreateImages" :key="idx" style="position:relative;">
                                                <el-image
                                                    :src="img"
                                                    :preview-src-list="sessionCreateImages"
                                                    :initial-index="idx"
                                                    preview-teleported="true"
                                                    style="width: 160px; height: 120px; object-fit: cover; border:1px solid #ebeef5; border-radius:6px;">
                                                </el-image>
                                                <el-button size="small" type="danger" @click="removeCreateSessionImage(idx)" style="position:absolute; top:6px; right:6px;" circle>
                                                    <i class="el-icon-close"></i>
                                                </el-button>
                                            </div>
                                            <input type="file" ref="createSessionImageInput" accept="image/*" multiple style="display:none" @change="handleCreateSessionImageSelect">
                                            <el-button size="small" type="primary" @click="$refs.createSessionImageInput.click()">添加图片</el-button>
                                            <div style="color:#909399; font-size:12px;">最多 {{ maxSessionImages }} 张</div>
                                        </div>
                                    </el-form-item>
                                </div>

                                <!-- 时间设置 -->
                                <div class="form-section">
                                    <h3 class="section-title">时间设置</h3>
                                    
                                    <el-row :gutter="20">
                                        <el-col :span="12">
                                            <el-form-item label="开始时间" prop="startTime" required>
                                                <el-date-picker
                                                    v-model="sessionForm.startTime"
                                                    type="datetime"
                                                    placeholder="选择开始时间"
                                                    style="width: 100%">
                                                </el-date-picker>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="12">
                                            <el-form-item label="结束时间" prop="endTime" required>
                                                <el-date-picker
                                                    v-model="sessionForm.endTime"
                                                    type="datetime"
                                                    placeholder="选择结束时间"
                                                    style="width: 100%">
                                                </el-date-picker>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>
                                </div>

                                <!-- 费用设置 -->
                                <div class="form-section">
                                    <h3 class="section-title">费用设置</h3>
                                    
                                    <el-row :gutter="20">
                                        <el-col :span="12">
                                            <el-form-item label="保证金比例" prop="depositRatio" required>
                                                <el-input-number
                                                    v-model="sessionForm.depositRatio"
                                                    :min="0"
                                                    :max="1"
                                                    :precision="3"
                                                    :step="0.001"
                                                    placeholder="请输入保证金比例"
                                                    style="width: 100%">
                                                </el-input-number>
                                                <div class="form-tip">例如：0.1 表示 10%</div>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="12">
                                            <el-form-item label="佣金比例" prop="commissionRatio" required>
                                                <el-input-number
                                                    v-model="sessionForm.commissionRatio"
                                                    :min="0"
                                                    :max="1"
                                                    :precision="3"
                                                    :step="0.001"
                                                    placeholder="请输入佣金比例"
                                                    style="width: 100%">
                                                </el-input-number>
                                                <div class="form-tip">例如：0.05 表示 5%</div>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>
                                </div>

                                <!-- 服务设置 -->
                                <div class="form-section">
                                    <h3 class="section-title">服务设置</h3>
                                    
                                    <el-row :gutter="20">
                                        <el-col :span="8">
                                            <el-form-item label="是否保真">
                                                <el-switch
                                                    v-model="sessionForm.isAuthentic"
                                                    active-text="是"
                                                    inactive-text="否">
                                                </el-switch>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="8">
                                            <el-form-item label="是否包邮">
                                                <el-switch
                                                    v-model="sessionForm.isFreeShipping"
                                                    active-text="是"
                                                    inactive-text="否">
                                                </el-switch>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="8">
                                            <el-form-item label="是否支持退货">
                                                <el-switch
                                                    v-model="sessionForm.isReturnable"
                                                    active-text="是"
                                                    inactive-text="否">
                                                </el-switch>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>
                                    
                                    <el-form-item label="拍卖会规则" prop="rules">
                                        <el-input 
                                            v-model="sessionForm.rules" 
                                            type="textarea" 
                                            :rows="3"
                                            placeholder="请输入拍卖会规则说明">
                                        </el-input>
                                    </el-form-item>
                                </div>

                                <!-- 拍品选择 -->
                                <div class="form-section">
                                    <h3 class="section-title">拍品选择</h3>
                                    
                                    <el-form-item label="选择拍品" prop="selectedItems" required>
                                        <el-button type="primary" @click="openItemSelector">
                                            <i class="el-icon-plus"></i>
                                            选择拍品
                                        </el-button>
                                        <span v-if="selectedItems.length > 0" class="selected-count">
                                            已选择 {{ selectedItems.length }} 个拍品
                                        </span>
                                    </el-form-item>
                                    
                                    <!-- 已选择的拍品列表 -->
                                    <div v-if="selectedItems.length > 0" class="selected-items">
                                        <el-tag 
                                            v-for="item in selectedItems" 
                                            :key="item.id" 
                                            closable 
                                            @close="removeSelectedItem(item.id)"
                                            class="item-tag">
                                            {{ item.itemName }}
                                        </el-tag>
                                    </div>
                                </div>

                                <!-- 提交按钮 -->
                                <el-form-item>
                                    <el-button type="primary" @click="submitSession" :loading="creating">
                                        创建拍卖会
                                    </el-button>
                                    <el-button @click="resetSessionForm">重置</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>
                    </div>
                    
                    <!-- 拍品选择对话框 -->
                    <el-dialog 
                        v-model="showItemSelector" 
                        title="选择拍品" 
                        width="85%"
                        :before-close="handleItemSelectorClose">
                        <div v-loading="itemsLoading">
                            <el-table 
                                :data="availableItems" 
                                @selection-change="handleItemSelectionChange"
                                ref="itemTable"
                                :row-key="row => row.id">
                                <el-table-column type="selection" width="55" :reserve-selection="true"></el-table-column>
                                
                                <!-- 拍品图片 -->
                                <el-table-column label="图片" width="120">
                                    <template #default="scope">
                                        <el-image 
                                            v-if="scope.row.coverImage || (scope.row.imageList && scope.row.imageList.length > 0)"
                                            :src="scope.row.coverImage || scope.row.imageList[0]"
                                            :preview-src-list="scope.row.imageList || [scope.row.coverImage]"
                                            fit="cover"
                                            style="width: 80px; height: 80px; border-radius: 4px; cursor: pointer;">
                                            <template #error>
                                                <div style="width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 4px;">
                                                    <i class="el-icon-picture-outline" style="font-size: 32px; color: #ccc;"></i>
                                                </div>
                                            </template>
                                        </el-image>
                                        <div v-else style="width: 80px; height: 80px; display: flex; align-items: center; justify-content: center; background: #f5f5f5; border-radius: 4px;">
                                            <i class="el-icon-picture-outline" style="font-size: 32px; color: #ccc;"></i>
                                        </div>
                                    </template>
                                </el-table-column>
                                
                                <!-- 拍品信息 -->
                                <el-table-column label="拍品信息" min-width="300">
                                    <template #default="scope">
                                        <div>
                                            <div style="font-weight: bold; font-size: 14px; margin-bottom: 4px;">
                                                {{ scope.row.itemName }}
                                            </div>
                                            <div style="font-size: 12px; color: #909399;">
                                                编号: {{ scope.row.itemCode || '无' }}
                                            </div>
                                        </div>
                                    </template>
                                </el-table-column>
                                
                                <el-table-column label="起拍价" width="120">
                                    <template #default="scope">
                                        <span style="color: #F56C6C; font-weight: bold;">
                                            ¥{{ scope.row.startingPrice }}
                                        </span>
                                    </template>
                                </el-table-column>
                                
                                <el-table-column label="估价" width="120">
                                    <template #default="scope">
                                        <span v-if="scope.row.estimatedPrice" style="color: #67C23A;">
                                            ¥{{ scope.row.estimatedPrice }}
                                        </span>
                                        <span v-else style="color: #909399;">-</span>
                                    </template>
                                </el-table-column>
                                
                                <el-table-column prop="description" label="描述" min-width="200" show-overflow-tooltip></el-table-column>
                                
                                <el-table-column label="状态" width="80">
                                    <template #default="scope">
                                        <el-tag :type="scope.row.status === 1 ? 'success' : 'info'" size="small">
                                            {{ scope.row.status === 1 ? '上架' : '下架' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                            </el-table>
                            
                            <!-- 已选择提示 -->
                            <div v-if="tempSelectedItems.length > 0" style="margin-top: 15px; padding: 10px; background: #f0f9ff; border-radius: 4px;">
                                <i class="el-icon-info" style="color: #409EFF;"></i>
                                已选择 <strong style="color: #409EFF;">{{ tempSelectedItems.length }}</strong> 个拍品
                            </div>
                        </div>
                        <template #footer>
                            <el-button @click="showItemSelector = false">取消</el-button>
                            <el-button type="primary" @click="confirmItemSelection" :disabled="tempSelectedItems.length === 0">
                                确定（{{ tempSelectedItems.length }}）
                            </el-button>
                        </template>
                    </el-dialog>
                    
                    <!-- 拍品编辑对话框 -->
                    <el-dialog 
                        v-model="showItemEditDialog" 
                        title="编辑拍品" 
                        width="60%"
                        :before-close="handleItemEditClose">
                        <el-form 
                            ref="editItemForm" 
                            :model="editItemForm" 
                            :rules="editItemRules" 
                            label-width="120px"
                            size="large">
                            
                            <el-row :gutter="20">
                                <el-col :span="12">
                                    <el-form-item label="拍品名称" prop="itemName" required>
                                        <el-input 
                                            v-model="editItemForm.itemName" 
                                            placeholder="请输入拍品名称"
                                            clearable>
                                        </el-input>
                                    </el-form-item>
                                </el-col>
                                <el-col :span="12">
                                    <el-form-item label="拍品分类" prop="categoryId" required>
                                        <el-select 
                                            v-model="editItemForm.categoryId" 
                                            placeholder="请选择拍品分类"
                                            style="width: 100%">
                                            <el-option 
                                                v-for="category in categories" 
                                                :key="category.id" 
                                                :label="category.name" 
                                                :value="category.id">
                                            </el-option>
                                        </el-select>
                                    </el-form-item>
                                </el-col>
                            </el-row>
                            
                            <el-row :gutter="20">
                                <el-col :span="12">
                                    <el-form-item label="起拍价" prop="startingPrice" required>
                                        <el-input-number 
                                            v-model="editItemForm.startingPrice" 
                                            :min="0" 
                                            :precision="2"
                                            placeholder="请输入起拍价"
                                            style="width: 100%">
                                        </el-input-number>
                                    </el-form-item>
                                </el-col>
                                <el-col :span="12">
                                    <el-form-item label="拍品编号" prop="itemCode" required>
                                        <el-input 
                                            v-model="editItemForm.itemCode" 
                                            placeholder="请输入拍品编号"
                                            clearable>
                                        </el-input>
                                    </el-form-item>
                                </el-col>
                            </el-row>

                            <el-row :gutter="20">
                                <el-col :span="12">
                                    <el-form-item label="估价">
                                        <el-input-number 
                                            v-model="editItemForm.estimatedPrice" 
                                            :min="0" 
                                            :precision="2"
                                            placeholder="请输入估价"
                                            style="width: 100%">
                                        </el-input-number>
                                    </el-form-item>
                                </el-col>
                                <el-col :span="12">
                                    <el-form-item label="尺寸">
                                        <el-input 
                                            v-model="editItemForm.dimensions" 
                                            placeholder="例如：长x宽x高（cm）"
                                            clearable>
                                        </el-input>
                                    </el-form-item>
                                </el-col>
                            </el-row>

                            <el-form-item label="材质">
                                <el-input 
                                    v-model="editItemForm.material" 
                                    placeholder="请输入材质"
                                    clearable>
                                </el-input>
                            </el-form-item>
                            
                            <el-form-item label="拍品描述" prop="description" required>
                                <el-input 
                                    v-model="editItemForm.description" 
                                    type="textarea" 
                                    :rows="4"
                                    placeholder="请输入拍品详细描述">
                                </el-input>
                            </el-form-item>
                            
                            <el-form-item label="上架状态" prop="status" required>
                                <el-radio-group v-model="editItemForm.status">
                                    <el-radio :label="0">下架</el-radio>
                                    <el-radio :label="1">上架</el-radio>
                                </el-radio-group>
                            </el-form-item>
                            
                            <!-- 拍品图片管理 -->
                            <el-form-item label="拍品图片">
                                <div class="image-upload-section">
                                    
                                    <!-- 现有图片显示 -->
                                    <div v-if="editImageFiles.length > 0" class="existing-images-section">
                                        <div class="section-title">当前图片 ({{ editImageFiles.length }}/5)</div>
                                        <div class="image-preview">
                                            <div 
                                                v-for="(file, index) in editImageFiles" 
                                                :key="index" 
                                                class="image-item">
                                                <el-image
                                                    :src="file.preview" 
                                                    :alt="file.name"
                                                    :preview-src-list="editImageFiles.map(f => f.preview)"
                                                    :initial-index="index"
                                                    style="width: 100%; height: 100%; object-fit: cover;">
                                                </el-image>
                                                <div class="image-actions">
                                                    <el-button type="danger" size="small" @click="removeEditImage(index)">删除</el-button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- 图片上传区域 -->
                                    <div v-if="editImageFiles.length < 5">
                                        <input 
                                            type="file" 
                                            ref="editImageInput" 
                                            multiple 
                                            accept="image/*" 
                                            @change="handleEditFileSelect" 
                                            style="display: none">
                                        <el-button type="primary" size="small" @click="$refs.editImageInput.click()">
                                            <el-icon class="el-icon-plus"></el-icon>
                                            添加图片
                                        </el-button>
                                    </div>
                                </div>
                            </el-form-item>
                        </el-form>
                        <template #footer>
                            <el-button @click="showItemEditDialog = false">取消</el-button>
                            <el-button type="primary" @click="submitItemEdit" :loading="editingItem">保存</el-button>
                        </template>
                    </el-dialog>
                    
                    <!-- 拍卖会编辑对话框 -->
                    <el-dialog 
                        v-model="showSessionEditDialog" 
                        title="编辑拍卖会" 
                        width="70%"
                        :before-close="handleSessionEditClose">
                        <el-form 
                            ref="editSessionForm" 
                            :model="editSessionForm" 
                            :rules="editSessionRules" 
                            label-width="120px"
                            size="large">
                            
                            <!-- 基本信息 -->
                            <div class="form-section">
                                <h3 class="section-title">基本信息</h3>
                                
                                <el-row :gutter="20">
                                    <el-col :span="12">
                                        <el-form-item label="拍卖会名称" prop="sessionName" required>
                                            <el-input 
                                                v-model="editSessionForm.sessionName" 
                                                placeholder="请输入拍卖会名称"
                                                clearable>
                                            </el-input>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="12">
                                        <el-form-item label="拍卖会类型" prop="sessionType" required>
                                            <el-select 
                                                v-model="editSessionForm.sessionType" 
                                                placeholder="请选择拍卖会类型"
                                                style="width: 100%">
                                                <el-option label="艺术品专场" :value="1"></el-option>
                                                <el-option label="珠宝专场" :value="2"></el-option>
                                                <el-option label="古董专场" :value="3"></el-option>
                                                <el-option label="综合专场" :value="4"></el-option>
                                            </el-select>
                                        </el-form-item>
                                    </el-col>
                                </el-row>
                                
                                <el-form-item label="拍卖会描述" prop="description" required>
                                    <el-input 
                                        v-model="editSessionForm.description" 
                                        type="textarea" 
                                        :rows="4"
                                        placeholder="请输入拍卖会详细描述">
                                    </el-input>
                                </el-form-item>

                                <el-form-item label="封面图片">
                                    <div style="display:flex; align-items:center; gap:12px; flex-wrap:wrap;">
                                        <div style="display:flex; gap:10px; flex-wrap:wrap;">
                                            <div v-for="(img, idx) in editSessionForm.imageList" :key="idx" style="position:relative;">
                                                <el-image
                                                    :src="img"
                                                    :preview-src-list="editSessionForm.imageList"
                                                    :initial-index="idx"
                                                    preview-teleported="true"
                                                    style="width: 160px; height: 120px; object-fit: cover; border:1px solid #ebeef5; border-radius:6px;">
                                                </el-image>
                                                <el-button size="small" type="danger" @click="removeSessionImage(idx)" style="position:absolute; top:6px; right:6px;" circle>
                                                    <i class="el-icon-close"></i>
                                                </el-button>
                                            </div>
                                        </div>
                                        <input type="file" ref="editSessionCoverInput" accept="image/*" multiple style="display:none" @change="handleEditSessionCoverSelect">
                                        <el-button size="small" type="primary" @click="$refs.editSessionCoverInput.click()">添加图片</el-button>
                                    </div>
                                </el-form-item>
                            </div>

                            <!-- 时间设置 -->
                            <div class="form-section">
                                <h3 class="section-title">时间设置</h3>
                                
                                <el-row :gutter="20">
                                    <el-col :span="12">
                                        <el-form-item label="开始时间" prop="startTime" required>
                                            <el-date-picker
                                                v-model="editSessionForm.startTime"
                                                type="datetime"
                                                placeholder="选择开始时间"
                                                style="width: 100%">
                                            </el-date-picker>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="12">
                                        <el-form-item label="结束时间" prop="endTime" required>
                                            <el-date-picker
                                                v-model="editSessionForm.endTime"
                                                type="datetime"
                                                placeholder="选择结束时间"
                                                style="width: 100%">
                                            </el-date-picker>
                                        </el-form-item>
                                    </el-col>
                                </el-row>
                            </div>

                            <!-- 费用设置 -->
                            <div class="form-section">
                                <h3 class="section-title">费用设置</h3>
                                
                                <el-row :gutter="20">
                                    <el-col :span="12">
                                        <el-form-item label="保证金比例" prop="depositRatio" required>
                                            <el-input-number
                                                v-model="editSessionForm.depositRatio"
                                                :min="0"
                                                :max="1"
                                                :precision="3"
                                                :step="0.001"
                                                placeholder="请输入保证金比例"
                                                style="width: 100%">
                                            </el-input-number>
                                            <div class="form-tip">例如：0.1 表示 10%</div>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="12">
                                        <el-form-item label="佣金比例" prop="commissionRatio" required>
                                            <el-input-number
                                                v-model="editSessionForm.commissionRatio"
                                                :min="0"
                                                :max="1"
                                                :precision="3"
                                                :step="0.001"
                                                placeholder="请输入佣金比例"
                                                style="width: 100%">
                                            </el-input-number>
                                            <div class="form-tip">例如：0.05 表示 5%</div>
                                        </el-form-item>
                                    </el-col>
                                </el-row>
                            </div>

                            <!-- 其他设置 -->
                            <div class="form-section">
                                <h3 class="section-title">其他设置</h3>
                                
                                <el-row :gutter="20">
                                    <el-col :span="8">
                                        <el-form-item label="是否保真">
                                            <el-switch v-model="editSessionForm.isAuthentic"></el-switch>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="8">
                                        <el-form-item label="是否包邮">
                                            <el-switch v-model="editSessionForm.isFreeShipping"></el-switch>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="8">
                                        <el-form-item label="是否可退">
                                            <el-switch v-model="editSessionForm.isReturnable"></el-switch>
                                        </el-form-item>
                                    </el-col>
                                </el-row>

                                <el-divider></el-divider>
                                <h4 style="margin:0 0 10px 0;">延时拍卖</h4>
                                <el-row :gutter="20">
                                    <el-col :span="6">
                                        <el-form-item label="启用延时">
                                            <el-switch v-model="editSessionForm.antiSnipingEnabled"></el-switch>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="6">
                                        <el-form-item label="阈值(秒)">
                                            <el-input-number v-model="editSessionForm.extendThresholdSec" :min="10" :max="600"></el-input-number>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="6">
                                        <el-form-item label="顺延(秒)">
                                            <el-input-number v-model="editSessionForm.extendSeconds" :min="10" :max="600"></el-input-number>
                                        </el-form-item>
                                    </el-col>
                                    <el-col :span="6">
                                        <el-form-item label="最大次数">
                                            <el-input-number v-model="editSessionForm.extendMaxTimes" :min="0" :max="100"></el-input-number>
                                        </el-form-item>
                                    </el-col>
                                </el-row>
                                
                                <el-form-item label="拍卖会规则" prop="rules">
                                    <el-input 
                                        v-model="editSessionForm.rules" 
                                        type="textarea" 
                                        :rows="4"
                                        placeholder="请输入拍卖会规则">
                                    </el-input>
                                </el-form-item>
                                <el-form-item label="加价阶梯配置">
                                    <el-select v-model="editSessionForm.bidIncrementConfigId" placeholder="请选择加价阶梯配置" style="width: 100%" :disabled="editSessionForm.status === 2">
                                        <el-option v-for="cfg in enabledBidConfigs" :key="cfg.id" :label="cfg.configName" :value="cfg.id" />
                                    </el-select>
                                    <div class="form-tip" v-if="editSessionForm.status === 2">进行中的拍卖会不可修改加价阶梯配置</div>
                                </el-form-item>
                            </div>

                            <!-- 拍品管理 -->
                            <div class="form-section">
                                <h3 class="section-title">拍品管理</h3>
                                
                                <el-form-item label="选择拍品">
                                    <el-button type="primary" @click="openEditSessionItemSelector">
                                        <i class="el-icon-plus"></i>
                                        添加拍品
                                    </el-button>
                                    <span v-if="editSessionForm.selectedItems && editSessionForm.selectedItems.length > 0" style="margin-left: 10px; color: #67c23a;">
                                        已选择 {{ editSessionForm.selectedItems.length }} 个拍品
                                    </span>
                                </el-form-item>
                                
                                <!-- 已选择的拍品列表 -->
                                <div v-if="editSessionForm.selectedItems && editSessionForm.selectedItems.length > 0" style="margin-top: 10px;">
                                    <el-tag 
                                        v-for="item in editSessionForm.selectedItems" 
                                        :key="item.id" 
                                        closable 
                                        @close="removeEditSessionItem(item.id)"
                                        style="margin-right: 10px; margin-bottom: 10px;">
                                        {{ item.itemName }}
                                    </el-tag>
                                </div>
                            </div>
                        </el-form>
                        <template #footer>
                            <el-button @click="showSessionEditDialog = false">取消</el-button>
                            <el-button type="primary" @click="submitSessionEdit" :loading="editingSession">保存</el-button>
                        </template>
                    </el-dialog>
                    
                    <!-- 上传拍品页面 -->
                    <div v-if="activeMenu === 'items/add'" class="item-upload-page">
                        <div class="page-header">
                            <h1>上传拍品</h1>
                            <el-button @click="goToPage('items')">
                                <i class="el-icon-arrow-left"></i>
                                返回拍品列表
                            </el-button>
                        </div>
                        
                        <el-card>
                            <el-form 
                                ref="uploadForm" 
                                :model="uploadForm" 
                                :rules="uploadRules" 
                                label-width="120px"
                                size="large">
                                
                                <!-- 基本信息 -->
                                <div class="form-section">
                                    <h3 class="section-title">基本信息</h3>
                                    
                                    <el-row :gutter="20">
                                        <el-col :span="12">
                                            <el-form-item label="拍品名称" prop="itemName" required>
                                                <el-input 
                                                    v-model="uploadForm.itemName" 
                                                    placeholder="请输入拍品名称"
                                                    clearable>
                                                </el-input>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="12">
                                            <el-form-item label="拍品分类" prop="categoryId" required>
                                                <el-select 
                                                    v-model="uploadForm.categoryId" 
                                                    placeholder="请选择拍品分类"
                                                    style="width: 100%">
                                                    <el-option 
                                                        v-for="category in categories" 
                                                        :key="category.id" 
                                                        :label="category.name" 
                                                        :value="category.id">
                                                    </el-option>
                                                </el-select>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>
                                    
                                    <el-row :gutter="20">
                                        <el-col :span="12">
                                            <el-form-item label="起拍价" prop="startingPrice" required>
                                                <el-input-number 
                                                    v-model="uploadForm.startingPrice" 
                                                    :min="0" 
                                                    :precision="2"
                                                    placeholder="请输入起拍价"
                                                    style="width: 100%">
                                                </el-input-number>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="12">
                                            <el-form-item label="估价" prop="estimatedPrice">
                                                <el-input-number 
                                                    v-model="uploadForm.estimatedPrice" 
                                                    :min="0" 
                                                    :precision="2"
                                                    placeholder="请输入拍品估价"
                                                    style="width: 100%">
                                                </el-input-number>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>
                                    
                                    <el-form-item label="拍品编号" prop="itemCode">
                                        <el-input 
                                            v-model="uploadForm.itemCode" 
                                            placeholder="请输入拍品编号（用于快速检索）"
                                            clearable>
                                        </el-input>
                                    </el-form-item>

                                    <el-form-item label="拍品描述" prop="description" required>
                                        <el-input 
                                            v-model="uploadForm.description" 
                                            type="textarea" 
                                            :rows="4"
                                            placeholder="请输入拍品详细描述">
                                        </el-input>
                                    </el-form-item>

                                    <el-row :gutter="20">
                                        <el-col :span="12">
                                            <el-form-item label="尺寸" prop="dimensions">
                                                <el-input 
                                                    v-model="uploadForm.dimensions" 
                                                    placeholder="例如：长x宽x高（cm）"
                                                    clearable>
                                                </el-input>
                                            </el-form-item>
                                        </el-col>
                                        <el-col :span="12">
                                            <el-form-item label="材质" prop="material">
                                                <el-input 
                                                    v-model="uploadForm.material" 
                                                    placeholder="请输入材质"
                                                    clearable>
                                                </el-input>
                                            </el-form-item>
                                        </el-col>
                                    </el-row>
                                    
                                    <el-form-item label="上架状态" prop="status" required>
                                        <el-radio-group v-model="uploadForm.status">
                                            <el-radio :label="0">下架</el-radio>
                                            <el-radio :label="1">上架</el-radio>
                                        </el-radio-group>
                                        <div class="form-tip">上架的拍品可以被添加到拍卖会中</div>
                                    </el-form-item>
                                </div>

                                <!-- 图片上传 -->
                                <div class="form-section">
                                    <h3 class="section-title">图片上传</h3>
                                    
                                    <div class="image-upload-section">
                                        <!-- 已上传图片显示 -->
                                        <div v-if="imageFiles.length > 0" class="existing-images-section">
                                            <div class="section-title">已上传图片 ({{ imageFiles.length }}/5)</div>
                                            <div class="image-preview">
                                                <div 
                                                    v-for="(file, index) in imageFiles" 
                                                    :key="index" 
                                                    class="image-item">
                                                    <el-image
                                                        :src="file.preview" 
                                                        :alt="file.name"
                                                        :preview-src-list="imageFiles.map(f => f.preview)"
                                                        :initial-index="index"
                                                        :preview-teleported="true"
                                                        style="width: 100%; height: 100%; object-fit: cover;">
                                                    </el-image>
                                                    <div class="image-actions">
                                                        <el-button type="danger" size="small" @click="removeImage(index)">删除</el-button>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <!-- 图片上传区域 -->
                                        <div v-if="imageFiles.length < 5">
                                            <el-upload
                                                ref="imageUpload"
                                                :auto-upload="false"
                                                :multiple="true"
                                                :limit="5"
                                                :on-change="handleFileSelect"
                                                :file-list="imageFileList"
                                                accept="image/*"
                                                :on-exceed="handleExceed"
                                                :before-upload="beforeUpload"
                                                :show-file-list="false">
                                                <el-button type="primary">
                                                    <el-icon class="el-icon-plus"></el-icon>
                                                    选择图片
                                                </el-button>
                                            </el-upload>
                                        </div>
                                        
                                        <div class="upload-tips">
                                            <p>• 支持jpg、png格式，单张不超过2MB</p>
                                            <p>• 最多上传5张图片</p>
                                            <p>• 可以拖拽文件到按钮上上传</p>
                                        </div>
                                    </div>
                                </div>

                                <!-- 提交按钮 -->
                                <el-form-item>
                                    <el-button type="primary" @click="submitUpload" :loading="uploading">
                                        上传拍品
                                    </el-button>
                                    <el-button @click="resetForm">重置</el-button>
                                </el-form-item>
                            </el-form>
                        </el-card>
                    </div>
                    
                    <!-- 系统配置管理 -->
                    <div v-else-if="activeMenu === 'config'" class="config-page">
                        <div class="page-header">
                            <h1>系统配置</h1>
                            <div>
                                <el-button type="primary" @click="openConfigDialog">新增配置</el-button>
                                <el-button @click="loadConfigs" style="margin-left:8px;">刷新</el-button>
                            </div>
                        </div>
                        
                        <!-- 配置分类筛选 -->
                        <el-card style="margin-bottom: 20px;">
                            <el-row :gutter="20">
                                <el-col :span="6">
                                    <el-select v-model="configFilter.category" placeholder="选择类型" clearable @change="loadConfigs">
                                        <el-option label="全部" value=""></el-option>
                                        <el-option v-for="cat in configCategories" :key="cat" :label="cat" :value="cat"></el-option>
                                    </el-select>
                                </el-col>
                                <el-col :span="6">
                                    <el-input v-model="configFilter.keyword" placeholder="搜索配置键" clearable @input="loadConfigs">
                                        <template #prefix>
                                            <i class="el-icon-search"></i>
                                        </template>
                                    </el-input>
                                </el-col>
                            </el-row>
                        </el-card>

                        <!-- 配置列表 -->
                        <el-card>
                            <el-table :data="configList" v-loading="configLoading" stripe>
                                <el-table-column prop="configKey" label="配置键" width="200"></el-table-column>
                                <el-table-column prop="configValue" label="配置值" min-width="200">
                                    <template #default="{ row }">
                                        <span v-if="row.configType === 'BOOLEAN'">{{ row.configValue === 'true' ? '是' : '否' }}</span>
                                        <span v-else>{{ row.configValue }}</span>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="configType" label="类型" width="120">
                                    <template #default="{ row }">
                                        <el-tag :type="getConfigTypeTag(row.configType)">{{ row.configType }}</el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="description" label="描述" min-width="150"></el-table-column>
                                <el-table-column prop="isSystem" label="系统配置" width="100">
                                    <template #default="{ row }">
                                        <el-tag :type="row.isSystem ? 'danger' : 'success'">
                                            {{ row.isSystem ? '是' : '否' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="isEditable" label="可编辑" width="100">
                                    <template #default="{ row }">
                                        <el-tag :type="row.isEditable ? 'success' : 'warning'">
                                            {{ row.isEditable ? '是' : '否' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column label="操作" width="150" fixed="right">
                                    <template #default="{ row }">
                                        <el-button size="small" @click="editConfig(row)" v-if="row.isEditable">编辑</el-button>
                                        <el-button size="small" type="danger" @click="deleteConfig(row)" v-if="!row.isSystem">删除</el-button>
                                    </template>
                                </el-table-column>
                            </el-table>
                        </el-card>
                    </div>

                    <!-- 用户管理 -->
                    <div v-else-if="activeMenu === 'user-management'" class="user-management-page">
                        <div class="page-header">
                            <h1>用户管理</h1>
                            <div>
                                <el-button @click="loadUsers" style="margin-left:8px;">刷新</el-button>
                                <el-button type="warning" @click="forceAllOffline">强制所有用户离线</el-button>
                                <el-button type="info" @click="cleanExpiredRecords">清理过期记录</el-button>
                            </div>
                        </div>

                        <!-- 用户统计 -->
                        <el-row :gutter="20" style="margin-bottom: 20px;">
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-value">{{ userStats.totalCount || 0 }}</div>
                                        <div class="stat-label">总用户数</div>
                                    </div>
                                    <i class="el-icon-user stat-icon"></i>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-value">{{ userStats.onlineCount || 0 }}</div>
                                        <div class="stat-label">在线用户</div>
                                    </div>
                                    <i class="el-icon-user-solid stat-icon"></i>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-value">{{ userStats.offlineCount || 0 }}</div>
                                        <div class="stat-label">离线用户</div>
                                    </div>
                                    <i class="el-icon-user-filling stat-icon"></i>
                                </el-card>
                            </el-col>
                            <el-col :span="6">
                                <el-card class="stat-card">
                                    <div class="stat-content">
                                        <div class="stat-value">{{ onlineRate }}%</div>
                                        <div class="stat-label">在线率</div>
                                    </div>
                                    <i class="el-icon-data-line stat-icon"></i>
                                </el-card>
                            </el-col>
                        </el-row>

                        <!-- 用户列表 -->
                        <el-card>
                            <el-table :data="userList" v-loading="userLoading" stripe>
                                <el-table-column prop="userId" label="用户ID" width="100"></el-table-column>
                                <el-table-column prop="username" label="用户名" width="150"></el-table-column>
                                <el-table-column prop="isOnline" label="在线状态" width="100">
                                    <template #default="{ row }">
                                        <el-tag :type="row.isOnline ? 'success' : 'info'">
                                            {{ row.isOnline ? '在线' : '离线' }}
                                        </el-tag>
                                    </template>
                                </el-table-column>
                                <el-table-column prop="loginTime" label="登录时间" width="180">
                                    <template #default="{ row }">
                                        {{ formatTime(row.loginTime) }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="lastActivity" label="最后活动" width="180">
                                    <template #default="{ row }">
                                        {{ formatTime(row.lastActivity) }}
                                    </template>
                                </el-table-column>
                                <el-table-column prop="ipAddress" label="IP地址" width="150"></el-table-column>
                                <el-table-column prop="userAgent" label="用户代理" min-width="200" show-overflow-tooltip></el-table-column>
                                <el-table-column label="操作" width="120" fixed="right">
                                    <template #default="{ row }">
                                        <el-button size="small" type="warning" @click="forceUserOffline(row)" v-if="row.isOnline">
                                            强制离线
                                        </el-button>
                                    </template>
                                </el-table-column>
                            </el-table>

                            <!-- 分页 -->
                            <div style="margin-top: 20px; text-align: center;">
                                <el-pagination
                                    v-model:current-page="userPagination.pageNum"
                                    v-model:page-size="userPagination.pageSize"
                                    :page-sizes="[10, 20, 50, 100]"
                                    :total="userPagination.total"
                                    layout="total, sizes, prev, pager, next, jumper"
                                    @size-change="loadUsers"
                                    @current-change="loadUsers">
                                </el-pagination>
                            </div>
                        </el-card>
                    </div>

                </div>
            </el-main>
        </el-container>
        
        <!-- 系统配置对话框 -->
        <el-dialog v-model="configDialogVisible" title="系统配置" width="600px">
            <el-form :model="configForm" label-width="120px">
                <el-form-item label="配置键" required>
                    <el-input v-model="configForm.configKey" placeholder="请输入配置键" :disabled="!!configForm.id"></el-input>
                </el-form-item>
                <el-form-item label="配置值" required>
                    <el-input v-model="configForm.configValue" placeholder="请输入配置值"></el-input>
                </el-form-item>
                <el-form-item label="配置类型" required>
                    <el-select v-model="configForm.configType" placeholder="请选择配置类型">
                        <el-option label="字符串" value="STRING"></el-option>
                        <el-option label="数字" value="NUMBER"></el-option>
                        <el-option label="布尔值" value="BOOLEAN"></el-option>
                        <el-option label="JSON" value="JSON"></el-option>
                    </el-select>
                </el-form-item>
                <el-form-item label="配置描述">
                    <el-input v-model="configForm.description" type="textarea" placeholder="请输入配置描述"></el-input>
                </el-form-item>
                <el-form-item label="系统配置">
                    <el-switch v-model="configForm.isSystem" :active-value="1" :inactive-value="0"></el-switch>
                </el-form-item>
                <el-form-item label="可编辑">
                    <el-switch v-model="configForm.isEditable" :active-value="1" :inactive-value="0"></el-switch>
                </el-form-item>
            </el-form>
            <template #footer>
                <el-button @click="configDialogVisible=false">取消</el-button>
                <el-button type="primary" @click="saveConfig">保存</el-button>
            </template>
        </el-dialog>
    </div>

    <!-- Element UI JS -->
    <script src="/js/vue.js"></script>
    <script src="/js/element-plus.js"></script>
    <script src="/js/axios.js"></script>
    <script src="/js/api-init.js"></script>
    
    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    userInfo: {
                        username: 'admin',
                        nickname: '超级管理员'
                    },
                    sidebarWidth: '200px',
                    isCollapse: false,
                    activeMenu: 'dashboard',
                    breadcrumbList: [
                        { name: '首页', path: 'dashboard' }
                    ],
                    stats: {
                        totalItems: 0,
                        totalSessions: 0,
                        totalUsers: 0,
                        totalBids: 0
                    },
                    
                    items: [],
                    itemsLoading: false,
                    itemsPage: 1,
                    itemsPageSize: 10,
                    itemsTotal: 0,
                    itemSearchForm: {
                        itemName: '',
                        status: ''
                    },
                    // 上传拍品相关数据
                    uploading: false,
                    imageFiles: [],
                    imageFileList: [], // el-upload组件需要的文件列表
                    categories: [
                        { id: 1, name: '艺术品' },
                        { id: 2, name: '珠宝首饰' },
                        { id: 3, name: '古董收藏' },
                        { id: 4, name: '奢侈品' },
                        { id: 5, name: '其他' }
                    ],
                    uploadForm: {
                        itemName: '',
                        categoryId: null,
                        startingPrice: null,
                        estimatedPrice: null,
                        itemCode: '',
                        description: '',
                        dimensions: '',
                        material: '',
                        status: 1, // 默认上架
                        minIncrement: null,
                        auctionDuration: 60,
                        startTime: null,
                        endTime: null
                    },
                    // 保证金审核管理
                    depositAuditTab: 'pending',
                    pendingDeposits: [],
                    depositsLoading: false,
                    depositTypeFilter: null,
                    auditedDeposits: [],
                    auditedDepositsLoading: false,
                    auditedTypeFilter: null,
                    auditedStatusFilter: null,
                    showRejectDialog: false,
                    currentRejectTransaction: null,
                    rejectRemark: '',
                    rejecting: false,
                    // 加价阶梯
                    bidIncrementConfigs: [],
                    bidIncrementLoading: false,
                    bidConfigPage: 1,
                    bidConfigPageSize: 10,
                    bidConfigTotal: 0,
                    bidConfigSearchName: '',
                    bidConfigStatus: null,
                    // 物流公司管理
                    logisticsCompanies: [],
                    logisticsLoading: false,
                    logisticsPage: 1,
                    logisticsPageSize: 10,
                    logisticsTotal: 0,
                    logisticsSearchName: '',
                    logisticsStatus: null,
                    logisticsDialogVisible: false,
                    logisticsSaving: false,
                    logisticsForm: {
                        id: null,
                        companyName: '',
                        companyCode: '',
                        baseFee: 0,
                        insuranceRate: 0,
                        sortOrder: 0,
                        enabled: 1,
                        remark: ''
                    },
                    bidConfigDialogVisible: false,
                    bidConfigSaving: false,
                    bidConfigForm: {
                        id: null,
                        configName: '',
                        status: 1,
                        description: '',
                        rules: []
                    },
                    
                    // 保证金账户列表
                    depositAccounts: [],
                    depositAccountsLoading: false,
                    accountStatusFilter: null,
                    depositStats: {
                        totalAccounts: 0,
                        totalAmount: 0,
                        availableAmount: 0,
                        frozenAmount: 0
                    },
                    showUserTransactionsDialog: false,
                    userTransactions: [],
                    userTransactionsLoading: false,
                    currentAccountUserId: null,
                    
                    // 订单发货管理
                    pendingShipOrders: [],
                    ordersShipLoading: false,
                    showShipDialog: false,
                    showRejectShipDialog: false,
                    currentShipOrder: {},
                    currentRejectShipOrder: {},
                    shipForm: {
                        logisticsCompany: '',
                        trackingNumber: '',
                        remark: ''
                    },
                    shipping: false,
                    rejectShipReason: '',
                    rejectShipDetail: '',
                    rejectingShip: false,
                    
                    // 审计日志管理
                    auditLogs: [],
                    auditLogsLoading: false,
                    auditLogFilter: {
                        userId: null,
                        operationType: '',
                        module: '',
                        success: null
                    },
                    auditLogPageNum: 1,
                    auditLogPageSize: 20,
                    auditLogTotal: 0,
                    showLogDetailDialog: false,
                    currentLog: null,
                    
                    // 参拍须知管理
                    noticeCategories: [],
                    // 已移除条目模式
                    currentCategory: null,
                    categoryDialogVisible: false,
                    categoryForm: { id: null, name: '', sortOrder: 0, enabled: 1 },
                    itemDialogVisible: false,
                    itemForm: { id: null, categoryId: null, title: '', contentHtml: '', sortOrder: 0, enabled: 1 },
                    
                    // 系统配置管理
                    configList: [],
                    configLoading: false,
                    configCategories: [],
                    configFilter: {
                        category: '',
                        keyword: ''
                    },
                    configDialogVisible: false,
                    configForm: {
                        id: null,
                        configKey: '',
                        configValue: '',
                        configType: 'STRING',
                        description: '',
                        isSystem: 0,
                        isEditable: 1
                    },
                    
                    // 用户管理
                    userList: [],
                    userLoading: false,
                    userStats: {
                        totalCount: 0,
                        onlineCount: 0,
                        offlineCount: 0
                    },
                    userPagination: {
                        pageNum: 1,
                        pageSize: 10,
                        total: 0
                    },
                    uploadRules: {
                        itemName: [
                            { required: true, message: '请输入拍品名称', trigger: 'blur' },
                            { min: 2, max: 100, message: '拍品名称长度在 2 到 100 个字符', trigger: 'blur' }
                        ],
                        categoryId: [
                            { required: true, message: '请选择拍品分类', trigger: 'change' }
                        ],
                        startingPrice: [
                            { required: true, message: '请输入起拍价', trigger: 'blur' },
                            { type: 'number', min: 0, message: '起拍价必须大于等于0', trigger: 'blur' }
                        ],
                        estimatedPrice: [
                            { type: 'number', min: 0, message: '估价必须大于等于0', trigger: 'blur' }
                        ],
                        itemCode: [
                            { min: 0, max: 50, message: '编号长度不超过50个字符', trigger: 'blur' }
                        ],
                        description: [
                            { required: true, message: '请输入拍品描述', trigger: 'blur' },
                            { min: 10, max: 1000, message: '拍品描述长度在 10 到 1000 个字符', trigger: 'blur' }
                        ]
                    },
                    // 拍卖会相关数据
                    sessions: [],
                    sessionsLoading: false,
                    sessionsPage: 1,
                    sessionsPageSize: 10,
                    sessionsTotal: 0,
                    sessionSearchForm: {
                        sessionName: '',
                        status: ''
                    },
                    creating: false,
                    showItemSelector: false,
                    selectedItems: [],
                    availableItems: [],
                    tempSelectedItems: [], // 临时选择的拍品
                    showItemEditDialog: false,
                    editingItem: false,
                    editItemForm: {
                        id: null,
                        itemName: '',
                        categoryId: null,
                        startingPrice: null,
                        itemCode: '',
                        estimatedPrice: null,
                        dimensions: '',
                        material: '',
                        description: '',
                        status: 1,  // 数字类型：0-下架，1-上架
                        images: '',
                        imageList: []
                    },
                    editImageFiles: [],
                    editImageFileList: [],
                    editItemRules: {
                        itemName: [
                            { required: true, message: '请输入拍品名称', trigger: 'blur' },
                            { min: 2, max: 100, message: '拍品名称长度在 2 到 100 个字符', trigger: 'blur' }
                        ],
                        itemCode: [
                            { required: true, message: '请输入拍品编号', trigger: 'blur' },
                            { min: 1, max: 50, message: '编号长度不超过50个字符', trigger: 'blur' }
                        ],
                        categoryId: [
                            { required: true, message: '请选择拍品分类', trigger: 'change' }
                        ],
                        startingPrice: [
                            { required: true, message: '请输入起拍价', trigger: 'blur' },
                            { type: 'number', min: 0, message: '起拍价必须大于等于0', trigger: 'blur' }
                        ],
                        description: [
                            { required: true, message: '请输入拍品描述', trigger: 'blur' },
                            { min: 10, max: 1000, message: '拍品描述长度在 10 到 1000 个字符', trigger: 'blur' }
                        ],
                        status: [
                            { required: true, message: '请选择上架状态', trigger: 'change' }
                        ]
                    },
                    showSessionEditDialog: false,
                    editingSession: false,
                    editSessionForm: {
                        id: null,
                        sessionName: '',
                        sessionType: null,
                        description: '',
                        startTime: null,
                        endTime: null,
                        depositRatio: 0.1,
                        commissionRatio: 0.05,
                        isAuthentic: false,
                        isFreeShipping: false,
                        isReturnable: false,
                        rules: '',
                        bidIncrementConfigId: null,
                        status: 1,
                        imageList: [],
                        _newCoverFiles: [],
                        selectedItems: []  // 已选择的拍品列表
                    },
                    editSessionRules: {
                        sessionName: [
                            { required: true, message: '请输入拍卖会名称', trigger: 'blur' },
                            { min: 2, max: 100, message: '拍卖会名称长度在 2 到 100 个字符', trigger: 'blur' }
                        ],
                        sessionType: [
                            { required: true, message: '请选择拍卖会类型', trigger: 'change' }
                        ],
                        description: [
                            { required: true, message: '请输入拍卖会描述', trigger: 'blur' },
                            { min: 10, max: 1000, message: '拍卖会描述长度在 10 到 1000 个字符', trigger: 'blur' }
                        ],
                        startTime: [
                            { required: true, message: '请选择开始时间', trigger: 'change' }
                        ],
                        endTime: [
                            { required: true, message: '请选择结束时间', trigger: 'change' }
                        ],
                        depositRatio: [
                            { required: true, message: '请输入保证金比例', trigger: 'blur' },
                            { type: 'number', min: 0, max: 1, message: '保证金比例必须在 0 到 1 之间', trigger: 'blur' }
                        ],
                        commissionRatio: [
                            { required: true, message: '请输入佣金比例', trigger: 'blur' },
                            { type: 'number', min: 0, max: 1, message: '佣金比例必须在 0 到 1 之间', trigger: 'blur' }
                        ],
                    },
                    sessionForm: {
                        sessionName: '',
                        sessionType: null,
                        description: '',
                        startTime: null,
                        endTime: null,
                        depositRatio: 0.1,  // 默认10%
                        commissionRatio: 0.05,  // 默认5%
                        isAuthentic: false,  // 默认不保真
                        isFreeShipping: false,  // 默认不包邮
                        isReturnable: false,  // 默认不支持退货
                        rules: '',
                        bidIncrementConfigId: null
                    },
                    enabledBidConfigs: [],
                    sessionRules: {
                        sessionName: [
                            { required: true, message: '请输入拍卖会名称', trigger: 'blur' },
                            { min: 2, max: 100, message: '拍卖会名称长度在 2 到 100 个字符', trigger: 'blur' }
                        ],
                        sessionType: [
                            { required: true, message: '请选择拍卖会类型', trigger: 'change' }
                        ],
                        description: [
                            { required: true, message: '请输入拍卖会描述', trigger: 'blur' },
                            { min: 10, max: 1000, message: '拍卖会描述长度在 10 到 1000 个字符', trigger: 'blur' }
                        ],
                        bidIncrementConfigId: [
                            { required: true, message: '请选择加价阶梯配置', trigger: 'change' }
                        ],
                        startTime: [
                            { required: true, message: '请选择开始时间', trigger: 'change' }
                        ],
                        endTime: [
                            { required: true, message: '请选择结束时间', trigger: 'change' }
                        ],
                        depositRatio: [
                            { required: true, message: '请输入保证金比例', trigger: 'blur' },
                            { type: 'number', min: 0, max: 1, message: '保证金比例必须在 0 到 1 之间', trigger: 'blur' }
                        ],
                        commissionRatio: [
                            { required: true, message: '请输入佣金比例', trigger: 'blur' },
                            { type: 'number', min: 0, max: 1, message: '佣金比例必须在 0 到 1 之间', trigger: 'blur' }
                        ],
                    }
                }
            },
            computed: {
                // 在线率计算
                onlineRate() {
                    if (this.userStats.totalCount === 0) return 0;
                    return Math.round((this.userStats.onlineCount / this.userStats.totalCount) * 100);
                }
            },
            mounted() {
                this.setupAxiosInterceptors();
                this.checkLoginStatus();
                // 初始化激活菜单：优先使用 URL Hash（如 #/items），否则默认仪表盘
                const hash = window.location.hash?.replace('#/', '') || 'dashboard';
                this.activeMenu = hash;
                this.updateBreadcrumb(this.activeMenu);
                
                this.loadStats();
                if (this.activeMenu === 'items') this.loadItems();
                if (this.activeMenu === 'sessions') this.loadSessions();
                this.loadEnabledBidConfigs();
                if (this.activeMenu === 'notices') this.loadNoticeCategories();
                if (this.activeMenu === 'config') this.loadConfigs();
                // 读取上传数量上限配置
                this.fetchUploadLimits && this.fetchUploadLimits();
            },
            methods: {
                async loadEnabledBidConfigs() {
                    try {
                        const res = await axios.get('/api/admin/bid-increment-configs/enabled');
                        this.enabledBidConfigs = res.data?.data || [];
                    } catch (e) {
                        this.enabledBidConfigs = [];
                    }
                },
                // ===== 通用图片处理方法（拍品/会场复用） =====
                fetchUploadLimits() {
                    axios.get('/api/admin/configs?keyword=upload.max').then(res => {
                        const list = res.data?.data || [];
                        const findVal = key => {
                            const it = list.find(x => x.configKey === key);
                            return it ? parseInt(it.configValue, 10) : NaN;
                        };
                        const itemMax = findVal('upload.max.item.images');
                        const sessionMax = findVal('upload.max.session.images');
                        if (!isNaN(itemMax) && itemMax > 0) this.maxItemImages = itemMax;
                        if (!isNaN(sessionMax) && sessionMax > 0) this.maxSessionImages = sessionMax;
                    }).catch(()=>{});
                },
                commonAddFiles(files, targetList, collector, max) {
                    const arr = Array.from(files || []);
                    for (const f of arr) {
                        if (targetList.length >= max) {
                            ElMessage.warning(`最多只能上传 ${max} 张图片`);
                            break;
                        }
                        if (!f || f.size === 0) continue;
                        if (collector) collector.push(f);
                        const reader = new FileReader();
                        reader.onload = () => {
                            targetList.push(reader.result);
                            this.$forceUpdate();
                        };
                        reader.readAsDataURL(f);
                    }
                },
                commonRemoveImage(targetList, idx) {
                    if (!targetList) return;
                    if (idx < 0 || idx >= targetList.length) return;
                    targetList.splice(idx, 1);
                    this.$forceUpdate();
                },
                // 格式化日期为后端可解析的字符串
                formatDateTime(date) {
                    if (!date) return null;
                    const d = new Date(date);
                    const pad = (n) => (n < 10 ? '0' + n : '' + n);
                    const yyyy = d.getFullYear();
                    const MM = pad(d.getMonth() + 1);
                    const dd = pad(d.getDate());
                    const HH = pad(d.getHours());
                    const mm = pad(d.getMinutes());
                    const ss = pad(d.getSeconds());
                    return `${yyyy}-${MM}-${dd} ${HH}:${mm}:${ss}`;
                },
                    extractFirstImage(images) {
                        if (!images) return null;
                        try {
                            const arr = JSON.parse(images);
                            return Array.isArray(arr) && arr.length > 0 ? arr[0] : null;
                        } catch (e) {
                            return null;
                        }
                    },
                // 跳转到拍品管理页面
                goToItems() {
                    window.location.href = '/auction/admin/items';
                },
                
                // 跳转到拍卖会管理页面
                goToSessions() {
                    window.location.href = '/auction/admin/sessions';
                },
                
                // 设置 axios 拦截器
                setupAxiosInterceptors() {
                    // 请求拦截器 - 在每次请求前添加 token
                    axios.interceptors.request.use(
                        config => {
                            const token = localStorage.getItem('accessToken');
                            if (token) {
                                config.headers.Authorization = `Bearer ${token}`;
                            }
                            return config;
                        },
                        error => {
                            return Promise.reject(error);
                        }
                    );
                    
                    // 响应拦截器 - 处理 401 错误和 token 刷新
                    axios.interceptors.response.use(
                        response => response,
                        async error => {
                            const originalRequest = error.config;
                            
                            // 如果是 401 错误且还没有重试过
                            if (error.response && error.response.status === 401 && !originalRequest._retry) {
                                originalRequest._retry = true;
                                
                                const refreshToken = localStorage.getItem('refreshToken');
                                if (refreshToken) {
                                    try {
                                        // 尝试刷新 token
                                        const response = await axios.post('/api/auth/refresh', { refreshToken });
                                        if (response.data.code === 200) {
                                            const newAccessToken = response.data.data.accessToken;
                                            localStorage.setItem('accessToken', newAccessToken);
                                            
                                            // 重新设置请求头并重试原请求
                                            originalRequest.headers.Authorization = `Bearer ${newAccessToken}`;
                                            return axios.request(originalRequest);
                                        }
                                    } catch (e) {
                                        console.error('Token 刷新失败:', e);
                                    }
                                }
                                
                                // 刷新失败，清除 token 并跳转登录页
                                localStorage.removeItem('accessToken');
                                localStorage.removeItem('refreshToken');
                                ElMessage.error('登录已过期，请重新登录');
                                window.location.href = '/auction/login';
                            }
                            
                            return Promise.reject(error);
                        }
                    );
                },
                
                // 检查登录状态（混合模式）
                checkLoginStatus() {
                    const accessToken = localStorage.getItem('accessToken');
                    const refreshToken = localStorage.getItem('refreshToken');
                    
                    if (!accessToken || !refreshToken) {
                        ElMessage.warning('请先登录');
                        window.location.href = '/auction/login';
                        return;
                    }
                },
                
                // 加载统计数据（仪表盘总览）
                async loadStats() {
                    try {
                        const res = await axios.get('/api/admin/dashboard/overview');
                        const data = res.data?.data || {};
                        this.stats.totalItems = data.totalItems ?? this.stats.totalItems;
                        this.stats.totalSessions = data.totalSessions ?? this.stats.totalSessions;
                        this.stats.totalUsers = data.totalUsers ?? this.stats.totalUsers;
                        this.stats.totalBids = data.totalBids ?? this.stats.totalBids;
                    } catch (error) {
                        console.error('加载统计数据失败:', error);
                    }
                },
                
                
                
                // 加载拍品列表
                async loadItems() {
                    this.itemsLoading = true;
                    try {
                        const params = {
                            page: this.itemsPage,
                            pageSize: this.itemsPageSize,
                            ...this.itemSearchForm
                        };
                        
                        const response = await axios.get('/api/admin/items', { params });
                        if (response.data.success) {
                            // 处理图片数据
                            this.items = response.data.data.map(item => {
                                // 解析图片数据 - 统一使用images字段
                                let imageList = [];
                                
                                if (item.images) {
                                    try {
                                        imageList = JSON.parse(item.images);
                                    } catch (e) {
                                        console.warn('解析拍品图片失败:', e);
                                    }
                                }
                                
                                return {
                                    ...item,
                                    imageList
                                };
                            });
                            this.itemsTotal = response.data.total || 0;
                        }
                    } catch (error) {
                        console.error('加载拍品列表失败:', error);
                        ElMessage.error('加载拍品列表失败');
                    } finally {
                        this.itemsLoading = false;
                    }
                },
                
                // 搜索拍品
                searchItems() {
                    this.itemsPage = 1;
                    this.loadItems();
                },
                
                // 重置搜索
                resetItemSearch() {
                    this.itemSearchForm = {
                        itemName: '',
                        status: ''
                    };
                    this.itemsPage = 1;
                    this.loadItems();
                },
                
                // 分页大小改变
                handleItemsSizeChange(val) {
                    this.itemsPageSize = val;
                    this.itemsPage = 1;
                    this.loadItems();
                },
                
                // 当前页改变
                handleItemsCurrentChange(val) {
                    this.itemsPage = val;
                    this.loadItems();
                },

                // ========== 保证金审核管理 ==========
                async loadPendingDeposits() {
                    this.depositsLoading = true;
                    try {
                        const response = await axios.get('/api/admin/deposits/pending', {
                            params: { type: this.depositTypeFilter }
                        });
                        if (response.data.code === 200) {
                            this.pendingDeposits = response.data.data || [];
                            // 移除弹窗提示，只在控制台记录
                            // 加载成功
                        } else {
                            ElMessage.error(response.data.message || '加载失败');
                        }
                    } catch (error) {
                        console.error('加载待审核列表失败:', error);
                        ElMessage.error('加载失败');
                    } finally {
                        this.depositsLoading = false;
                    }
                },
                
                async approveDeposit(transaction) {
                    try {
                        await ElMessageBox.confirm(
                            `确定通过该${transaction.transactionType === 1 ? '充值' : '提现'}申请吗？金额：¥${transaction.amount}`,
                            '审核确认',
                            {
                                confirmButtonText: '确定通过',
                                cancelButtonText: '取消',
                                type: 'success'
                            }
                        );
                        
                        const apiUrl = transaction.transactionType === 1 
                            ? `/api/admin/deposits/${transaction.id}/approve-recharge`
                            : `/api/admin/deposits/${transaction.id}/approve-withdraw`;
                        
                        const response = await axios.post(apiUrl, {
                            remark: '审核通过'
                        });
                        
                        if (response.data.code === 200) {
                            ElMessage.success('审核通过');
                            this.loadPendingDeposits();
                            // 如果当前在已审核标签页，也刷新已审核列表
                            if (this.depositAuditTab === 'audited') {
                                this.loadAuditedDeposits();
                            }
                        } else {
                            ElMessage.error(response.data.message || '审核失败');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('审核失败:', error);
                            ElMessage.error('审核失败');
                        }
                    }
                },
                
                openRejectDialog(transaction) {
                    this.currentRejectTransaction = transaction;
                    this.rejectRemark = '';
                    this.showRejectDialog = true;
                },
                
                async confirmReject() {
                    if (!this.rejectRemark || this.rejectRemark.trim() === '') {
                        ElMessage.error('请填写拒绝原因');
                        return;
                    }
                    
                    this.rejecting = true;
                    try {
                        const response = await axios.post(
                            `/api/admin/deposits/${this.currentRejectTransaction.id}/reject`,
                            { remark: this.rejectRemark }
                        );
                        
                        if (response.data.code === 200) {
                            ElMessage.success('已拒绝该申请');
                            this.showRejectDialog = false;
                            this.loadPendingDeposits();
                            // 如果当前在已审核标签页，也刷新已审核列表
                            if (this.depositAuditTab === 'audited') {
                                this.loadAuditedDeposits();
                            }
                        } else {
                            ElMessage.error(response.data.message || '操作失败');
                        }
                    } catch (error) {
                        console.error('拒绝失败:', error);
                        ElMessage.error('操作失败');
                    } finally {
                        this.rejecting = false;
                    }
                },
                
                // 刷新保证金审核（根据当前标签页加载对应数据）
                refreshDepositAudit() {
                    if (this.depositAuditTab === 'pending') {
                        this.loadPendingDeposits();
                    } else {
                        this.loadAuditedDeposits();
                    }
                },
                
                // 标签页切换
                onDepositAuditTabChange(tab) {
                    if (tab === 'pending') {
                        this.loadPendingDeposits();
                    } else if (tab === 'audited') {
                        this.loadAuditedDeposits();
                    }
                },
                
                // 加载已审核的记录
                async loadAuditedDeposits() {
                    this.auditedDepositsLoading = true;
                    try {
                        const params = {};
                        if (this.auditedTypeFilter !== null) {
                            params.transactionType = this.auditedTypeFilter;
                        }
                        if (this.auditedStatusFilter !== null) {
                            params.status = this.auditedStatusFilter;
                        } else {
                            // 只查询已审核的（状态1成功或2失败）
                            // 如果要同时查询两个状态，需要在后端支持
                            // 这里我们分别查询然后合并
                        }
                        
                        const response = await axios.get('/api/admin/deposit/transactions', { params });
                        if (response.data.code === 200) {
                            let allTransactions = response.data.data || [];
                            // 过滤出已审核的（状态1或2），排除待审核（0）和处理中（3）
                            this.auditedDeposits = allTransactions.filter(t => {
                                // 只显示充值(1)和提现(6)
                                const isDepositOrWithdraw = t.transactionType === 1 || t.transactionType === 2;
                                // 只显示已审核的状态（1成功或2失败）
                                const isAudited = t.status === 1 || t.status === 2;
                                
                                let matchType = true;
                                if (this.auditedTypeFilter !== null) {
                                    matchType = t.transactionType === this.auditedTypeFilter;
                                }
                                
                                let matchStatus = true;
                                if (this.auditedStatusFilter !== null) {
                                    matchStatus = t.status === this.auditedStatusFilter;
                                }
                                
                                return isDepositOrWithdraw && isAudited && matchType && matchStatus;
                            });
                        } else {
                            ElMessage.error(response.data.message || '加载失败');
                        }
                    } catch (error) {
                        console.error('加载已审核记录失败:', error);
                        ElMessage.error('加载失败');
                    } finally {
                        this.auditedDepositsLoading = false;
                    }
                },
                
                // ========== 保证金账户列表 ==========
                async loadDepositAccounts() {
                    this.depositAccountsLoading = true;
                    try {
                        const params = {};
                        if (this.accountStatusFilter !== null) {
                            params.status = this.accountStatusFilter;
                        }
                        
                        const response = await axios.get('/api/admin/deposit/accounts', { params });
                        if (response.data.code === 200) {
                            this.depositAccounts = response.data.data || [];
                            
                            // 计算统计数据
                            this.depositStats.totalAccounts = this.depositAccounts.length;
                            this.depositStats.totalAmount = this.depositAccounts.reduce((sum, acc) => 
                                sum + Number(acc.totalAmount || 0), 0);
                            this.depositStats.availableAmount = this.depositAccounts.reduce((sum, acc) => 
                                sum + Number(acc.availableAmount || 0), 0);
                            this.depositStats.frozenAmount = this.depositAccounts.reduce((sum, acc) => 
                                sum + Number(acc.frozenAmount || 0), 0);
                        } else {
                            ElMessage.error(response.data.message || '加载失败');
                        }
                    } catch (error) {
                        console.error('加载保证金账户列表失败:', error);
                        ElMessage.error('加载失败');
                    } finally {
                        this.depositAccountsLoading = false;
                    }
                },
                
                async viewUserTransactions(account) {
                    this.currentAccountUserId = account.userId;
                    this.showUserTransactionsDialog = true;
                    this.userTransactionsLoading = true;
                    
                    try {
                        const response = await axios.get('/api/admin/deposit/transactions', {
                            params: { userId: account.userId }
                        });
                        if (response.data.code === 200) {
                            this.userTransactions = response.data.data || [];
                        } else {
                            ElMessage.error(response.data.message || '加载失败');
                        }
                    } catch (error) {
                        console.error('加载用户交易记录失败:', error);
                        ElMessage.error('加载失败');
                    } finally {
                        this.userTransactionsLoading = false;
                    }
                },
                
                getTransactionTypeTag(type) {
                    const tagMap = {
                        1: 'success',  // 充值
                        2: 'warning',  // 提现
                        3: 'info',     // 冻结
                        4: 'success',  // 解冻
                        5: 'danger',   // 扣除（含违约金）
                        6: 'success'   // 退还
                    };
                    return tagMap[type] || 'info';
                },
                
                getTransactionTypeName(type) {
                    const nameMap = {
                        1: '充值',
                        2: '提现',
                        3: '冻结',
                        4: '解冻',
                        5: '扣除',
                        6: '退还'
                    };
                    return nameMap[type] || '未知';
                },
                
                // 冻结保证金账户
                async freezeAccount(account) {
                    try {
                        await ElMessageBox.confirm(
                            `确定要冻结用户${account.userId}的保证金账户吗？<br><br>` +
                            `冻结后该用户将无法：<br>` +
                            `• 充值保证金<br>` +
                            `• 提现保证金<br>` +
                            `• 参与竞拍<br>` +
                            `• 进行任何保证金操作<br><br>` +
                            `<span style="color: #E6A23C; font-weight: bold;">此操作相当于将用户拉入黑名单！</span>`,
                            '冻结账户确认',
                            {
                                confirmButtonText: '确定冻结',
                                cancelButtonText: '取消',
                                type: 'warning',
                                dangerouslyUseHTMLString: true,
                                confirmButtonClass: 'el-button--danger'
                            }
                        );
                        
                        const response = await axios.post(`/api/admin/risk/deposit-accounts/${account.id}/freeze`, {
                            reason: '管理员手动冻结账户'
                        });
                        
                        if (response.data.code === 200) {
                            ElMessage.success('账户已冻结');
                            this.loadDepositAccounts();
                        } else {
                            ElMessage.error(response.data.message || '冻结失败');
                        }
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('冻结账户失败:', e);
                            ElMessage.error('冻结失败：' + (e.message || '未知错误'));
                        }
                    }
                },
                
                // 解冻保证金账户
                async unfreezeAccount(account) {
                    try {
                        await ElMessageBox.confirm(
                            `确定要解冻用户${account.userId}的保证金账户吗？<br><br>` +
                            `解冻后该用户将恢复所有保证金操作权限。`,
                            '解冻账户确认',
                            {
                                confirmButtonText: '确定解冻',
                                cancelButtonText: '取消',
                                type: 'info',
                                dangerouslyUseHTMLString: true
                            }
                        );
                        
                        const response = await axios.post(`/api/admin/risk/deposit-accounts/${account.id}/unfreeze`, {
                            reason: '管理员手动解冻账户'
                        });
                        
                        if (response.data.code === 200) {
                            ElMessage.success('账户已解冻');
                            this.loadDepositAccounts();
                        } else {
                            ElMessage.error(response.data.message || '解冻失败');
                        }
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('解冻账户失败:', e);
                            ElMessage.error('解冻失败：' + (e.message || '未知错误'));
                        }
                    }
                },
                
                // ========== 订单发货管理 ==========
                async loadPendingShipOrders() {
                    this.ordersShipLoading = true;
                    try {
                        const response = await axios.get('/api/admin/orders/pending-ship');
                        if (response.data.code === 200) {
                            this.pendingShipOrders = response.data.data || [];
                            // 加载成功
                        } else {
                            ElMessage.error(response.data.message || '加载失败');
                        }
                    } catch (error) {
                        console.error('加载待发货订单失败:', error);
                        ElMessage.error('加载失败');
                    } finally {
                        this.ordersShipLoading = false;
                    }
                },
                
                openShipDialog(order) {
                    this.currentShipOrder = order;
                    this.shipForm = {
                        logisticsCompany: '',
                        trackingNumber: '',
                        remark: ''
                    };
                    this.showShipDialog = true;
                },
                
                async confirmShip() {
                    if (!this.shipForm.logisticsCompany) {
                        ElMessage.error('请选择物流公司');
                        return;
                    }
                    if (!this.shipForm.trackingNumber || this.shipForm.trackingNumber.trim() === '') {
                        ElMessage.error('请输入运单号');
                        return;
                    }
                    
                    this.shipping = true;
                    try {
                        const response = await axios.post(`/api/admin/orders/${this.currentShipOrder.id}/ship`, this.shipForm);
                        
                        if (response.data.code === 200) {
                            ElMessage.success('发货成功');
                            this.showShipDialog = false;
                            this.loadPendingShipOrders();
                        } else {
                            ElMessage.error(response.data.message || '发货失败');
                        }
                    } catch (error) {
                        console.error('发货失败:', error);
                        ElMessage.error('发货失败');
                    } finally {
                        this.shipping = false;
                    }
                },
                
                openRejectShipDialog(order) {
                    this.currentRejectShipOrder = order;
                    this.rejectShipReason = '';
                    this.rejectShipDetail = '';
                    this.showRejectShipDialog = true;
                },
                
                async confirmRejectShip() {
                    if (!this.rejectShipReason) {
                        ElMessage.error('请选择拒绝原因');
                        return;
                    }
                    
                    try {
                        await ElMessageBox.confirm(
                            `确定拒绝发货吗？将退款 ¥${this.currentRejectShipOrder.totalAmount} 给买家`,
                            '拒绝发货确认',
                            {
                                confirmButtonText: '确定拒绝',
                                cancelButtonText: '取消',
                                type: 'warning'
                            }
                        );
                        
                        this.rejectingShip = true;
                        const fullReason = this.rejectShipDetail 
                            ? `${this.rejectShipReason}：${this.rejectShipDetail}`
                            : this.rejectShipReason;
                        
                        const response = await axios.post(
                            `/api/admin/orders/${this.currentRejectShipOrder.id}/reject-shipment`,
                            { reason: fullReason }
                        );
                        
                        if (response.data.code === 200) {
                            ElMessage.success('已拒绝发货并退款');
                            this.showRejectShipDialog = false;
                            this.loadPendingShipOrders();
                        } else {
                            ElMessage.error(response.data.message || '操作失败');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('拒绝发货失败:', error);
                            ElMessage.error('操作失败');
                        }
                    } finally {
                        this.rejectingShip = false;
                    }
                },
                
                // ========== 审计日志管理 ==========
                async loadAuditLogs() {
                    this.auditLogsLoading = true;
                    try {
                        const response = await axios.get('/api/admin/audit-logs', {
                            params: {
                                userId: this.auditLogFilter.userId || null,
                                operationType: this.auditLogFilter.operationType || null,
                                module: this.auditLogFilter.module || null,
                                success: this.auditLogFilter.success,
                                pageNum: this.auditLogPageNum,
                                pageSize: this.auditLogPageSize
                            }
                        });
                        
                        if (response.data.code === 200) {
                            const result = response.data.data;
                            this.auditLogs = result.list || [];
                            this.auditLogTotal = result.total || 0;
                            // 加载成功
                        } else {
                            ElMessage.error(response.data.message || '加载失败');
                        }
                    } catch (error) {
                        console.error('加载审计日志失败:', error);
                        ElMessage.error('加载失败');
                    } finally {
                        this.auditLogsLoading = false;
                    }
                },
                
                resetAuditLogFilter() {
                    this.auditLogFilter = {
                        userId: null,
                        operationType: '',
                        module: '',
                        success: null
                    };
                    this.auditLogPageNum = 1;
                    this.loadAuditLogs();
                },
                
                showLogDetail(log) {
                    this.currentLog = log;
                    this.showLogDetailDialog = true;
                },
                
                getOperationTypeText(type) {
                    const typeMap = {
                        'APPROVE': '审核通过',
                        'REJECT': '审核拒绝',
                        'DELETE': '删除',
                        'CREATE': '创建',
                        'UPDATE': '更新',
                        'LOGIN': '登录',
                        'LOGOUT': '登出',
                        'SHIP': '发货',
                        'REFUND': '退款'
                    };
                    return typeMap[type] || type;
                },
                
                getOperationTypeTag(type) {
                    const tagMap = {
                        'APPROVE': 'success',
                        'REJECT': 'danger',
                        'DELETE': 'danger',
                        'CREATE': 'primary',
                        'UPDATE': 'warning',
                        'LOGIN': 'info',
                        'LOGOUT': 'info',
                        'SHIP': 'success',
                        'REFUND': 'warning'
                    };
                    return tagMap[type] || '';
                },
                
                getModuleText(module) {
                    const moduleMap = {
                        'DEPOSIT': '保证金',
                        'ORDER': '订单',
                        'ITEM': '拍品',
                        'SESSION': '拍卖会',
                        'USER': '用户'
                    };
                    return moduleMap[module] || module;
                },
                
                // ========== 参拍须知 ==========
                async loadNoticeCategories() {
                    try {
                        const res = await axios.get('/api/admin/notices/categories');
                        this.noticeCategories = res.data?.data || [];
                        if (!this.currentCategory && this.noticeCategories.length > 0) {
                            this.onCategorySelect(this.noticeCategories[0]);
                        }
                    } catch (e) {
                        console.error('加载分类失败', e);
                    }
                },
                async onCategorySelect(row) {
                    this.currentCategory = row;
                },
                openCreateCategory() {
                    this.categoryForm = { id: null, name: '', code: '', sortOrder: 0, enabled: 1 };
                    this.categoryDialogVisible = true;
                },
                openEditCategory(row) {
                    this.categoryForm = { ...row };
                    this.categoryDialogVisible = true;
                },
                async saveCategory() {
                    try {
                        if (this.categoryForm.id) {
                            await axios.put(`/api/admin/notices/categories/${this.categoryForm.id}`, this.categoryForm);
                        } else {
                            await axios.post('/api/admin/notices/categories', this.categoryForm);
                        }
                        this.categoryDialogVisible = false;
                        this.loadNoticeCategories();
                    } catch (e) {
                        console.error('保存分类失败', e);
                    }
                },
                async deleteCategory(row) {
                    try {
                        // 添加删除确认提示
                        await ElMessageBox.confirm(
                            `确定要删除分类"${row.name}"吗？删除后该分类下的所有内容将被清空，此操作不可恢复！`,
                            '删除确认',
                            {
                                confirmButtonText: '确定删除',
                                cancelButtonText: '取消',
                                type: 'warning',
                                confirmButtonClass: 'el-button--danger'
                            }
                        );
                        
                        // 用户确认后执行删除
                        await axios.delete(`/api/admin/notices/categories/${row.id}`);
                        if (this.currentCategory && this.currentCategory.id === row.id) {
                            this.currentCategory = null;
                            this.noticeItems = [];
                        }
                        ElMessage.success('分类已删除');
                        this.loadNoticeCategories();
                    } catch (e) {
                        // 如果用户点击取消，会抛出'cancel'，不需要显示错误
                        if (e !== 'cancel') {
                            console.error('删除分类失败', e);
                            ElMessage.error('删除失败：' + (e.message || '未知错误'));
                        }
                    }
                },
                async saveCategoryContent() {
                    if (!this.currentCategory) return;
                    try {
                        await axios.put(`/api/admin/notices/categories/${this.currentCategory.id}`, {
                            contentHtml: this.currentCategory.contentHtml
                        });
                        ElMessage.success('已保存');
                    } catch (e) {
                        console.error('保存内容失败', e);
                        ElMessage.error('保存失败');
                    }
                },
                triggerInsertImage(target) {
                    this._noticeInsertTarget = target; // 'current' or 'dialog'
                    this.$refs.noticeImageInput && this.$refs.noticeImageInput.click();
                },
                handleInsertImageChange(e) {
                    const file = e.target.files && e.target.files[0];
                    e.target.value = '';
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = () => {
                        const base64 = reader.result;
                        const imgTag = `<img src="${base64}" alt="image" />`;
                        if (this._noticeInsertTarget === 'dialog') {
                            this.categoryForm.contentHtml = (this.categoryForm.contentHtml || '') + imgTag;
                        } else {
                            if (!this.currentCategory) return;
                            this.currentCategory.contentHtml = (this.currentCategory.contentHtml || '') + imgTag;
                        }
                        this._noticeInsertTarget = null;
                    };
                    reader.readAsDataURL(file);
                },
                
                // 编辑拍品
                editItem(item) {
                    this.editItemForm = {
                        id: item.id,
                        itemName: item.itemName,
                        itemCode: item.itemCode || '',
                        categoryId: item.categoryId,
                        startingPrice: item.startingPrice,
                        estimatedPrice: item.estimatedPrice || null,
                        dimensions: item.dimensions || '',
                        material: item.material || '',
                        description: item.description,
                        status: Number(item.status),  // 确保status是数字类型
                        images: item.images || '',
                        imageList: item.imageList || []
                    };
                    
                    // 将现有图片转换为文件预览格式
                    this.editImageFiles = (item.imageList || []).map((imageUrl, index) => ({
                        file: null,
                        name: `existing-image-${index}.jpg`,
                        preview: imageUrl,
                        isExisting: true
                    }));
                    
                    this.showItemEditDialog = true;
                    
                    console.log('编辑拍品状态:', item.status, '→', Number(item.status));  // 调试日志
                },
                
                // 删除拍品
                async deleteItem(item) {
                    try {
                        await ElMessageBox.confirm(
                            `确定要删除拍品 "${item.itemName}" 吗？`,
                            '确认删除',
                            {
                                confirmButtonText: '确定',
                                cancelButtonText: '取消',
                                type: 'warning'
                            }
                        );
                        
                        const response = await axios.delete(`/api/admin/items/${item.id}`);
                        if (response.data.success) {
                            ElMessage.success('删除成功');
                            this.loadItems();
                        } else {
                            ElMessage.error(response.data.message || '删除失败');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('删除拍品失败:', error);
                            ElMessage.error('删除失败');
                        }
                    }
                },

                // 切换拍品状态（上下架）
                async toggleItemStatus(item) {
                    try {
                        const newStatus = item.status === 1 ? 0 : 1;
                        const action = newStatus === 1 ? '上架' : '下架';
                        
                        await ElMessageBox.confirm(
                            `确定要${action}拍品 "${item.itemName}" 吗？`,
                            `确认${action}`,
                            {
                                confirmButtonText: '确定',
                                cancelButtonText: '取消',
                                type: 'warning'
                            }
                        );
                        
                        const response = await axios.post(`/api/admin/items/${item.id}/status`, null, {
                            params: { status: newStatus }
                        });
                        
                        if (response.data.code === 200) {
                            ElMessage.success(`${action}成功`);
                            this.loadItems();
                        } else {
                            ElMessage.error(response.data.message || `${action}失败`);
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('切换拍品状态失败:', error);
                            ElMessage.error('操作失败');
                        }
                    }
                },
                
                // 获取拍品状态类型
                getItemStatusType(status) {
                    const typeMap = {
                        0: 'info',   // 下架
                        1: 'success' // 上架
                    };
                    return typeMap[status] || 'info';
                },
                
                // 获取拍品状态文本
                getItemStatusText(status) {
                    const statusMap = {
                        0: '下架',
                        1: '上架'
                    };
                    return statusMap[status] || '下架';
                },
                
                // 获取页面标题
                getPageTitle() {
                    const titleMap = {
                        'dashboard': '仪表板',
                        'items': '拍品列表',
                        'items/add': '上传拍品',
                        'sessions': '拍卖会列表',
                        'sessions/add': '创建拍卖会',
                        'deposits': '保证金管理',
                        'orders-ship': '订单发货',
                        'audit-logs': '审计日志'
                    };
                    return titleMap[this.activeMenu] || '未知页面';
                },
                
                // 格式化时间
                formatTime(time) {
                    if (!time) return '';
                    return new Date(time).toLocaleString('zh-CN');
                },
                
                
                
                // 菜单选择
                handleMenuSelect(index) {
                    this.activeMenu = index;
                    this.updateBreadcrumb(index);
                    if (index === 'items') this.loadItems();
                    if (index === 'sessions') this.loadSessions();
                    if (index === 'deposits') this.loadPendingDeposits();
                    if (index === 'deposit-accounts') this.loadDepositAccounts();
                    if (index === 'orders-ship') this.loadPendingShipOrders();
                    if (index === 'audit-logs') this.loadAuditLogs();
                    if (index === 'notices') this.loadNoticeCategories();
                    if (index === 'bid-increments') this.loadBidIncrementConfigs();
                },
                
                // 更新面包屑
                updateBreadcrumb(menu) {
                    const breadcrumbMap = {
                        'dashboard': [{ name: '首页', path: 'dashboard' }],
                        'items': [{ name: '首页', path: 'dashboard' }, { name: '拍品列表', path: 'items' }],
                        'items/add': [{ name: '首页', path: 'dashboard' }, { name: '拍品列表', path: 'items' }, { name: '上传拍品', path: 'items/add' }],
                        'sessions': [{ name: '首页', path: 'dashboard' }, { name: '拍卖会列表', path: 'sessions' }],
                        'sessions/add': [{ name: '首页', path: 'dashboard' }, { name: '拍卖会列表', path: 'sessions' }, { name: '创建拍卖会', path: 'sessions/add' }],
                        'deposits': [{ name: '首页', path: 'dashboard' }, { name: '保证金审核', path: 'deposits' }],
                        'deposit-accounts': [{ name: '首页', path: 'dashboard' }, { name: '保证金账户', path: 'deposit-accounts' }],
                        'orders-ship': [{ name: '首页', path: 'dashboard' }, { name: '订单发货', path: 'orders-ship' }],
                        'audit-logs': [{ name: '首页', path: 'dashboard' }, { name: '审计日志', path: 'audit-logs' }],
                        'config': [{ name: '首页', path: 'dashboard' }, { name: '系统配置', path: 'config' }],
                        'user-management': [{ name: '首页', path: 'dashboard' }, { name: '数据管理', path: 'user-management' }],
                        'notices': [{ name: '首页', path: 'dashboard' }, { name: '参拍须知', path: 'notices' }],
                        'bid-increments': [{ name: '首页', path: 'dashboard' }, { name: '系统管理', path: 'system-management' }, { name: '加价阶梯', path: 'bid-increments' }]
                    };
                    this.breadcrumbList = breadcrumbMap[menu] || [{ name: '首页', path: 'dashboard' }];
                },
                
                // 跳转页面
                goToPage(path) {
                    this.activeMenu = path;
                    this.updateBreadcrumb(path);
                    
                    // 特殊页面跳转和数据加载
                    if (path === 'dashboard') {
                        this.loadStats();
                    } else if (path === 'items') {
                        this.loadItems();
                    } else if (path === 'sessions') {
                        this.loadSessions();
                    } else if (path === 'deposits') {
                        this.loadPendingDeposits();
                    } else if (path === 'deposit-accounts') {
                        this.loadDepositAccounts();
                    } else if (path === 'orders-ship') {
                        this.loadPendingShipOrders();
                    } else if (path === 'audit-logs') {
                        this.loadAuditLogs();
                    } else if (path === 'notices') {
                        this.loadNoticeCategories();
                    } else if (path === 'config') {
                        this.loadConfigs();
                    } else if (path === 'user-management') {
                        this.loadUsers();
                    } else if (path === 'logistics-companies') {
                        this.loadLogisticsCompanies();
                    } else if (path === 'bid-increments') {
                        this.loadBidIncrementConfigs();
                    }
                },
                
                // 处理用户菜单命令
                handleUserCommand(command) {
                    switch (command) {
                        case 'profile':
                            // 个人资料功能
                            break;
                        case 'logout':
                            this.logout();
                            break;
                    }
                },
                
                // 上传拍品相关方法
                handleFileSelect(file, fileList) {
                    const files = [file.raw];
                    this.commonAddFiles(files, this.imageFileList.map(x=>x.url), null, this.maxItemImages);
                    files.forEach(f => {
                        if (!f || !f.type?.startsWith('image/')) return;
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imageData = { file: f, name: f.name, preview: e.target.result };
                            this.imageFiles.push(imageData);
                            this.imageFileList.push({ name: f.name, url: e.target.result, raw: f });
                            this.$forceUpdate();
                        };
                        reader.readAsDataURL(f);
                    });
                },
                
                processFiles(files) {
                    this.commonAddFiles(files, this.imageFileList.map(x=>x.url), null, this.maxItemImages);
                    Array.from(files || []).forEach(file => {
                        if (!file || !file.type?.startsWith('image/')) return;
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const imageData = { file, name: file.name, preview: e.target.result };
                            this.imageFiles.push(imageData);
                            this.imageFileList.push({ name: file.name, url: e.target.result, raw: file });
                            this.$forceUpdate();
                        };
                        reader.readAsDataURL(file);
                    });
                },
                
                removeImage(index) {
                    this.imageFiles.splice(index, 1);
                    this.imageFileList.splice(index, 1);
                },
                
                // el-upload组件相关方法
                handleExceed(files, fileList) {
                    ElMessage.error(`最多只能上传${this.maxItemImages}张图片`);
                },
                
                beforeUpload(file) {
                    // 文件上传前的验证
                    const isImage = file.type.startsWith('image/');
                    const isLt2M = file.size / 1024 / 1024 < 2;
                    
                    if (!isImage) {
                        ElMessage.error('只能上传图片文件!');
                        return false;
                    }
                    if (!isLt2M) {
                        ElMessage.error('图片大小不能超过2MB!');
                        return false;
                    }
                    return false; // 阻止自动上传，我们手动处理
                },
                
                // 编辑时的文件选择处理
                handleEditFileSelect(event) {
                    const files = Array.from(event?.target?.files || []);
                    if (!files.length) return;
                    // 数量限制：基于配置
                    if (this.editImageFiles.length + files.length > this.maxItemImages) {
                        ElMessage.error(`最多只能上传${this.maxItemImages}张图片`);
                        event.target.value = '';
                        return;
                    }
                    files.forEach(file => {
                        if (!file || !file.type?.startsWith('image/')) {
                            ElMessage.error('请选择图片文件');
                            return;
                        }
                        if (file.size > 2 * 1024 * 1024) {
                            ElMessage.error(`文件 ${file.name} 超过2MB限制`);
                            return;
                        }
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            this.editImageFiles.push({
                                file,
                                name: file.name,
                                preview: e.target.result,
                                isExisting: false
                            });
                            this.$forceUpdate();
                        };
                        reader.readAsDataURL(file);
                    });
                    // 清空input，允许重复选择同一文件
                    event.target.value = '';
                },
                
                // 删除编辑时的图片
                removeEditImage(index) {
                    if (index < 0 || index >= this.editImageFiles.length) return;
                    this.editImageFiles.splice(index, 1);
                    this.$forceUpdate();
                },
                
                
                async submitUpload() {
                    try {
                        await this.$refs.uploadForm.validate();
                        
                        if (this.imageFiles.length === 0) {
                            ElMessage.error('请至少上传一张图片');
                            return;
                        }
                        
                        this.uploading = true;
                        
                        const formData = new FormData();
                        formData.append('itemName', this.uploadForm.itemName);
                        formData.append('categoryId', this.uploadForm.categoryId);
                        formData.append('startingPrice', this.uploadForm.startingPrice);
                        if (this.uploadForm.estimatedPrice != null) {
                            formData.append('estimatedPrice', this.uploadForm.estimatedPrice);
                        }
                        if (this.uploadForm.itemCode) {
                            formData.append('itemCode', this.uploadForm.itemCode);
                        }
                        if (this.uploadForm.dimensions) {
                            formData.append('dimensions', this.uploadForm.dimensions);
                        }
                        if (this.uploadForm.material) {
                            formData.append('material', this.uploadForm.material);
                        }
                        formData.append('description', this.uploadForm.description);
                        formData.append('status', this.uploadForm.status);
                        
                        // 添加图片文件（使用不同的字段名避免与AuctionItem的images字段冲突）
                        this.imageFiles.forEach((imageFile, index) => {
                            formData.append(`imageFiles`, imageFile.file);
                        });
                        
                        const response = await axios.post('/api/admin/items/upload', formData, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        });
                        
                        if (response.data.code === 200) {
                            ElMessage.success('拍品上传成功');
                            this.resetForm();
                            this.goToPage('items');
                        } else {
                            ElMessage.error(response.data.message || '上传失败');
                        }
                    } catch (error) {
                        console.error('上传拍品失败:', error);
                        ElMessage.error('上传失败，请稍后重试');
                    } finally {
                        this.uploading = false;
                    }
                },
                
                resetForm() {
                    this.uploadForm = {
                        itemName: '',
                        categoryId: null,
                        startingPrice: null,
                        estimatedPrice: null,
                        itemCode: '',
                        description: '',
                        dimensions: '',
                        material: '',
                        status: 1, // 默认上架
                        minIncrement: null,
                        auctionDuration: 60,
                        startTime: null,
                        endTime: null
                    };
                    this.imageFiles = [];
                    this.imageFileList = [];
                    this.$refs.uploadForm?.resetFields();
                },
                
                // 拍卖会相关方法
                async loadSessions() {
                    this.sessionsLoading = true;
                    try {
                        const params = {
                            page: this.sessionsPage,
                            pageSize: this.sessionsPageSize,
                            ...this.sessionSearchForm
                        };
                        
                        const response = await axios.get('/api/admin/sessions', { params });
                        if (response.data.code === 200) {
                            this.sessions = response.data.data || [];
                            this.sessionsTotal = response.data.total || 0;
                        }
                    } catch (error) {
                        console.error('加载拍卖会列表失败:', error);
                        ElMessage.error('加载拍卖会列表失败');
                    } finally {
                        this.sessionsLoading = false;
                    }
                },
                
                searchSessions() {
                    this.sessionsPage = 1;
                    this.loadSessions();
                },
                
                resetSessionSearch() {
                    this.sessionSearchForm = {
                        sessionName: '',
                        status: ''
                    };
                    this.sessionsPage = 1;
                    this.loadSessions();
                },
                
                handleSessionsSizeChange(size) {
                    this.sessionsPageSize = size;
                    this.sessionsPage = 1;
                    this.loadSessions();
                },
                
                handleSessionsCurrentChange(page) {
                    this.sessionsPage = page;
                    this.loadSessions();
                },

                async toggleSessionVisible(row) {
                    try {
                        const target = row.isVisible ? 0 : 1;
                        await ElMessageBox.confirm(`确认将会场"${row.sessionName}"设置为${target ? '展示' : '隐藏'}吗？`, '提示', { type: 'warning' });
                        const res = await axios.post(`/api/admin/sessions/${row.id}/visible`, null, { params: { value: target } });
                        if (res.data && res.data.code === 200) {
                            ElMessage.success('已更新');
                            this.loadSessions();
                        } else {
                            ElMessage.error(res.data?.message || '更新失败');
                        }
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('更新可见性失败', e);
                            ElMessage.error('操作失败');
                        }
                    }
                },
                
                getSessionStatusType(status) {
                    const typeMap = {
                        1: 'info',    // 待开始
                        2: 'success', // 进行中
                        3: 'warning', // 已结束
                        4: 'danger'   // 已取消
                    };
                    return typeMap[status] || 'info';
                },
                
                getSessionStatusText(status) {
                    const statusMap = {
                        1: '待开始',
                        2: '进行中',
                        3: '已结束',
                        4: '已取消'
                    };
                    return statusMap[status] || '未知';
                },
                
                editSession(session) {
                    // 编辑功能
                },
                
                async deleteSession(session) {
                    try {
                        await ElMessageBox.confirm(
                            `确定要删除拍卖会 "${session.sessionName}" 吗？`,
                            '确认删除',
                            {
                                confirmButtonText: '确定',
                                cancelButtonText: '取消',
                                type: 'warning'
                            }
                        );
                        
                        const response = await axios.delete(`/api/admin/sessions/${session.id}`);
                        if (response.data.code === 200) {
                            ElMessage.success('删除成功');
                            this.loadSessions();
                        } else {
                            ElMessage.error(response.data.message || '删除失败');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('删除拍卖会失败:', error);
                            ElMessage.error('删除失败');
                        }
                    }
                },
                
                async submitSession() {
                    try {
                        await this.$refs.sessionForm.validate();
                        
                        if (this.selectedItems.length === 0) {
                            ElMessage.error('请至少选择一个拍品');
                            return;
                        }
                        
                        this.creating = true;
                        
                        const formData = {
                            ...this.sessionForm,
                            bidIncrementConfigId: this.sessionForm.bidIncrementConfigId,
                            itemIds: this.selectedItems.map(item => item.id),
                            startTime: this.formatDateTime(this.sessionForm.startTime),
                            endTime: this.formatDateTime(this.sessionForm.endTime),
                            // 布尔转整型
                            isAuthentic: this.sessionForm.isAuthentic ? 1 : 0,
                            isFreeShipping: this.sessionForm.isFreeShipping ? 1 : 0,
                            isReturnable: this.sessionForm.isReturnable ? 1 : 0,
                            // 已移除最小保证金/最大出价/最小加价
                        };
                        
                        const response = await axios.post('/api/admin/sessions', formData);
                        
                        if (response.data.code === 200) {
                            ElMessage.success('拍卖会创建成功');
                            this.resetSessionForm();
                            this.goToPage('sessions');
                        } else {
                            ElMessage.error(response.data.message || '创建失败');
                        }
                    } catch (error) {
                        console.error('创建拍卖会失败:', error);
                        ElMessage.error('创建失败，请稍后重试');
                    } finally {
                        this.creating = false;
                    }
                },
                
                resetSessionForm() {
                    this.sessionForm = {
                        sessionName: '',
                        sessionType: null,
                        description: '',
                        startTime: null,
                        endTime: null,
                        depositRatio: 0.1,  // 默认10%
                        commissionRatio: 0.05,  // 默认5%
                        isAuthentic: true,  // 默认保真
                        isFreeShipping: true,  // 默认包邮
                        isReturnable: true,  // 默认支持退货
                        rules: ''
                    };
                    this.selectedItems = [];
                    this.$refs.sessionForm?.resetFields();
                },
                
                removeSelectedItem(itemId) {
                    const index = this.selectedItems.findIndex(item => item.id === itemId);
                    if (index > -1) {
                        this.selectedItems.splice(index, 1);
                    }
                },
                
                // 拍品选择对话框相关方法
                async loadAvailableItems() {
                    try {
                        this.itemsLoading = true;
                        const response = await axios.get('/api/admin/items/available');
                        if (response.data.code === 200) {
                            this.availableItems = response.data.data || [];
                        } else {
                            ElMessage.error('加载可用拍品失败');
                        }
                    } catch (error) {
                        console.error('加载可用拍品失败:', error);
                        ElMessage.error('加载可用拍品失败');
                    } finally {
                        this.itemsLoading = false;
                    }
                },
                
                handleItemSelectionChange(selection) {
                    this.tempSelectedItems = selection;
                },
                
                confirmItemSelection() {
                    // 判断是在编辑拍卖会还是创建拍卖会
                    if (this.showSessionEditDialog) {
                        // 编辑拍卖会：添加到 editSessionForm.selectedItems
                        const existingIds = (this.editSessionForm.selectedItems || []).map(item => item.id);
                        const newItems = this.tempSelectedItems.filter(item => !existingIds.includes(item.id));
                        this.editSessionForm.selectedItems = [...(this.editSessionForm.selectedItems || []), ...newItems];
                        ElMessage.success(`已添加 ${newItems.length} 个拍品`);
                    } else {
                        // 创建拍卖会：添加到 selectedItems
                        const existingIds = this.selectedItems.map(item => item.id);
                        const newItems = this.tempSelectedItems.filter(item => !existingIds.includes(item.id));
                        this.selectedItems = [...this.selectedItems, ...newItems];
                        ElMessage.success(`已选择 ${newItems.length} 个拍品`);
                    }
                    this.showItemSelector = false;
                    this.tempSelectedItems = [];
                },
                
                handleItemSelectorClose() {
                    this.showItemSelector = false;
                    this.tempSelectedItems = [];
                },
                
                openItemSelector() {
                    this.showItemSelector = true;
                    this.loadAvailableItems();
                },
                
                
                async submitItemEdit() {
                    try {
                        await this.$refs.editItemForm.validate();
                        
                        if (this.editImageFiles.length === 0) {
                            ElMessage.error('请至少上传一张图片');
                            return;
                        }
                        
                        this.editingItem = true;
                        
                        // 准备FormData用于文件上传
                        const formData = new FormData();
                        formData.append('id', this.editItemForm.id);
                        formData.append('itemName', this.editItemForm.itemName);
                        formData.append('categoryId', this.editItemForm.categoryId);
                        formData.append('itemCode', this.editItemForm.itemCode || '');
                        formData.append('startingPrice', this.editItemForm.startingPrice);
                        if (this.editItemForm.estimatedPrice != null) formData.append('estimatedPrice', this.editItemForm.estimatedPrice);
                        if (this.editItemForm.dimensions) formData.append('dimensions', this.editItemForm.dimensions);
                        if (this.editItemForm.material) formData.append('material', this.editItemForm.material);
                        formData.append('description', this.editItemForm.description);
                        formData.append('status', this.editItemForm.status);
                        
                        // 添加当前图片列表（仅保留已存在的URL，过滤掉base64预览）
                        const currentImageUrls = this.editImageFiles
                            .filter(file => file.isExisting && typeof file.preview === 'string' && !file.preview.startsWith('data:'))
                            .map(file => file.preview);
                        formData.append('currentImages', JSON.stringify(currentImageUrls));
                        
                        // 添加图片文件（只添加新上传的文件）
                        let hasNewImages = false;
                        this.editImageFiles.forEach((imageFile, index) => {
                            if (!imageFile.isExisting && imageFile.file) {
                                formData.append('imageFiles', imageFile.file);
                                hasNewImages = true;
                            }
                        });
                        
                        // 如果没有新图片，也要调用API更新基本信息
                        if (!hasNewImages) {
                            // 构建当前图片列表（仅保留已存在的URL，过滤掉base64预览）
                            const currentImageUrls = this.editImageFiles
                                .filter(file => file.isExisting && typeof file.preview === 'string' && !file.preview.startsWith('data:'))
                                .map(file => file.preview);
                            
                            // 如果没有新图片，使用JSON格式的API
                            const jsonData = {
                                id: this.editItemForm.id,
                                itemName: this.editItemForm.itemName,
                                categoryId: this.editItemForm.categoryId,
                                itemCode: this.editItemForm.itemCode || '',
                                startingPrice: this.editItemForm.startingPrice,
                                estimatedPrice: this.editItemForm.estimatedPrice,
                                dimensions: this.editItemForm.dimensions,
                                material: this.editItemForm.material,
                                description: this.editItemForm.description,
                                status: this.editItemForm.status,
                                images: JSON.stringify(currentImageUrls) // 更新图片列表
                            };
                            
                            const response = await axios.put(`/api/admin/items/${this.editItemForm.id}`, jsonData);
                            
                            if (response.data.code === 200) {
                                ElMessage.success('拍品更新成功');
                                this.showItemEditDialog = false;
                                this.loadItems();
                            } else {
                                ElMessage.error(response.data.message || '更新失败');
                            }
                            return;
                        }
                        
                        const response = await axios.put(`/api/admin/items/${this.editItemForm.id}/with-images`, formData, {
                            headers: {
                                'Content-Type': 'multipart/form-data'
                            }
                        });
                        
                        if (response.data.code === 200) {
                            ElMessage.success('拍品更新成功');
                            this.showItemEditDialog = false;
                            this.loadItems(); // 重新加载拍品列表
                        } else {
                            ElMessage.error(response.data.message || '更新失败');
                        }
                    } catch (error) {
                        console.error('更新拍品失败:', error);
                        ElMessage.error('更新失败，请稍后重试');
                    } finally {
                        this.editingItem = false;
                    }
                },
                
                handleItemEditClose() {
                    this.showItemEditDialog = false;
                    this.editItemForm = {
                        id: null,
                        itemName: '',
                        categoryId: null,
                        startingPrice: null,
                        description: '',
                        status: 1,
                        images: '',
                        imageList: []
                    };
                    this.editImageFiles = [];
                },
                
                async deleteItem(item) {
                    try {
                        await ElMessageBox.confirm(
                            `确定要删除拍品"${item.itemName}"吗？此操作不可恢复！`,
                            '删除确认',
                            {
                                confirmButtonText: '确定删除',
                                cancelButtonText: '取消',
                                type: 'warning',
                            }
                        );
                        
                        const response = await axios.delete(`/api/admin/items/${item.id}`);
                        
                        if (response.data.code === 200) {
                            ElMessage.success('删除成功');
                            this.loadItems();
                        } else {
                            ElMessage.error(response.data.message || '删除失败');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('删除拍品失败:', error);
                            ElMessage.error('删除失败');
                        }
                    }
                },
                
                // 拍卖会编辑和删除方法
                editSession(session) {
                    this.editSessionForm = {
                        id: session.id,
                        sessionName: session.sessionName,
                        sessionType: session.sessionType,
                        description: session.description,
                        startTime: session.startTime ? new Date(session.startTime) : null,
                        endTime: session.endTime ? new Date(session.endTime) : null,
                        depositRatio: session.depositRatio,
                        commissionRatio: session.commissionRatio,
                        // 整型转布尔
                        isAuthentic: session.isAuthentic == 1,
                        isFreeShipping: session.isFreeShipping == 1,
                        isReturnable: session.isReturnable == 1,
                        antiSnipingEnabled: (session.antiSnipingEnabled ?? 1) == 1,
                        extendThresholdSec: session.extendThresholdSec ?? 60,
                        extendSeconds: session.extendSeconds ?? 60,
                        extendMaxTimes: session.extendMaxTimes ?? 5,
                        rules: session.rules,
                        bidIncrementConfigId: session.bidIncrementConfigId ?? null,
                        imageList: this.normalizeSessionImages(session),
                        _newCoverFiles: [],
                        selectedItems: []  // 初始化为空，稍后加载
                    };
                    
                    // 加载该拍卖会的拍品列表
                    this.loadSessionItems(session.id);
                    
                    this.showSessionEditDialog = true;
                },
                
                // 加载拍卖会的拍品列表
                async loadSessionItems(sessionId) {
                    try {
                        const response = await axios.get(`/api/admin/sessions/${sessionId}/items`);
                        if (response.data.code === 200) {
                            this.editSessionForm.selectedItems = response.data.data || [];
                        }
                    } catch (error) {
                        console.error('加载拍卖会拍品失败:', error);
                    }
                },
                
                // 打开编辑拍卖会的拍品选择器
                openEditSessionItemSelector() {
                    this.showItemSelector = true;
                    this.loadAvailableItems();
                },
                
                // 从编辑拍卖会中移除拍品
                removeEditSessionItem(itemId) {
                    const index = this.editSessionForm.selectedItems.findIndex(item => item.id === itemId);
                    if (index > -1) {
                        this.editSessionForm.selectedItems.splice(index, 1);
                        ElMessage.success('已移除拍品');
                    }
                },
                
                async submitSessionEdit() {
                    try {
                        await this.$refs.editSessionForm.validate();
                        
                        this.editingSession = true;
                        
                        // 如果有新封面文件，用multipart提交；否则走原JSON
                        // 若有新增图片或删除动作，用multipart提交 imageList
                        if (this.editSessionForm._newCoverFiles.length > 0 || true) {
                            const fd = new FormData();
                            fd.append('sessionName', this.editSessionForm.sessionName ?? '');
                            if (this.editSessionForm.sessionType != null) fd.append('sessionType', this.editSessionForm.sessionType);
                            fd.append('description', this.editSessionForm.description ?? '');
                            if (this.editSessionForm.startTime) fd.append('startTime', this.formatDateTime(this.editSessionForm.startTime));
                            if (this.editSessionForm.endTime) fd.append('endTime', this.formatDateTime(this.editSessionForm.endTime));
                            if (this.editSessionForm.depositRatio != null) fd.append('depositRatio', this.editSessionForm.depositRatio);
                            if (this.editSessionForm.commissionRatio != null) fd.append('commissionRatio', this.editSessionForm.commissionRatio);
                            fd.append('isAuthentic', this.editSessionForm.isAuthentic ? 1 : 0);
                            fd.append('isFreeShipping', this.editSessionForm.isFreeShipping ? 1 : 0);
                            fd.append('isReturnable', this.editSessionForm.isReturnable ? 1 : 0);
                            fd.append('antiSnipingEnabled', this.editSessionForm.antiSnipingEnabled ? 1 : 0);
                            if (this.editSessionForm.extendThresholdSec != null) fd.append('extendThresholdSec', this.editSessionForm.extendThresholdSec);
                            if (this.editSessionForm.extendSeconds != null) fd.append('extendSeconds', this.editSessionForm.extendSeconds);
                            if (this.editSessionForm.extendMaxTimes != null) fd.append('extendMaxTimes', this.editSessionForm.extendMaxTimes);
                            if (this.editSessionForm.rules != null) fd.append('rules', this.editSessionForm.rules);
                            if (this.editSessionForm.bidIncrementConfigId != null) fd.append('bidIncrementConfigId', this.editSessionForm.bidIncrementConfigId);
                            // 附带当前图片列表：仅保留已存在URL
                            const sessionCurrentUrls = (this.editSessionForm.imageList || []).filter(u => typeof u === 'string' && !u.startsWith('data:'));
                            fd.append('currentImages', JSON.stringify(sessionCurrentUrls));
                            // 新增文件：严格与仍存在的base64数量对齐
                            const base64Count = (this.editSessionForm.imageList || []).filter(u => typeof u === 'string' && u.startsWith('data:')).length;
                            (this.editSessionForm._newCoverFiles || []).slice(0, base64Count).forEach(f => fd.append('coverImages', f));
                            // 添加拍品ID列表
                            if (this.editSessionForm.selectedItems && this.editSessionForm.selectedItems.length > 0) {
                                fd.append('itemIds', JSON.stringify(this.editSessionForm.selectedItems.map(item => item.id)));
                            }
                            const response = await axios.put(`/api/admin/sessions/${this.editSessionForm.id}/with-cover`, fd, { headers: { 'Content-Type': 'multipart/form-data' } });
                            if (response.data.code === 200) {
                                ElMessage.success('拍卖会更新成功');
                                this.showSessionEditDialog = false;
                                this.loadSessions();
                            } else {
                                ElMessage.error(response.data.message || '更新失败');
                            }
                        } else {
                            const formData = {
                                ...this.editSessionForm,
                                startTime: this.formatDateTime(this.editSessionForm.startTime),
                                endTime: this.formatDateTime(this.editSessionForm.endTime),
                                isAuthentic: this.editSessionForm.isAuthentic ? 1 : 0,
                                isFreeShipping: this.editSessionForm.isFreeShipping ? 1 : 0,
                                isReturnable: this.editSessionForm.isReturnable ? 1 : 0,
                                antiSnipingEnabled: this.editSessionForm.antiSnipingEnabled ? 1 : 0,
                                itemIds: this.editSessionForm.selectedItems ? this.editSessionForm.selectedItems.map(item => item.id) : [],
                                bidIncrementConfigId: this.editSessionForm.bidIncrementConfigId
                            };
                            const response = await axios.put(`/api/admin/sessions/${this.editSessionForm.id}`, formData);
                            if (response.data.code === 200) {
                                ElMessage.success('拍卖会更新成功');
                                this.showSessionEditDialog = false;
                                this.loadSessions();
                            } else {
                                ElMessage.error(response.data.message || '更新失败');
                            }
                        }
                        
                    } catch (error) {
                        console.error('更新拍卖会失败:', error);
                        ElMessage.error('更新失败，请稍后重试');
                    } finally {
                        this.editingSession = false;
                    }
                },

                handleEditSessionCoverSelect(e) {
                    const files = Array.from(e?.target?.files || []);
                    if (!files.length) return;
                    files.forEach(f => {
                        this.editSessionForm._newCoverFiles.push(f);
                        const reader = new FileReader();
                        reader.onload = () => {
                            this.editSessionForm.imageList.push(reader.result);
                            this.$forceUpdate();
                        };
                        reader.readAsDataURL(f);
                    });
                    e.target.value = '';
                },

                removeSessionImage(idx) {
                    const img = this.editSessionForm.imageList[idx];
                    this.editSessionForm.imageList.splice(idx, 1);
                    if (typeof img === 'string' && img.startsWith('data:') && this.editSessionForm._newCoverFiles && this.editSessionForm._newCoverFiles.length > 0) {
                        this.editSessionForm._newCoverFiles.shift();
                    }
                    this.$forceUpdate();
                },

                normalizeSessionImages(session) {
                    // 兼容：如果已有 images(JSON数组字符串) 则解析；否则退回 coverImage 单图
                    try {
                        if (session.images) {
                            const arr = JSON.parse(session.images);
                            if (Array.isArray(arr)) return arr;
                        }
                    } catch (_) {}
                    return session.coverImage ? [session.coverImage] : [];
                },
                
                handleSessionEditClose() {
                    this.showSessionEditDialog = false;
                    this.editSessionForm = {
                        id: null,
                        sessionName: '',
                        sessionType: null,
                        description: '',
                        startTime: null,
                        endTime: null,
                        depositRatio: 0.1,
                        commissionRatio: 0.05,
                        isAuthentic: false,
                        isFreeShipping: false,
                        isReturnable: false,
                        rules: '',
                        coverImage: null,
                        _newCoverFile: null
                    };
                },
                
                async deleteSession(session) {
                    try {
                        await ElMessageBox.confirm(
                            `确定要删除拍卖会"${session.sessionName}"吗？此操作不可恢复！`,
                            '删除确认',
                            {
                                confirmButtonText: '确定删除',
                                cancelButtonText: '取消',
                                type: 'warning',
                            }
                        );
                        
                        const response = await axios.delete(`/api/admin/sessions/${session.id}`);
                        
                        if (response.data.code === 200) {
                            ElMessage.success('删除成功');
                            this.loadSessions();
                        } else {
                            ElMessage.error(response.data.message || '删除失败');
                        }
                    } catch (error) {
                        if (error !== 'cancel') {
                            console.error('删除拍卖会失败:', error);
                            ElMessage.error('删除失败');
                        }
                    }
                },
                
                // ========== 系统配置管理 ==========
                async loadConfigs() {
                    this.configLoading = true;
                    try {
                        // 构建查询参数
                        const params = new URLSearchParams();
                        if (this.configFilter.category) {
                            params.append('configType', this.configFilter.category);
                        }
                        if (this.configFilter.keyword) {
                            params.append('keyword', this.configFilter.keyword);
                        }
                        
                        const url = `/api/admin/configs${params.toString() ? '?' + params.toString() : ''}`;
                        const res = await axios.get(url);
                        const list = res.data?.data || [];
                        // 按更新时间倒序，新增/最近修改的排在最前
                        this.configList = list.sort((a, b) => {
                            const ta = a.updateTime ? new Date(a.updateTime).getTime() : 0;
                            const tb = b.updateTime ? new Date(b.updateTime).getTime() : 0;
                            return tb - ta;
                        });
                        
                        // 从配置列表中提取分类
                        const categories = [...new Set(this.configList.map(config => config.configType || 'STRING'))];
                        this.configCategories = categories;
                    } catch (e) {
                        console.error('加载配置失败:', e);
                        ElMessage.error('加载配置失败');
                    } finally {
                        this.configLoading = false;
                    }
                },

                // ========== 加价阶梯配置 ==========
                async loadBidIncrementConfigs() {
                    this.bidIncrementLoading = true;
                    try {
                        const params = new URLSearchParams();
                        params.append('page', this.bidConfigPage);
                        params.append('pageSize', this.bidConfigPageSize);
                        if (this.bidConfigSearchName) params.append('configName', this.bidConfigSearchName);
                        if (this.bidConfigStatus !== null && this.bidConfigStatus !== undefined && this.bidConfigStatus !== '') params.append('status', this.bidConfigStatus);
                        const url = `/api/admin/bid-increment-configs${params.toString() ? '?' + params.toString() : ''}`;
                        const res = await axios.get(url);
                        const data = res.data?.data;
                        // 兼容两种返回结构：数组 or { records, total }
                        if (Array.isArray(data)) {
                            this.bidIncrementConfigs = data;
                            this.bidConfigTotal = data.length;
                        } else {
                            this.bidIncrementConfigs = data?.records || [];
                            this.bidConfigTotal = data?.total || 0;
                        }
                    } catch (e) {
                        console.error('加载加价阶梯失败:', e);
                        ElMessage.error('加载失败');
                    } finally {
                        this.bidIncrementLoading = false;
                    }
                },
                searchBidConfigs() {
                    this.bidConfigPage = 1;
                    this.loadBidIncrementConfigs();
                },
                resetBidIncrementFilters() {
                    this.bidConfigSearchName = '';
                    this.bidConfigStatus = '';
                    this.bidConfigPage = 1;
                    this.loadBidIncrementConfigs();
                },
                handleBidConfigSizeChange(size) {
                    this.bidConfigPageSize = size;
                    this.bidConfigPage = 1;
                    this.loadBidIncrementConfigs();
                },
                handleBidConfigCurrentChange(page) {
                    this.bidConfigPage = page;
                    this.loadBidIncrementConfigs();
                },
                openCreateBidConfig() {
                    this.bidConfigForm = { id: null, configName: '', status: 1, description: '' };
                    this.bidConfigDialogVisible = true;
                },
                async openEditBidConfig(row) {
                    try {
                        // 先加载详情（含规则）
                        const res = await axios.get(`/api/admin/bid-increment-configs/${row.id}`);
                        const cfg = res.data?.data || {};
                        const rules = (cfg.rules || []).map((r, idx) => ({
                            minAmount: Number(r.minAmount ?? 0),
                            maxAmountStr: r.maxAmount === null || r.maxAmount === undefined ? '' : String(r.maxAmount),
                            incrementAmount: Number(r.incrementAmount ?? 0),
                            sortOrder: Number(r.sortOrder ?? idx)
                        }));
                        this.bidConfigForm = {
                            id: cfg.id ?? row.id,
                            configName: cfg.configName ?? row.configName,
                            status: cfg.status ?? row.status,
                            description: cfg.description ?? row.description,
                            rules
                        };
                        this.bidConfigDialogVisible = true;
                    } catch (e) {
                        console.error('加载配置详情失败:', e);
                        ElMessage.error((e?.response?.data?.msg) || '加载配置详情失败');
                    }
                },
                async saveBidConfig() {
                    try {
                        this.bidConfigSaving = true;
                        const isUpdate = !!this.bidConfigForm.id;
                        const url = isUpdate ? `/api/admin/bid-increment-configs/${this.bidConfigForm.id}` : '/api/admin/bid-increment-configs';
                        const method = isUpdate ? 'put' : 'post';
                        // 规则校验与转换
                        const rules = (this.bidConfigForm.rules || []).map((r, idx) => ({
                            minAmount: Number(r.minAmount ?? 0),
                            maxAmount: r.maxAmountStr === undefined || r.maxAmountStr === null || r.maxAmountStr === '' ? null : Number(r.maxAmountStr),
                            incrementAmount: Number(r.incrementAmount ?? 0),
                            sortOrder: Number(r.sortOrder ?? idx)
                        }));
                        this.validateRules(rules);
                        await axios[method](url, {
                            configName: this.bidConfigForm.configName,
                            description: this.bidConfigForm.description,
                            status: this.bidConfigForm.status,
                            rules
                        });
                        ElMessage.success(isUpdate ? '更新成功' : '创建成功');
                        this.bidConfigDialogVisible = false;
                        this.loadBidIncrementConfigs();
                    } catch (e) {
                        console.error('保存配置失败:', e);
                        ElMessage.error('保存失败');
                    } finally {
                        this.bidConfigSaving = false;
                    }
                },
                addRuleRow() {
                    this.bidConfigForm.rules = this.bidConfigForm.rules || [];
                    this.bidConfigForm.rules.push({ minAmount: 0, maxAmountStr: '', incrementAmount: 1, sortOrder: this.bidConfigForm.rules.length });
                },
                removeRuleRow(index) {
                    (this.bidConfigForm.rules || []).splice(index, 1);
                },
                validateRules(rules) {
                    if (!rules.length) return; // 允许空
                    // 按 minAmount 升序
                    const s = [...rules].sort((a,b)=>a.minAmount-b.minAmount);
                    for (let i=0;i<s.length;i++) {
                        const r = s[i];
                        if (r.minAmount < 0) throw new Error('最小金额不能小于0');
                        if (r.incrementAmount <= 0) throw new Error('加价幅度需大于0');
                        if (r.maxAmount !== null && r.maxAmount <= r.minAmount) throw new Error('最大金额需大于最小金额或留空');
                        if (i>0) {
                            const prev = s[i-1];
                            const prevMax = prev.maxAmount;
                            if (prevMax === null) throw new Error('存在无上限规则后不应再有后续规则');
                            if (r.minAmount < prevMax) throw new Error('规则区间发生重叠，请检查');
                            if (r.minAmount > prevMax) throw new Error('规则区间不连续，请检查');
                        }
                    }
                },
                async deleteBidConfig(row) {
                    try {
                        await ElMessageBox.confirm('确认删除该配置吗？此操作不可恢复', '提示', { type: 'warning' });
                        const res = await axios.delete(`/api/admin/bid-increment-configs/${row.id}`);
                        if (res?.data?.code === 200) {
                            ElMessage.success('删除成功');
                            this.loadBidIncrementConfigs();
                        } else {
                            const msg = res?.data?.msg || res?.data?.message || '删除失败';
                            ElMessage.error(msg);
                        }
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('删除失败:', e);
                            const msg = e?.response?.data?.msg || e?.response?.data?.message || e?.message || '删除失败';
                            ElMessage.error(msg);
                        }
                    }
                },
                
                openConfigDialog(config = null) {
                    if (config) {
                        this.configForm = { ...config };
                    } else {
                        this.configForm = {
                            id: null,
                            configKey: '',
                            configValue: '',
                            configType: 'STRING',
                            description: '',
                            isSystem: 0,
                            isEditable: 1
                        };
                    }
                    this.configDialogVisible = true;
                },
                
                async saveConfig() {
                    try {
                        const isUpdate = !!this.configForm.id;
                        const url = isUpdate ? '/api/admin/configs/update' : '/api/admin/configs';
                        const method = isUpdate ? 'put' : 'post';
                        
                        await axios[method](url, this.configForm);
                        ElMessage.success(isUpdate ? '更新成功' : '创建成功');
                        this.configDialogVisible = false;
                        this.loadConfigs();
                    } catch (e) {
                        console.error('保存配置失败:', e);
                        ElMessage.error('保存配置失败');
                    }
                },
                
                editConfig(config) {
                    this.openConfigDialog(config);
                },
                
                async deleteConfig(config) {
                    try {
                        await ElMessageBox.confirm('确定要删除这个配置吗？', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        });
                        
                        await axios.post('/api/admin/configs/delete', { id: config.id });
                        ElMessage.success('删除成功');
                        this.loadConfigs();
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('删除配置失败:', e);
                            ElMessage.error('删除配置失败');
                        }
                    }
                },
                
                
                getConfigTypeTag(type) {
                    const typeMap = {
                        'STRING': 'primary',
                        'NUMBER': 'success',
                        'BOOLEAN': 'warning',
                        'JSON': 'danger'
                    };
                    return typeMap[type] || 'info';
                },
                
                // ========== 用户管理 ==========
                async loadUsers() {
                    this.userLoading = true;
                    try {
                        const res = await axios.get('/api/admin/user-management/list', {
                            params: {
                                pageNum: this.userPagination.pageNum,
                                pageSize: this.userPagination.pageSize
                            }
                        });
                        const data = res.data?.data || {};
                        this.userList = data.list || [];
                        this.userPagination.total = data.total || 0;
                        
                        // 加载用户统计
                        await this.loadUserStats();
                    } catch (e) {
                        console.error('加载用户列表失败:', e);
                        ElMessage.error('加载用户列表失败');
                    } finally {
                        this.userLoading = false;
                    }
                },
                
                async loadUserStats() {
                    try {
                        const res = await axios.get('/api/admin/user-management/stats');
                        this.userStats = res.data?.data || {};
                    } catch (e) {
                        console.error('加载用户统计失败:', e);
                    }
                },
                
                async forceUserOffline(user) {
                    try {
                        await ElMessageBox.confirm(`确定要强制用户 ${user.username} 离线吗？`, '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        });
                        
                        await axios.post(`/api/admin/user-management/${user.userId}/offline`);
                        ElMessage.success('操作成功');
                        this.loadUsers();
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('强制用户离线失败:', e);
                            ElMessage.error('操作失败');
                        }
                    }
                },
                
                async forceAllOffline() {
                    try {
                        await ElMessageBox.confirm('确定要强制所有用户离线吗？此操作不可逆！', '警告', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        });
                        
                        await axios.post('/api/admin/user-management/offline-all');
                        ElMessage.success('操作成功');
                        this.loadUsers();
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('强制所有用户离线失败:', e);
                            ElMessage.error('操作失败');
                        }
                    }
                },
                
                async cleanExpiredRecords() {
                    try {
                        await ElMessageBox.confirm('确定要清理过期记录吗？', '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        });
                        
                        await axios.post('/api/admin/user-management/clean-expired', null, {
                            params: { days: 30 }
                        });
                        ElMessage.success('清理完成');
                        this.loadUsers();
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('清理过期记录失败:', e);
                            ElMessage.error('清理失败');
                        }
                    }
                },
                
                formatTime(time) {
                    if (!time) return '-';
                    return new Date(time).toLocaleString('zh-CN');
                },
                
                // ========== 物流公司管理 ==========
                async loadLogisticsCompanies() {
                    this.logisticsLoading = true;
                    try {
                        const res = await axios.get('/api/admin/logistics-companies', {
                            params: {
                                page: this.logisticsPage,
                                size: this.logisticsPageSize
                            }
                        });
                        if (res.data.code === 200) {
                            const data = res.data.data;
                            this.logisticsCompanies = data.list || [];
                            this.logisticsTotal = data.total || 0;
                        }
                    } catch (e) {
                        console.error('加载物流公司列表失败:', e);
                        ElMessage.error('加载物流公司列表失败');
                    } finally {
                        this.logisticsLoading = false;
                    }
                },
                
                searchLogisticsCompanies() {
                    this.logisticsPage = 1;
                    this.loadLogisticsCompanies();
                },
                
                resetLogisticsFilters() {
                    this.logisticsSearchName = '';
                    this.logisticsStatus = null;
                    this.logisticsPage = 1;
                    this.loadLogisticsCompanies();
                },
                
                handleLogisticsSizeChange(size) {
                    this.logisticsPageSize = size;
                    this.logisticsPage = 1;
                    this.loadLogisticsCompanies();
                },
                
                handleLogisticsCurrentChange(page) {
                    this.logisticsPage = page;
                    this.loadLogisticsCompanies();
                },
                
                openCreateLogisticsCompany() {
                    this.logisticsForm = {
                        id: null,
                        companyName: '',
                        companyCode: '',
                        baseFee: 0,
                        insuranceRate: 0,
                        sortOrder: 0,
                        enabled: 1,
                        remark: ''
                    };
                    this.logisticsDialogVisible = true;
                },
                
                openEditLogisticsCompany(company) {
                    this.logisticsForm = {
                        id: company.id,
                        companyName: company.companyName,
                        companyCode: company.companyCode,
                        baseFee: company.baseFee,
                        insuranceRate: company.insuranceRate,
                        sortOrder: company.sortOrder,
                        enabled: company.enabled,
                        remark: company.remark
                    };
                    this.logisticsDialogVisible = true;
                },
                
                async saveLogisticsCompany() {
                    if (!this.logisticsForm.companyName) {
                        ElMessage.warning('请输入公司名称');
                        return;
                    }
                    if (!this.logisticsForm.companyCode) {
                        ElMessage.warning('请输入公司代码');
                        return;
                    }
                    
                    this.logisticsSaving = true;
                    try {
                        let res;
                        if (this.logisticsForm.id) {
                            // 编辑
                            res = await axios.put(`/api/admin/logistics-companies/${this.logisticsForm.id}`, this.logisticsForm);
                        } else {
                            // 新建
                            res = await axios.post('/api/admin/logistics-companies', this.logisticsForm);
                        }
                        
                        if (res.data.code === 200) {
                            ElMessage.success(this.logisticsForm.id ? '更新成功' : '创建成功');
                            this.logisticsDialogVisible = false;
                            this.loadLogisticsCompanies();
                        } else {
                            ElMessage.error(res.data.message || '操作失败');
                        }
                    } catch (e) {
                        console.error('保存物流公司失败:', e);
                        ElMessage.error('操作失败');
                    } finally {
                        this.logisticsSaving = false;
                    }
                },
                
                async deleteLogisticsCompany(company) {
                    try {
                        await ElMessageBox.confirm(`确定要删除物流公司 "${company.companyName}" 吗？`, '提示', {
                            confirmButtonText: '确定',
                            cancelButtonText: '取消',
                            type: 'warning'
                        });
                        
                        const res = await axios.delete(`/api/admin/logistics-companies/${company.id}`);
                        if (res.data.code === 200) {
                            ElMessage.success('删除成功');
                            this.loadLogisticsCompanies();
                        } else {
                            ElMessage.error(res.data.message || '删除失败');
                        }
                    } catch (e) {
                        if (e !== 'cancel') {
                            console.error('删除物流公司失败:', e);
                            ElMessage.error('删除失败');
                        }
                    }
                },
                
                // 退出登录
                logout() {
                    // 主动清理本地Token并跳转，不依赖401再清
                    localStorage.removeItem('accessToken');
                    localStorage.removeItem('refreshToken');
                    delete axios.defaults.headers.common['Authorization'];
                    axios.post('/api/auth/logout').finally(() => {
                        ElMessage.success('已退出登录');
                        window.location.href = '/auction/login';
                    });
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
    
    <!-- 参拍须知：分类/条目对话框 -->
    <el-dialog v-model="categoryDialogVisible" title="分类" width="520px">
        <el-form :model="categoryForm" label-width="90px">
            <el-form-item label="名称"><el-input v-model="categoryForm.name"></el-input></el-form-item>
            <el-form-item label="排序"><el-input-number v-model="categoryForm.sortOrder" :min="0"></el-input-number></el-form-item>
            <el-form-item label="启用"><el-switch v-model="categoryForm.enabled"></el-switch></el-form-item>
        </el-form>
        <template #footer>
            <el-button @click="categoryDialogVisible=false">取消</el-button>
            <el-button type="primary" @click="saveCategory">保存</el-button>
        </template>
    </el-dialog>


    <el-dialog v-model="itemDialogVisible" title="条目" width="720px">
        <el-form :model="itemForm" label-width="90px">
            <el-form-item label="标题"><el-input v-model="itemForm.title"></el-input></el-form-item>
            <el-form-item label="排序"><el-input-number v-model="itemForm.sortOrder" :min="0"></el-input-number></el-form-item>
            <el-form-item label="启用"><el-switch v-model="itemForm.enabled"></el-switch></el-form-item>
            <el-form-item label="内容"><el-input v-model="itemForm.contentHtml" type="textarea" :rows="10"></el-input></el-form-item>
        </el-form>
        <template #footer>
            <el-button @click="itemDialogVisible=false">取消</el-button>
            <el-button type="primary" @click="saveItem">保存</el-button>
        </template>
    </el-dialog>
</body>
</html>