<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿç™»å½• - æ‹å–ç³»ç»Ÿ</title>
    
    <!-- Element UI CSS - ä½¿ç”¨æœ¬åœ°èµ„æº -->
    <link rel="stylesheet" href="/css/element-plus.css">
    <!-- è‡ªå®šä¹‰æ ·å¼ -->
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            padding: 0 20px;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            height: 60px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 24px;
            font-weight: bold;
            color: #409EFF;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 28px;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
        }
        
        .main-content {
            padding: 40px 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: calc(100vh - 60px);
        }
        
        .login-container {
            width: 100%;
            max-width: 400px;
        }
        
        .login-card {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .card-header {
            text-align: center;
            padding: 20px 0;
        }
        
        .card-header h2 {
            margin: 0 0 10px 0;
            color: #303133;
            font-size: 28px;
        }
        
        .card-header p {
            margin: 0;
            color: #909399;
            font-size: 14px;
        }
        
        .login-form {
            padding: 20px;
        }
        
        .login-options {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .login-btn {
            width: 100%;
            height: 45px;
            font-size: 16px;
        }
        
        .login-footer {
            margin-top: 20px;
        }
        
        .copyright {
            text-align: center;
            margin-top: 30px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }
        
        .user-type-info {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .user-type-info h4 {
            margin: 0 0 10px 0;
            color: #0369a1;
            font-size: 16px;
        }
        
        .user-type-info p {
            margin: 5px 0;
            color: #0c4a6e;
            font-size: 14px;
        }
        
        .test-accounts {
            background: #fef3c7;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .test-accounts h4 {
            margin: 0 0 10px 0;
            color: #92400e;
            font-size: 16px;
        }
        
        .test-accounts .account-item {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            padding: 8px;
            background: white;
            border-radius: 4px;
            font-size: 14px;
        }
        
        .test-accounts .account-item .role {
            color: #f59e0b;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- é¡¶éƒ¨å¯¼èˆª -->
        <el-header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="el-icon-gavel"></i>
                    <span>æ‹å–ç³»ç»Ÿ</span>
                </div>
                <div class="nav-links">
                    <el-link href="/auction/user/" type="primary">ç”¨æˆ·é¦–é¡µ</el-link>
                    <el-link href="/auction/admin/" type="primary">ç®¡ç†åå°</el-link>
                </div>
            </div>
        </el-header>

        <!-- ä¸»è¦å†…å®¹ -->
        <el-main class="main-content">
            <div class="login-container">
                <el-card class="login-card" shadow="always">
                    <template #header>
                        <div class="card-header">
                            <h2>ç³»ç»Ÿç™»å½•</h2>
                            <p>æ¬¢è¿æ¥åˆ°æ‹å–ç³»ç»Ÿ</p>
                        </div>
                    </template>
                    
                    <!-- ç”¨æˆ·ç±»å‹è¯´æ˜ -->
                    <div class="user-type-info">
                        <h4>ğŸ’¡ æ™ºèƒ½ç™»å½•</h4>
                        <p>â€¢ ç®¡ç†å‘˜ç™»å½•åè‡ªåŠ¨è·³è½¬åˆ°ç®¡ç†åå°</p>
                        <p>â€¢ æ™®é€šç”¨æˆ·ç™»å½•åè‡ªåŠ¨è·³è½¬åˆ°ç”¨æˆ·ç•Œé¢</p>
                        <p>â€¢ ç³»ç»Ÿä¼šæ ¹æ®æ‚¨çš„èº«ä»½è‡ªåŠ¨è¯†åˆ«æƒé™</p>
                    </div>
                    
                    <el-form 
                        ref="loginForm" 
                        :model="loginForm" 
                        :rules="loginRules" 
                        label-width="80px"
                        class="login-form">
                        
                        <el-form-item label="ç”¨æˆ·å" prop="username">
                            <el-input 
                                v-model="loginForm.username" 
                                placeholder="è¯·è¾“å…¥ç”¨æˆ·å"
                                prefix-icon="el-icon-user"
                                size="large"
                                clearable
                                @keyup.enter="handleLogin">
                            </el-input>
                        </el-form-item>
                        
                        <el-form-item label="å¯†ç " prop="password">
                            <el-input 
                                v-model="loginForm.password" 
                                type="password" 
                                placeholder="è¯·è¾“å…¥å¯†ç "
                                prefix-icon="el-icon-lock"
                                size="large"
                                show-password
                                @keyup.enter="handleLogin">
                            </el-input>
                        </el-form-item>
                        
                        <el-form-item>
                            <div class="login-options">
                                <el-checkbox v-model="loginForm.rememberMe">è®°ä½æˆ‘</el-checkbox>
                                <el-link href="/auction/user/register" type="primary">æ³¨å†Œè´¦å·</el-link>
                            </div>
                        </el-form-item>
                        
                        <el-form-item>
                            <el-button 
                                type="primary" 
                                @click="handleLogin" 
                                :loading="loading"
                                size="large"
                                class="login-btn">
                                ç™»å½•
                            </el-button>
                        </el-form-item>
                    </el-form>
                    
                    <!-- æµ‹è¯•è´¦å·ä¿¡æ¯ -->
                    <div class="test-accounts">
                        <h4>ğŸ§ª æµ‹è¯•è´¦å·</h4>
                        <div class="account-item">
                            <span>admin / admin123</span>
                            <span class="role">ç®¡ç†å‘˜</span>
                        </div>
                        <div class="account-item">
                            <span>buyer1 / 123456</span>
                            <span class="role">æ™®é€šç”¨æˆ·</span>
                        </div>
                        <div class="account-item">
                            <span>buyer2 / 123456</span>
                            <span class="role">æ™®é€šç”¨æˆ·</span>
                        </div>
                    </div>
                </el-card>
                
                <div class="copyright">
                    <p>&copy; 2024 æ‹å–ç³»ç»Ÿ. ä¿ç•™æ‰€æœ‰æƒåˆ©.</p>
                </div>
            </div>
        </el-main>
    </div>

    <!-- Element UI JS - ä½¿ç”¨æœ¬åœ°èµ„æº -->
    <script src="/js/vue.js"></script>
    <script src="/js/element-plus.js"></script>
    <script src="/js/axios.js"></script>
    
    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;

        createApp({
            data() {
                return {
                    loading: false,
                    loginForm: {
                        username: '',
                        password: '',
                        rememberMe: false
                    },
                    loginRules: {
                        username: [
                            { required: true, message: 'è¯·è¾“å…¥ç”¨æˆ·å', trigger: 'blur' },
                            { min: 3, max: 20, message: 'ç”¨æˆ·åé•¿åº¦åœ¨ 3 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' }
                        ],
                        password: [
                            { required: true, message: 'è¯·è¾“å…¥å¯†ç ', trigger: 'blur' },
                            { min: 6, max: 20, message: 'å¯†ç é•¿åº¦åœ¨ 6 åˆ° 20 ä¸ªå­—ç¬¦', trigger: 'blur' }
                        ]
                    }
                }
            },
            mounted() {
                // ç™»å½•é¡µä¹Ÿè®¾ç½®ä¸€æ¬¡å…¨å±€è¯·æ±‚æ‹¦æˆªå™¨ï¼Œé¿å…åç»­é¡µé¢ç¼ºå°‘å¤´
                axios.interceptors.request.use(config => {
                    const token = sessionStorage.getItem('authToken');
                    if (token) config.headers.Authorization = `Bearer ${token}`;
                    return config;
                });
            },
            methods: {
                handleLogin() {
                    this.$refs.loginForm.validate((valid) => {
                        if (valid) {
                            this.loading = true;
                            
                            console.log('å¼€å§‹ç™»å½•è¯·æ±‚...');
                            axios.post('/api/auth/login', this.loginForm)
                                .then(response => {
                                    console.log('ç™»å½•å“åº”:', response);
                                    console.log('å“åº”çŠ¶æ€ç :', response.status);
                                    console.log('å“åº”æ•°æ®:', response.data);
                                    
                                    if (response.data.code === 200) {
                                        ElMessage.success('ç™»å½•æˆåŠŸ');
                                        
                                        // è·å–tokenå’Œè·³è½¬åœ°å€
                                        const accessToken = response.data.data.accessToken;
                                        const refreshToken = response.data.data.refreshToken;
                                        const redirectUrl = response.data.data.redirectUrl || '/auction/user/';
                                        const userType = response.data.data.user.userType;
                                        
                                        console.log('è·å–AccessToken:', accessToken);
                                        console.log('è·å–RefreshToken:', refreshToken);
                                        console.log('è·³è½¬åœ°å€:', redirectUrl);
                                        console.log('ç”¨æˆ·ç±»å‹:', userType);
                                        
                                        // ä¿å­˜tokenåˆ°localStorageï¼ˆæ··åˆæ¨¡å¼ï¼‰
                                        localStorage.setItem('accessToken', accessToken);
                                        localStorage.setItem('refreshToken', refreshToken);
                                        localStorage.setItem('userInfo', JSON.stringify(response.data.data.user));
                                        
                                        // è®¾ç½®å…¨å±€axiosé»˜è®¤è¯·æ±‚å¤´
                                        axios.defaults.headers.common['Authorization'] = `Bearer ${accessToken}`;
                                        
                                        // æ ¹æ®ç”¨æˆ·ç±»å‹è·³è½¬åˆ°ç›¸åº”é¡µé¢
                                        console.log('å‡†å¤‡è·³è½¬åˆ°:', redirectUrl);
                                        window.location.href = redirectUrl;
                                    } else {
                                        console.error('ç™»å½•å¤±è´¥:', response.data.message);
                                        ElMessage.error(response.data.message || 'ç™»å½•å¤±è´¥');
                                    }
                                })
                                .catch(error => {
                                    console.error('ç™»å½•è¯·æ±‚é”™è¯¯:', error);
                                    console.error('é”™è¯¯è¯¦æƒ…:', error.response);
                                    ElMessage.error('ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                                })
                                .finally(() => {
                                    this.loading = false;
                                });
                        }
                    });
                }
            }
        }).use(ElementPlus).mount('#app');
    </script>
    
</body>
</html>
